/*! For license information please see 23271.9dc8a4dd.js.LICENSE.txt */
"use strict";(self.webpackChunk_eightshift_docs=self.webpackChunk_eightshift_docs||[]).push([[23271],{23271:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{QH:()=>startPlaygroundWeb,XT:()=>installTheme,gT:()=>wpCLI$1});var Nt=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},H=(e,t,r)=>(Nt(e,t,"read from private field"),r?r.call(e):t.get(e)),Q=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},te=(e,t,r,n)=>(Nt(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),ce=(e,t,r)=>(Nt(e,t,"access private method"),r);const currentJsRuntime=typeof process<"u"&&"node"===(null==(e=process.release)?void 0:e.name)?"NODE":typeof window<"u"?"WEB":typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?"WORKER":"NODE";var e;if("NODE"===currentJsRuntime){let e=function(e){return new Promise((function(t,r){e.onload=e.onerror=function(n){e.onload=e.onerror=null,"load"===n.type?t(e.result):r(new Error("Failed to read the blob/file"))}}))},t=function(){const e=new Uint8Array([1,2,3,4]),t=new File([e],"test").stream();try{return t.getReader({mode:"byob"}),!0}catch{return!1}};if(typeof File>"u"){class e extends Blob{constructor(e,t,r){let n;super(e),null!=r&&r.lastModified&&(n=new Date),(!n||isNaN(n.getFullYear()))&&(n=new Date),this.lastModifiedDate=n,this.lastModified=n.getMilliseconds(),this.name=t||""}}global.File=e}typeof Blob.prototype.arrayBuffer>"u"&&(Blob.prototype.arrayBuffer=function(){const t=new FileReader;return t.readAsArrayBuffer(this),e(t)}),typeof Blob.prototype.text>"u"&&(Blob.prototype.text=function(){const t=new FileReader;return t.readAsText(this),e(t)}),(typeof Blob.prototype.stream>"u"||!t())&&(Blob.prototype.stream=function(){let e=0;const t=this;return new ReadableStream({type:"bytes",autoAllocateChunkSize:524288,async pull(r){const n=r.byobRequest.view,o=await t.slice(e,e+n.byteLength).arrayBuffer(),s=new Uint8Array(o);new Uint8Array(n.buffer).set(s);const i=s.byteLength;r.byobRequest.respond(i),e+=i,e>=t.size&&r.close()}})})}if("NODE"===currentJsRuntime&&typeof CustomEvent>"u"){class e extends Event{constructor(e,t={}){super(e,t),this.detail=t.detail}initCustomEvent(){}}globalThis.CustomEvent=e}const wpContentFilesExcludedFromExport=["db.php","plugins/akismet","plugins/hello.php","plugins/wordpress-importer","mu-plugins/sqlite-database-integration","mu-plugins/playground-includes","mu-plugins/export-wxz.php","mu-plugins/0-playground.php","themes/twentytwenty","themes/twentytwentyone","themes/twentytwentytwo","themes/twentytwentythree","themes/twentytwentyfour","themes/twentytwentyfive","themes/twentytwentysix"];class Semaphore{constructor({concurrency:e}){this._running=0,this.concurrency=e,this.queue=[]}get running(){return this._running}async acquire(){for(;;){if(!(this._running>=this.concurrency)){this._running++;let e=!1;return()=>{e||(e=!0,this._running--,this.queue.length>0&&this.queue.shift()())}}await new Promise((e=>this.queue.push(e)))}}async run(e){const t=await this.acquire();try{return await e()}finally{t()}}}function joinPaths(...e){let t=e.join("/");const r="/"===t[0],n="/"===t.substring(t.length-1);return t=normalizePath(t),!t&&!r&&(t="."),t&&n&&(t+="/"),t}function dirname(e){if("/"===e)return"/";const t=(e=normalizePath(e)).lastIndexOf("/");return-1===t?"":0===t?"/":e.substr(0,t)}function normalizePath(e){const t="/"===e[0];return(t?"/":"")+(e=normalizePathsArray(e.split("/").filter((e=>!!e)),!t).join("/")).replace(/\/$/,"")}function normalizePathsArray(e,t){let r=0;for(let n=e.length-1;n>=0;n--){const t=e[n];"."===t?e.splice(n,1):".."===t?(e.splice(n,1),r++):r&&(e.splice(n,1),r--)}if(t)for(;r;r--)e.unshift("..");return e}function splitShellCommand$1(e){let t=0,r="";const n=[];let o="";for(let s=0;s<e.length;s++){const i=e[s];"\\"===i?(('"'===e[s+1]||"'"===e[s+1])&&s++,o+=e[s]):0===t?'"'===i||"'"===i?(t=1,r=i):i.match(/\s/)?(o.trim().length&&n.push(o.trim()),o=i):n.length&&!o?o=n.pop()+i:o+=i:1===t&&(i===r?(t=0,r=""):o+=i)}return o&&n.push(o.trim()),n}function createSpawnHandler(e){return function(t,r=[],n={}){const o=new ChildProcess,s=new ProcessApi(o);return setTimeout((async()=>{let i=[];if(r.length)i=[t,...r];else if("string"==typeof t)i=splitShellCommand$1(t);else{if(!Array.isArray(t))throw new Error("Invalid command ",t);i=t}await e(i,s,n),o.emit("spawn",!0)})),o}}class EventEmitter{constructor(){this.listeners={}}emit(e,t){this.listeners[e]&&this.listeners[e].forEach((function(e){e(t)}))}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class ProcessApi extends EventEmitter{constructor(e){super(),this.childProcess=e,this.exited=!1,this.stdinData=[],e.on("stdin",(e=>{this.stdinData?this.stdinData.push(e.slice()):this.emit("stdin",e)}))}stdout(e){"string"==typeof e&&(e=(new TextEncoder).encode(e)),this.childProcess.stdout.emit("data",e)}stdoutEnd(){this.childProcess.stdout.emit("end",{})}stderr(e){"string"==typeof e&&(e=(new TextEncoder).encode(e)),this.childProcess.stderr.emit("data",e)}stderrEnd(){this.childProcess.stderr.emit("end",{})}exit(e){this.exited||(this.exited=!0,this.childProcess.emit("exit",e))}flushStdin(){if(this.stdinData)for(let e=0;e<this.stdinData.length;e++)this.emit("stdin",this.stdinData[e]);this.stdinData=null}}let lastPid=9743;class ChildProcess extends EventEmitter{constructor(e=lastPid++){super(),this.pid=e,this.stdout=new EventEmitter,this.stderr=new EventEmitter;const t=this;this.stdin={write:e=>{t.emit("stdin",e)}}}}function randomString(e=36,t="!@#$%^&*()_+=-[]/.,<>?"){const r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"+t;let n="";for(let o=e;o>0;--o)n+=r[Math.floor(Math.random()*r.length)];return n}function randomFilename(){return randomString(36,"-_")}function phpVar(e){return`json_decode(base64_decode('${stringToBase64(JSON.stringify(e))}'), true)`}function phpVars(e){const t={};for(const r in e)t[r]=phpVar(e[r]);return t}function stringToBase64(e){return bytesToBase64((new TextEncoder).encode(e))}function bytesToBase64(e){const t=String.fromCodePoint(...e);return btoa(t)}const activatePlugin=async(e,{pluginPath:t,pluginName:r},n)=>{null==n||n.tracker.setCaption(`Activating ${r||t}`);const o=await e.documentRoot;await e.run({throwOnError:!0,code:`<?php\ndefine( 'WP_ADMIN', true );\nrequire_once( ${phpVar(o)}. "/wp-load.php" );\nrequire_once( ${phpVar(o)}. "/wp-admin/includes/plugin.php" );\n\n// Set current user to admin\nset_current_user( get_users(array('role' => 'Administrator') )[0] );\n\n$plugin_path = ${phpVar(t)};\n\nif (!is_dir($plugin_path)) {\n\tactivate_plugin($plugin_path);\n\tdie();\n}\n\nforeach ( ( glob( $plugin_path . '/*.php' ) ?: array() ) as $file ) {\n\t$info = get_plugin_data( $file, false, false );\n\tif ( ! empty( $info['Name'] ) ) {\n\t\tactivate_plugin( $file );\n\t\tdie();\n\t}\n}\n\n// If we got here, the plugin was not found.\nexit(1);\n`})},activateTheme=async(e,{themeFolderName:t},r)=>{null==r||r.tracker.setCaption(`Activating ${t}`);const n=await e.documentRoot;await e.run({throwOnError:!0,code:`<?php\ndefine( 'WP_ADMIN', true );\nrequire_once( ${phpVar(n)}. "/wp-load.php" );\n\n// Set current user to admin\nset_current_user( get_users(array('role' => 'Administrator') )[0] );\n\nswitch_theme( ${phpVar(t)} );\n`})},runPHP=async(e,{code:t})=>await e.run({code:t,throwOnError:!0}),runPHPWithOptions=async(e,{options:t})=>await e.run(t),rm=async(e,{path:t})=>{await e.unlink(t)},runSql=async(e,{sql:t},r)=>{null==r||r.tracker.setCaption("Executing SQL Queries");const n=`/tmp/${randomFilename()}.sql`;await e.writeFile(n,new Uint8Array(await t.arrayBuffer()));const o=phpVars({docroot:await e.documentRoot,sqlFilename:n}),s=await e.run({code:`<?php\n\t\trequire_once ${o.docroot} . '/wp-load.php';\n\n\t\t$handle = fopen(${o.sqlFilename}, 'r');\n\t\t$buffer = '';\n\n\t\tglobal $wpdb;\n\n\t\twhile ($bytes = fgets($handle)) {\n\t\t\t$buffer .= $bytes;\n\n\t\t\tif (!feof($handle) && substr($buffer, -1, 1) !== "\n") {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t$wpdb->query($buffer);\n\t\t\t$buffer = '';\n\t\t}\n\t`});return await rm(e,{path:n}),s},setPhpIniEntry=async(e,{key:t,value:r})=>{await e.setPhpIniEntry(t,r)},request=async(e,{request:t})=>{const r=await e.request(t);if(r.httpStatusCode>399||r.httpStatusCode<200)throw console.warn("WordPress response was",{response:r}),new Error(`Request failed with status ${r.httpStatusCode}`);return r},rewriteWpConfigToDefineConstants="<?php\n\n/**\n * Rewrites the wp-config.php file to ensure specific constants are defined\n * with specific values.\n * \n * Example:\n * \n * ```php\n * <?php\n * define('WP_DEBUG', true);\n * // The third define() argument is also supported:\n * define('SAVEQUERIES', false, true);\n * \n * // Expression\n * define(true ? 'WP_DEBUG_LOG' : 'WP_DEBUG_LOG', 123);\n * \n * // Guarded expressions shouldn't be wrapped twice\n * if(!defined(1 ? 'A' : 'B')) {\n *     define(1 ? 'A' : 'B', 0);\n * }\n * \n * // More advanced expression\n * define((function() use($x) {\n *     return [$x, 'a'];\n * })(), 123);\n * ```\n * \n * Rewritten with\n * \n *     $constants = [\n *        'WP_DEBUG' => false,\n *        'WP_DEBUG_LOG' => true,\n *        'SAVEQUERIES' => true,\n *        'NEW_CONSTANT' => \"new constant\",\n *     ];\n * \n * ```php\n * <?php\n * define('WP_DEBUG_LOG',true);\n * define('NEW_CONSTANT','new constant');\n * ?><?php\n * define('WP_DEBUG',false);\n * // The third define() argument is also supported:\n * define('SAVEQUERIES',true, true);\n * \n * // Expression\n * if(!defined($const ? 'WP_DEBUG_LOG' : 'WP_DEBUG_LOG')) {\n *      define($const ? 'WP_DEBUG_LOG' : 'WP_DEBUG_LOG', 123);\n * }\n * \n * // Guarded expressions shouldn't be wrapped twice\n * if(!defined(1 ? 'A' : 'B')) {\n *     define(1 ? 'A' : 'B', 0);\n * }\n * \n * // More advanced expression\n * if(!defined((function() use($x) {\n *    return [$x, 'a'];\n * })())) {\n *     define((function() use($x) {\n *         return [$x, 'a'];\n *     })(), 123);\n * }\n * ```\n * \n * @param mixed $content\n * @return string\n */\nfunction rewrite_wp_config_to_define_constants($content, $constants = [])\n{\n    $tokens = array_reverse(token_get_all($content));\n    $output = [];\n    $defined_expressions = [];\n\n    // Look through all the tokens and find the define calls\n    do {\n        $buffer = [];\n        $name_buffer = [];\n        $value_buffer = [];\n        $third_arg_buffer = [];\n\n        // Capture everything until the define call into output.\n        // Capturing the define call into a buffer.\n        // Example:\n        //     <?php echo 'a'; define  (\n        //     ^^^^^^^^^^^^^^^^^^^^^^\n        //           output   |buffer\n        while ($token = array_pop($tokens)) {\n            if (is_array($token) && $token[0] === T_STRING && (strtolower($token[1]) === 'define' || strtolower($token[1]) === 'defined')) {\n                $buffer[] = $token;\n                break;\n            }\n            $output[] = $token;\n        }\n\n        // Maybe we didn't find a define call and reached the end of the file?\n        if (!count($tokens)) {\n            break;\n        }\n\n        // Keep track of the \"defined\" expressions that are already accounted for\n        if($token[1] === 'defined') {\n            $output[] = $token;\n            $defined_expression = [];\n            $open_parenthesis = 0;\n            // Capture everything up to the opening parenthesis, including the parenthesis\n            // e.g. defined  (\n            //           ^^^^\n            while ($token = array_pop($tokens)) {\n                $output[] = $token;\n                if ($token === \"(\") {\n                    ++$open_parenthesis;\n                    break;\n                }\n            }\n\n            // Capture everything up to the closing parenthesis, including the parenthesis\n            // e.g. defined  (\n            //           ^^^^\n            while ($token = array_pop($tokens)) {\n                $output[] = $token;\n                if ($token === \")\") {\n                    --$open_parenthesis;\n                }\n                if ($open_parenthesis === 0) {\n                    break;\n                }\n                $defined_expression[] = $token;\n            }\n\n            $defined_expressions[] = stringify_tokens(skip_whitespace($defined_expression));\n            continue;\n        }\n\n        // Capture everything up to the opening parenthesis, including the parenthesis\n        // e.g. define  (\n        //           ^^^^\n        while ($token = array_pop($tokens)) {\n            $buffer[] = $token;\n            if ($token === \"(\") {\n                break;\n            }\n        }\n\n        // Capture the first argument \u2013 it's the first expression after the opening\n        // parenthesis and before the comma:\n        // Examples:\n        //     define(\"WP_DEBUG\", true);\n        //            ^^^^^^^^^^^\n        //\n        //     define(count([1,2]) > 2 ? 'WP_DEBUG' : 'FOO', true);\n        //            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n        $open_parenthesis = 0;\n        while ($token = array_pop($tokens)) {\n            $buffer[] = $token;\n            if ($token === \"(\" || $token === \"[\" || $token === \"{\") {\n                ++$open_parenthesis;\n            } elseif ($token === \")\" || $token === \"]\" || $token === \"}\") {\n                --$open_parenthesis;\n            } elseif ($token === \",\" && $open_parenthesis === 0) {\n                break;\n            }\n\n            // Don't capture the comma as a part of the constant name\n            $name_buffer[] = $token;\n        }\n\n        // Capture everything until the closing parenthesis\n        //     define(\"WP_DEBUG\", true);\n        //                       ^^^^^^\n        $open_parenthesis = 0;\n        $is_second_argument = true;\n        while ($token = array_pop($tokens)) {\n            $buffer[] = $token;\n            if ($token === \")\" && $open_parenthesis === 0) {\n                // Final parenthesis of the define call.\n                break;\n            } else if ($token === \"(\" || $token === \"[\" || $token === \"{\") {\n                ++$open_parenthesis;\n            } elseif ($token === \")\" || $token === \"]\" || $token === \"}\") {\n                --$open_parenthesis;\n            } elseif ($token === \",\" && $open_parenthesis === 0) {\n                // This define call has more than 2 arguments! The third one is the\n                // boolean value indicating $is_case_insensitive. Let's continue capturing\n                // to $third_arg_buffer.\n                $is_second_argument = false;\n            }\n            if ($is_second_argument) {\n                $value_buffer[] = $token;\n            } else {\n                $third_arg_buffer[] = $token;\n            }\n        }\n\n        // Capture until the semicolon\n        //     define(\"WP_DEBUG\", true)  ;\n        //                             ^^^\n        while ($token = array_pop($tokens)) {\n            $buffer[] = $token;\n            if ($token === \";\") {\n                break;\n            }\n        }\n\n        // Decide whether $name_buffer is a constant name or an expression\n        $name_token = null;\n        $name_token_index = $token;\n        $name_is_literal = true;\n        foreach ($name_buffer as $k => $token) {\n            if (is_array($token)) {\n                if ($token[0] === T_WHITESPACE || $token[0] === T_COMMENT || $token[0] === T_DOC_COMMENT) {\n                    continue;\n                } else if ($token[0] === T_STRING || $token[0] === T_CONSTANT_ENCAPSED_STRING) {\n                    $name_token = $token;\n                    $name_token_index = $k;\n                } else {\n                    $name_is_literal = false;\n                    break;\n                }\n            } else if ($token !== \"(\" && $token !== \")\") {\n                $name_is_literal = false;\n                break;\n            }\n        }\n\n        // We can't handle expressions as constant names. Let's wrap that define\n        // call in an if(!defined()) statement, just in case it collides with\n        // a constant name.\n        if (!$name_is_literal) {\n            // Ensure the defined expression is not already accounted for\n            foreach ($defined_expressions as $defined_expression) {\n                if ($defined_expression === stringify_tokens(skip_whitespace($name_buffer))) {\n                    $output = array_merge($output, $buffer);\n                    continue 2;\n                }\n            }\n            $output = array_merge(\n                $output,\n                [\"if(!defined(\"],\n                $name_buffer,\n                [\")) {\\n     \"],\n                ['define('],\n                $name_buffer,\n                [','],\n                $value_buffer,\n                $third_arg_buffer,\n                [\");\"],\n                [\"\\n}\\n\"]\n            );\n            continue;\n        }\n\n        // Yay, we have a literal constant name in the buffer now. Let's\n        // get its value:\n        $name = eval('return ' . $name_token[1] . ';');\n\n        // If the constant name is not in the list of constants we're looking,\n        // we can ignore it.\n        if (!array_key_exists($name, $constants)) {\n            $output = array_merge($output, $buffer);\n            continue;\n        }\n\n        // We now have a define() call that defines a constant we're looking for.\n        // Let's rewrite its value to the one \n        $output = array_merge(\n            $output,\n            ['define('],\n            $name_buffer,\n            [','],\n            [var_export($constants[$name], true)],\n            $third_arg_buffer,\n            [\");\"]\n        );\n\n        // Remove the constant from the list so we can process any remaining\n        // constants later.\n        unset($constants[$name]);\n    } while (count($tokens));\n\n    // Add any constants that weren't found in the file\n    if (count($constants)) {\n        $prepend = [\n            \"<?php \\n\"\n        ];\n        foreach ($constants as $name => $value) {\n            $prepend = array_merge(\n                $prepend,\n                [\n                    \"define(\",\n                    var_export($name, true),\n                    ',',\n                    var_export($value, true),\n                    \");\\n\"\n                ]\n            );\n        }\n        $prepend[] = \"?>\";\n        $output = array_merge(\n            $prepend,\n            $output\n        );\n    }\n\n    // Translate the output tokens back into a string\n    return stringify_tokens($output);\n}\n\nfunction stringify_tokens($tokens) {\n    $output = '';\n    foreach ($tokens as $token) {\n        if (is_array($token)) {\n            $output .= $token[1];\n        } else {\n            $output .= $token;\n        }\n    }\n    return $output;\n}\n\nfunction skip_whitespace($tokens) {\n    $output = [];\n    foreach ($tokens as $token) {\n        if (is_array($token) && ($token[0] === T_WHITESPACE || $token[0] === T_COMMENT || $token[0] === T_DOC_COMMENT)) {\n            continue;\n        }\n        $output[] = $token;\n    }\n    return $output;\n}\n",defineWpConfigConsts=async(e,{consts:t,method:r="rewrite-wp-config"})=>{switch(r){case"define-before-run":await defineBeforeRun(e,t);break;case"rewrite-wp-config":{const r=joinPaths(await e.documentRoot,"/wp-config.php"),n=await e.readFileAsText(r),o=await rewriteDefineCalls(e,n,t);await e.writeFile(r,o);break}default:throw new Error(`Invalid method: ${r}`)}};async function defineBeforeRun(e,t){for(const r in t)await e.defineConstant(r,t[r])}async function rewriteDefineCalls(e,t,r){await e.writeFile("/tmp/code.php",t);const n=phpVars({consts:r});return await e.run({throwOnError:!0,code:`${rewriteWpConfigToDefineConstants}\n\t$wp_config_path = '/tmp/code.php';\n\t$wp_config = file_get_contents($wp_config_path);\n\t$new_wp_config = rewrite_wp_config_to_define_constants($wp_config, ${n.consts});\n\tfile_put_contents($wp_config_path, $new_wp_config);\n\t`}),await e.readFileAsText("/tmp/code.php")}const login=async(e,{username:t="admin",password:r="password"}={},n)=>{var o,s,i;null==n||n.tracker.setCaption((null==n?void 0:n.initialCaption)||"Logging in"),await e.request({url:"/wp-login.php"});const a=await e.request({url:"/wp-login.php",method:"POST",body:{log:t,pwd:r,rememberme:"forever"}});if(null==(i=null==(s=null==(o=a.headers)?void 0:o.location)?void 0:s[0])||!i.includes("/wp-admin/"))throw console.warn("WordPress response was",{response:a,text:a.text}),new Error(`Failed to log in as ${t} with password ${r}`)},setSiteOptions=async(e,{options:t})=>{const r=await e.documentRoot;await e.run({throwOnError:!0,code:`<?php\n\t\tinclude ${phpVar(r)} . '/wp-load.php';\n\t\t$site_options = ${phpVar(t)};\n\t\tforeach($site_options as $name => $value) {\n\t\t\tupdate_option($name, $value);\n\t\t}\n\t\techo "Success";\n\t\t`})},updateUserMeta=async(e,{meta:t,userId:r})=>{const n=await e.documentRoot;await e.run({throwOnError:!0,code:`<?php\n\t\tinclude ${phpVar(n)} . '/wp-load.php';\n\t\t$meta = ${phpVar(t)};\n\t\tforeach($meta as $name => $value) {\n\t\t\tupdate_user_meta(${phpVar(r)}, $name, $value);\n\t\t}\n\t\t`})};function isURLScoped(e){return e.pathname.startsWith("/scope:")}function getURLScope(e){return isURLScoped(e)?e.pathname.split("/")[1].split(":")[1]:null}const enableMultisite=async e=>{var t;await defineWpConfigConsts(e,{consts:{WP_ALLOW_MULTISITE:1}});const r=new URL(await e.absoluteUrl);if(""!==r.port){let e=`The current host is ${r.host}, but WordPress multisites do not support custom ports.`;throw"localhost"===r.hostname&&(e+=" For development, you can set up a playground.test domain using the instructions at https://wordpress.github.io/wordpress-playground/contributing/code."),new Error(e)}const n=r.pathname.replace(/\/$/,"")+"/",o=`${r.protocol}//${r.hostname}${n}`;await setSiteOptions(e,{options:{siteurl:o,home:o}}),await login(e,{});const s=await e.documentRoot,i=(await e.run({throwOnError:!0,code:`<?php\ndefine( 'WP_ADMIN', true );\nrequire_once(${phpVar(s)} . "/wp-load.php");\n\n// Set current user to admin\nset_current_user( get_users(array('role' => 'Administrator') )[0] );\n\nrequire_once(${phpVar(s)} . "/wp-admin/includes/plugin.php");\n$plugins_root = ${phpVar(s)} . "/wp-content/plugins";\n$plugins = glob($plugins_root . "/*");\n\n$deactivated_plugins = [];\nforeach($plugins as $plugin_path) {\n\tif (!is_dir($plugin_path)) {\n\t\tdeactivate_plugins($plugin_path);\n\t\tcontinue;\n\t}\n\t// Find plugin entry file\n\tforeach ( ( glob( $plugin_path . '/*.php' ) ?: array() ) as $file ) {\n\t\t$info = get_plugin_data( $file, false, false );\n\t\tif ( ! empty( $info['Name'] ) ) {\n\t\t\tdeactivate_plugins( $file );\n\t\t\t$deactivated_plugins[] = substr($file, strlen($plugins_root) + 1);\n\t\t\tbreak;\n\t\t}\n\t}\n}\necho json_encode($deactivated_plugins);\n`})).json,a=null==(t=(await request(e,{request:{url:"/wp-admin/network.php"}})).text.match(/name="_wpnonce"\s+value="([^"]+)"/))?void 0:t[1],c=await request(e,{request:{url:"/wp-admin/network.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:jsonToUrlEncoded({_wpnonce:a,_wp_http_referer:n+"wp-admin/network.php",sitename:"My WordPress Website Sites",email:"admin@localhost.com",submit:"Install"})}});if(200!==c.httpStatusCode)throw console.warn("WordPress response was",{response:c,text:c.text,headers:c.headers}),new Error(`Failed to enable multisite. Response code was ${c.httpStatusCode}`);await defineWpConfigConsts(e,{consts:{SUNRISE:"on",MULTISITE:!0,SUBDOMAIN_INSTALL:!1,SITE_ID_CURRENT_SITE:1,BLOG_ID_CURRENT_SITE:1,DOMAIN_CURRENT_SITE:r.hostname,PATH_CURRENT_SITE:n}});const l=new URL(await e.absoluteUrl),d=isURLScoped(l)?"scope:"+getURLScope(l):null;await e.writeFile(joinPaths(s,"/wp-content/sunrise.php"),`<?php\n\tif ( !defined( 'BLOG_ID_CURRENT_SITE' ) ) {\n\t\tdefine( 'BLOG_ID_CURRENT_SITE', 1 );\n\t}\n\t$folder = ${phpVar(d)};\n\tif ($folder && strpos($_SERVER['REQUEST_URI'],"/$folder") === false) {\n\t\t$_SERVER['HTTP_HOST'] = ${phpVar(l.hostname)};\n\t\t$_SERVER['REQUEST_URI'] = "/$folder/" . ltrim($_SERVER['REQUEST_URI'], '/');\n\t}\n`),await login(e,{});for(const p of i)await activatePlugin(e,{pluginPath:p})};function jsonToUrlEncoded(e){return Object.keys(e).map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&")}const cp=async(e,{fromPath:t,toPath:r})=>{await e.writeFile(r,await e.readFileAsBuffer(t))},mv=async(e,{fromPath:t,toPath:r})=>{await e.mv(t,r)},mkdir=async(e,{path:t})=>{await e.mkdir(t)},rmdir=async(e,{path:t})=>{await e.rmdir(t)},writeFile=async(e,{path:t,data:r})=>{r instanceof File&&(r=new Uint8Array(await r.arrayBuffer())),await e.writeFile(t,r)},defineSiteUrl=async(e,{siteUrl:t})=>{await defineWpConfigConsts(e,{consts:{WP_HOME:t,WP_SITEURL:t}})},importFile=async(e,{file:t},r)=>{var n,o;null==(n=null==r?void 0:r.tracker)||n.setCaption("Importing content");const s=null==(o=DOM(await e.request({url:"/wp-admin/admin.php?import=wordpress"})).getElementById("import-upload-form"))?void 0:o.getAttribute("action"),i=await e.request({url:`/wp-admin/${s}`,method:"POST",body:{import:t}}),a=DOM(i).querySelector("#wpbody-content form");if(!a)throw console.log(i.text),new Error("Could not find an importer form in response. See the response text above for details.");const c=getFormData(a);c.fetch_attachments="1";for(const d in c)if(d.startsWith("user_map[")){c["user_new["+d.slice(9,-1)+"]"]="1"}const l=await e.request({url:a.action,method:"POST",body:c});if(!l.text.includes("All done."))throw console.warn("WordPress response was: ",{text:l.text,errors:l.errors}),new Error("Import failed, see console for details.")};function DOM(e){return(new DOMParser).parseFromString(e.text,"text/html")}function getFormData(e){return Object.fromEntries(new FormData(e).entries())}const zipFunctions="<?php\n\nfunction zipDir($root, $output, $options = array())\n{\n    $root = rtrim($root, '/');\n    $additionalPaths = array_key_exists('additional_paths', $options) ? $options['additional_paths'] : array();\n    $excludePaths = array_key_exists('exclude_paths', $options) ? $options['exclude_paths'] : array();\n    $zip_root = array_key_exists('zip_root', $options) ? $options['zip_root'] : $root;\n\n    $zip = new ZipArchive;\n    $res = $zip->open($output, ZipArchive::CREATE);\n    if ($res === TRUE) {\n        $directories = array(\n            $root . '/'\n        );\n        while (sizeof($directories)) {\n            $current_dir = array_pop($directories);\n\n            if ($handle = opendir($current_dir)) {\n                while (false !== ($entry = readdir($handle))) {\n                    if ($entry == '.' || $entry == '..') {\n                        continue;\n                    }\n\n                    $entry = join_paths($current_dir, $entry);\n                    if (in_array($entry, $excludePaths)) {\n                        continue;\n                    }\n\n                    if (is_dir($entry)) {\n                        $directory_path = $entry . '/';\n                        array_push($directories, $directory_path);\n                    } else if (is_file($entry)) {\n                        $zip->addFile($entry, substr($entry, strlen($zip_root)));\n                    }\n                }\n                closedir($handle);\n            }\n        }\n        foreach ($additionalPaths as $disk_path => $zip_path) {\n            $zip->addFile($disk_path, $zip_path);\n        }\n        $zip->close();\n        chmod($output, 0777);\n    }\n}\n\nfunction join_paths()\n{\n    $paths = array();\n\n    foreach (func_get_args() as $arg) {\n        if ($arg !== '') {\n            $paths[] = $arg;\n        }\n    }\n\n    return preg_replace('#/+#', '/', join('/', $paths));\n}\n\nfunction unzip($zipPath, $extractTo, $overwrite = true)\n{\n    if (!is_dir($extractTo)) {\n        mkdir($extractTo, 0777, true);\n    }\n    $zip = new ZipArchive;\n    $res = $zip->open($zipPath);\n    if ($res === TRUE) {\n        $zip->extractTo($extractTo);\n        $zip->close();\n        chmod($extractTo, 0777);\n    }\n}\n\n\nfunction delTree($dir)\n{\n    $files = array_diff(scandir($dir), array('.', '..'));\n    foreach ($files as $file) {\n        (is_dir(\"$dir/$file\")) ? delTree(\"$dir/$file\") : unlink(\"$dir/$file\");\n    }\n    return rmdir($dir);\n}\n";async function runPhpWithZipFunctions(e,t){return await e.run({throwOnError:!0,code:zipFunctions+t})}const tmpPath="/tmp/file.zip",unzip=async(e,{zipFile:t,zipPath:r,extractToPath:n})=>{if(r)await e.writeFile(tmpPath,await e.readFileAsBuffer(r)),console.warn('The "zipPath" option of the unzip() Blueprint step is deprecated and will be removed. Use "zipFile" instead.');else{if(!t)throw new Error("Either zipPath or zipFile must be provided");await e.writeFile(tmpPath,new Uint8Array(await t.arrayBuffer()))}const o=phpVars({zipPath:tmpPath,extractToPath:n});await runPhpWithZipFunctions(e,`unzip(${o.zipPath}, ${o.extractToPath});`),e.fileExists(tmpPath)&&await e.unlink(tmpPath)},importWordPressFiles=async(e,{wordPressFilesZip:t,pathInZip:r=""})=>{const n=await e.documentRoot;let o=joinPaths("/tmp","import");await e.mkdir(o),await unzip(e,{zipFile:t,extractToPath:o}),o=joinPaths(o,r);const s=joinPaths(o,"wp-content"),i=joinPaths(n,"wp-content");for(const d of wpContentFilesExcludedFromExport){const t=joinPaths(s,d);await removePath(e,t);const r=joinPaths(i,d);await e.fileExists(r)&&(await e.mkdir(dirname(t)),await e.mv(r,t))}const a=joinPaths(o,"wp-content","database");await e.fileExists(a)||await e.mv(joinPaths(n,"wp-content","database"),a);const c=await e.listFiles(o);for(const d of c)await removePath(e,joinPaths(n,d)),await e.mv(joinPaths(o,d),joinPaths(n,d));await e.rmdir(o),await defineSiteUrl(e,{siteUrl:await e.absoluteUrl});const l=phpVar(joinPaths(n,"wp-admin","upgrade.php"));await e.run({throwOnError:!0,code:`<?php\n            $_GET['step'] = 'upgrade_db';\n            require ${l};\n            `})};async function removePath(e,t){await e.fileExists(t)&&(await e.isDir(t)?await e.rmdir(t):await e.unlink(t))}async function exportWXR(e){const t=await e.request({url:"/wp-admin/export.php?download=true&content=all"});return new File([t.bytes],"export.xml")}async function exportWXZ(e){const t=await e.request({url:"/wp-admin/export.php?download=true&content=all&export_wxz=1"});return new File([t.bytes],"export.wxz")}async function installAsset(e,{targetPath:t,zipFile:r}){const n=r.name.replace(/\.zip$/,""),o=joinPaths(await e.documentRoot,"wp-content"),s=joinPaths(o,randomString()),i=joinPaths(s,"assets",n);await e.fileExists(i)&&await e.rmdir(s,{recursive:!0}),await e.mkdir(s);try{await unzip(e,{zipFile:r,extractToPath:i});let o=await e.listFiles(i,{prependPath:!0});o=o.filter((e=>!e.endsWith("/__MACOSX")));const s=1===o.length&&await e.isDir(o[0]);let a,c="";s?(c=o[0],a=o[0].split("/").pop()):(c=i,a=n);const l=`${t}/${a}`;return await e.mv(c,l),{assetFolderPath:l,assetFolderName:a}}finally{await e.rmdir(s,{recursive:!0})}}function zipNameToHumanName(e){const t=e.split(".").shift().replace(/-/g," ");return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}const installPlugin=async(e,{pluginZipFile:t,options:r={}},n)=>{const o=zipNameToHumanName(t.name.split("/").pop()||"plugin.zip");null==n||n.tracker.setCaption(`Installing the ${o} plugin`);const{assetFolderPath:s}=await installAsset(e,{zipFile:t,targetPath:`${await e.documentRoot}/wp-content/plugins`});(!("activate"in r)||r.activate)&&await activatePlugin(e,{pluginPath:s,pluginName:o},n)},installTheme=async(e,{themeZipFile:t,options:r={}},n)=>{const o=zipNameToHumanName(t.name);null==n||n.tracker.setCaption(`Installing the ${o} theme`);const{assetFolderName:s}=await installAsset(e,{zipFile:t,targetPath:`${await e.documentRoot}/wp-content/themes`});(!("activate"in r)||r.activate)&&await activateTheme(e,{themeFolderName:s},n)},runWpInstallationWizard=async(e,{options:t})=>{await e.request({url:"/wp-admin/install.php?step=2",method:"POST",body:{language:"en",prefix:"wp_",weblog_title:"My WordPress Website",user_name:t.adminPassword||"admin",admin_password:t.adminPassword||"password",admin_password2:t.adminPassword||"password",Submit:"Install WordPress",pw_weak:"1",admin_email:"admin@localhost.com"}})},zipWpContent=async(e,{selfContained:t=!1}={})=>{const r="/tmp/wordpress-playground.zip",n=await e.documentRoot,o=joinPaths(n,"wp-content");let s=wpContentFilesExcludedFromExport;t&&(s=s.filter((e=>!e.startsWith("themes/twenty"))).filter((e=>"mu-plugins/sqlite-database-integration"!==e)));const i=phpVars({zipPath:r,wpContentPath:o,documentRoot:n,exceptPaths:s.map((e=>joinPaths(n,"wp-content",e))),additionalPaths:t?{[joinPaths(n,"wp-config.php")]:"wp-config.php"}:{}});await runPhpWithZipFunctions(e,`zipDir(${i.wpContentPath}, ${i.zipPath}, array(\n\t\t\t'exclude_paths' => ${i.exceptPaths},\n\t\t\t'zip_root'      => ${i.documentRoot},\n\t\t\t'additional_paths' => ${i.additionalPaths}\n\t\t));`);const a=await e.readFileAsBuffer(r);return e.unlink(r),a},wpCLI$1=async(e,{command:t,wpCliPath:r="/tmp/wp-cli.phar"})=>{if(!await e.fileExists(r))throw new Error(`wp-cli.phar not found at ${r}`);let n;if("string"==typeof t?n=splitShellCommand(t=t.trim()):n=t,"wp"!==n.shift())throw new Error('The first argument must be "wp".');await e.writeFile("/tmp/stdout",""),await e.writeFile("/tmp/stderr",""),await e.writeFile("/wordpress/run-cli.php",`<?php\n\t\t// Set up the environment to emulate a shell script\n\t\t// call.\n\n\t\t// Set SHELL_PIPE to 0 to ensure WP-CLI formats\n\t\t// the output as ASCII tables.\n\t\t// @see https://github.com/wp-cli/wp-cli/issues/1102\n\t\tputenv( 'SHELL_PIPE=0' );\n\n\t\t// Set the argv global.\n\t\t$GLOBALS['argv'] = array_merge([\n\t\t  "/tmp/wp-cli.phar",\n\t\t  "--path=/wordpress"\n\t\t], ${phpVar(n)});\n\n\t\t// Provide stdin, stdout, stderr streams outside of\n\t\t// the CLI SAPI.\n\t\tdefine('STDIN', fopen('php://stdin', 'rb'));\n\t\tdefine('STDOUT', fopen('php://stdout', 'wb'));\n\t\tdefine('STDERR', fopen('/tmp/stderr', 'wb'));\n\n\t\trequire( ${phpVar(r)} );\n\t\t`);const o=await e.run({scriptPath:"/wordpress/run-cli.php"});if(o.errors)throw new Error(o.errors);return o};function splitShellCommand(e){let t=0,r="";const n=[];let o="";for(let s=0;s<e.length;s++){const i=e[s];0===t?'"'===i||"'"===i?(t=1,r=i):i.match(/\s/)?(o&&n.push(o),o=""):o+=i:1===t&&("\\"===i?(s++,o+=e[s]):i===r?(t=0,r=""):o+=i)}return o&&n.push(o),n}const allStepHandlers=Object.freeze(Object.defineProperty({__proto__:null,activatePlugin:activatePlugin,activateTheme:activateTheme,cp:cp,defineSiteUrl:defineSiteUrl,defineWpConfigConsts:defineWpConfigConsts,enableMultisite:enableMultisite,exportWXR:exportWXR,exportWXZ:exportWXZ,importFile:importFile,importWordPressFiles:importWordPressFiles,installPlugin:installPlugin,installTheme:installTheme,login:login,mkdir:mkdir,mv:mv,request:request,rm:rm,rmdir:rmdir,runPHP:runPHP,runPHPWithOptions:runPHPWithOptions,runSql:runSql,runWpInstallationWizard:runWpInstallationWizard,setPhpIniEntry:setPhpIniEntry,setSiteOptions:setSiteOptions,unzip:unzip,updateUserMeta:updateUserMeta,wpCLI:wpCLI$1,writeFile:writeFile,zipWpContent:zipWpContent},Symbol.toStringTag,{value:"Module"})),FALLBACK_FILE_SIZE=5242880;function cloneResponseMonitorProgress(e,t){const r=e.headers.get("content-length")||"",n=parseInt(r,10)||FALLBACK_FILE_SIZE;function o(e,r){t(new CustomEvent("progress",{detail:{loaded:e,total:r}}))}return new Response(new ReadableStream({async start(t){if(!e.body)return void t.close();const r=e.body.getReader();let s=0;for(;;)try{const{done:e,value:i}=await r.read();if(i&&(s+=i.byteLength),e){o(s,s),t.close();break}o(s,n),t.enqueue(i)}catch(i){console.error({e:i}),t.error(i);break}}}),{status:e.status,statusText:e.statusText,headers:e.headers})}const PROGRESS_EPSILON=1e-5;class ProgressTracker extends EventTarget{constructor({weight:e=1,caption:t="",fillTime:r=4}={}){super(),this._selfWeight=1,this._selfDone=!1,this._selfProgress=0,this._selfCaption="",this._isFilling=!1,this._subTrackers=[],this._weight=e,this._selfCaption=t,this._fillTime=r}stage(e,t=""){if(e||(e=this._selfWeight),this._selfWeight-e<-PROGRESS_EPSILON)throw new Error(`Cannot add a stage with weight ${e} as the total weight of registered stages would exceed 1.`);this._selfWeight-=e;const r=new ProgressTracker({caption:t,weight:e,fillTime:this._fillTime});return this._subTrackers.push(r),r.addEventListener("progress",(()=>this.notifyProgress())),r.addEventListener("done",(()=>{this.done&&this.notifyDone()})),r}fillSlowly({stopBeforeFinishing:e=!0}={}){if(this._isFilling)return;this._isFilling=!0;const t=this._fillTime/100;this._fillInterval=setInterval((()=>{this.set(this._selfProgress+1),e&&this._selfProgress>=99&&clearInterval(this._fillInterval)}),t)}set(e){this._selfProgress=Math.min(e,100),this.notifyProgress(),this._selfProgress+PROGRESS_EPSILON>=100&&this.finish()}finish(){this._fillInterval&&clearInterval(this._fillInterval),this._selfDone=!0,this._selfProgress=100,this._isFilling=!1,this._fillInterval=void 0,this.notifyProgress(),this.notifyDone()}get caption(){for(let e=this._subTrackers.length-1;e>=0;e--)if(!this._subTrackers[e].done){const t=this._subTrackers[e].caption;if(t)return t}return this._selfCaption}setCaption(e){this._selfCaption=e,this.notifyProgress()}get done(){return this.progress+PROGRESS_EPSILON>=100}get progress(){if(this._selfDone)return 100;const e=this._subTrackers.reduce(((e,t)=>e+t.progress*t.weight),this._selfProgress*this._selfWeight);return Math.round(1e4*e)/1e4}get weight(){return this._weight}get observer(){return this._progressObserver||(this._progressObserver=e=>{this.set(e)}),this._progressObserver}get loadingListener(){return this._loadingListener||(this._loadingListener=e=>{this.set(e.detail.loaded/e.detail.total*100)}),this._loadingListener}pipe(e){e.setProgress({progress:this.progress,caption:this.caption}),this.addEventListener("progress",(t=>{e.setProgress({progress:t.detail.progress,caption:t.detail.caption})})),this.addEventListener("done",(()=>{e.setLoaded()}))}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}notifyProgress(){const e=this;this.dispatchEvent(new CustomEvent("progress",{detail:{get progress(){return e.progress},get caption(){return e.caption}}}))}notifyDone(){this.dispatchEvent(new CustomEvent("done"))}}const kError=Symbol("error"),kMessage=Symbol("message");class ErrorEvent2 extends Event{constructor(e,t={}){super(e),this[kError]=void 0===t.error?null:t.error,this[kMessage]=void 0===t.message?"":t.message}get error(){return this[kError]}get message(){return this[kMessage]}}Object.defineProperty(ErrorEvent2.prototype,"error",{enumerable:!0}),Object.defineProperty(ErrorEvent2.prototype,"message",{enumerable:!0});const ErrorEvent="function"==typeof globalThis.ErrorEvent?globalThis.ErrorEvent:ErrorEvent2;function isExitCodeZero(e){return e instanceof Error&&("exitCode"in e&&0===(null==e?void 0:e.exitCode)||"ExitStatus"===(null==e?void 0:e.name)&&"status"in e&&0===e.status)}class UnhandledRejectionsTarget extends EventTarget{constructor(){super(...arguments),this.listenersCount=0}addEventListener(e,t){++this.listenersCount,super.addEventListener(e,t)}removeEventListener(e,t){--this.listenersCount,super.removeEventListener(e,t)}hasListeners(){return this.listenersCount>0}}function improveWASMErrorReporting(e){e.asm={...e.asm};const t=new UnhandledRejectionsTarget;for(const r in e.asm)if("function"==typeof e.asm[r]){const n=e.asm[r];e.asm[r]=function(...r){var o;try{return n(...r)}catch(s){if(!(s instanceof Error))throw s;const r=clarifyErrorMessage(s,null==(o=e.lastAsyncifyStackSource)?void 0:o.stack);if(e.lastAsyncifyStackSource&&(s.cause=e.lastAsyncifyStackSource),t.hasListeners())return void t.dispatchEvent(new ErrorEvent("error",{error:s,message:r}));throw isExitCodeZero(s)||showCriticalErrorBox(r),s}}}return t}let functionsMaybeMissingFromAsyncify=[];function getFunctionsMaybeMissingFromAsyncify(){return functionsMaybeMissingFromAsyncify}function clarifyErrorMessage(e,t){if("unreachable"===e.message){let r=UNREACHABLE_ERROR;t||(r+="\n\nThis stack trace is lacking. For a better one initialize \nthe PHP runtime with { debug: true }, e.g. PHPNode.load('8.1', { debug: true }).\n\n"),functionsMaybeMissingFromAsyncify=extractPHPFunctionsFromStack(t||e.stack||"");for(const e of functionsMaybeMissingFromAsyncify)r+=`    * ${e}\n`;return r}return e.message}const UNREACHABLE_ERROR="\n\"unreachable\" WASM instruction executed.\n\nThe typical reason is a PHP function missing from the ASYNCIFY_ONLY\nlist when building PHP.wasm.\n\nYou will need to file a new issue in the WordPress Playground repository\nand paste this error message there:\n\nhttps://github.com/WordPress/wordpress-playground/issues/new\n\nIf you're a core developer, the typical fix is to:\n\n* Isolate a minimal reproduction of the error\n* Add a reproduction of the error to php-asyncify.spec.ts in the WordPress Playground repository\n* Run 'npm run fix-asyncify'\n* Commit the changes, push to the repo, release updated NPM packages\n\nBelow is a list of all the PHP functions found in the stack trace to\nhelp with the minimal reproduction. If they're all already listed in\nthe Dockerfile, you'll need to trigger this error again with long stack\ntraces enabled. In node.js, you can do it using the --stack-trace-limit=100\nCLI option: \n\n",redBg="\x1b[41m",bold="\x1b[1m",reset="\x1b[0m",eol="\x1b[K";let logged=!1;function showCriticalErrorBox(e){if(!logged&&(logged=!0,null==e||!e.trim().startsWith("Program terminated with exit"))){console.log(`${redBg}\n${eol}\n${bold}  WASM ERROR${reset}${redBg}`);for(const t of e.split("\n"))console.log(`${eol}  ${t} `);console.log(`${reset}`)}}function extractPHPFunctionsFromStack(e){try{const t=e.split("\n").slice(1).map((e=>{const t=e.trim().substring(3).split(" ");return{fn:t.length>=2?t[0]:"<unknown>",isWasm:e.includes("wasm://")}})).filter((({fn:e,isWasm:t})=>t&&!e.startsWith("dynCall_")&&!e.startsWith("invoke_"))).map((({fn:e})=>e));return Array.from(new Set(t))}catch{return[]}}ReadableStream.prototype[Symbol.asyncIterator]||(ReadableStream.prototype[Symbol.asyncIterator]=async function*(){const e=this.getReader();try{for(;;){const{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}},ReadableStream.prototype.iterate=ReadableStream.prototype[Symbol.asyncIterator]);class PHPResponse{constructor(e,t,r,n="",o=0){this.httpStatusCode=e,this.headers=t,this.bytes=r,this.exitCode=o,this.errors=n}static fromRawData(e){return new PHPResponse(e.httpStatusCode,e.headers,e.bytes,e.errors,e.exitCode)}toRawData(){return{headers:this.headers,bytes:this.bytes,errors:this.errors,exitCode:this.exitCode,httpStatusCode:this.httpStatusCode}}get json(){return JSON.parse(this.text)}get text(){return(new TextDecoder).decode(this.bytes)}}const SupportedPHPVersions=["8.3","8.2","8.1","8.0","7.4","7.3","7.2","7.1","7.0"],LatestSupportedPHPVersion=SupportedPHPVersions[0],SupportedPHPVersionsList=SupportedPHPVersions,SupportedPHPExtensionsList=["iconv","mbstring","xml-bundle","gd"],SupportedPHPExtensionBundles={"kitchen-sink":SupportedPHPExtensionsList};var Ae,Ge;class PHPBrowser{constructor(e,t={}){Q(this,Ae,void 0),Q(this,Ge,void 0),this.requestHandler=e,te(this,Ae,{}),te(this,Ge,{handleRedirects:!1,maxRedirects:4,...t})}async request(e,t=0){const r=await this.requestHandler.request({...e,headers:{...e.headers,cookie:this.serializeCookies()}});if(r.headers["set-cookie"]&&this.setCookies(r.headers["set-cookie"]),H(this,Ge).handleRedirects&&r.headers.location&&t<H(this,Ge).maxRedirects){const e=new URL(r.headers.location[0],this.requestHandler.absoluteUrl);return this.request({url:e.toString(),method:"GET",headers:{}},t+1)}return r}pathToInternalUrl(e){return this.requestHandler.pathToInternalUrl(e)}internalUrlToPath(e){return this.requestHandler.internalUrlToPath(e)}get absoluteUrl(){return this.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.documentRoot}setCookies(e){for(const r of e)try{if(!r.includes("="))continue;const e=r.indexOf("="),t=r.substring(0,e),n=r.substring(e+1).split(";")[0];H(this,Ae)[t]=n}catch(t){console.error(t)}}serializeCookies(){const e=[];for(const t in H(this,Ae))e.push(`${t}=${H(this,Ae)[t]}`);return e.join("; ")}}Ae=new WeakMap,Ge=new WeakMap;const DEFAULT_BASE_URL="http://example.com";function toRelativeUrl(e){return e.toString().substring(e.origin.length)}function removePathPrefix(e,t){return t&&e.startsWith(t)?e.substring(t.length):e}function ensurePathPrefix(e,t){return!t||e.startsWith(t)?e:t+e}async function encodeAsMultipart(e){const t=`----${Math.random().toString(36).slice(2)}`,r=`multipart/form-data; boundary=${t}`,n=new TextEncoder,o=[];for(const[c,l]of Object.entries(e))o.push(`--${t}\r\n`),o.push(`Content-Disposition: form-data; name="${c}"`),l instanceof File&&o.push(`; filename="${l.name}"`),o.push("\r\n"),l instanceof File&&(o.push("Content-Type: application/octet-stream"),o.push("\r\n")),o.push("\r\n"),l instanceof File?o.push(await fileToUint8Array(l)):o.push(l),o.push("\r\n");o.push(`--${t}--\r\n`);const s=o.reduce(((e,t)=>e+t.length),0),i=new Uint8Array(s);let a=0;for(const c of o)i.set("string"==typeof c?n.encode(c):c,a),a+=c.length;return{bytes:i,contentType:r}}function fileToUint8Array(e){return new Promise((t=>{const r=new FileReader;r.onload=()=>{t(new Uint8Array(r.result))},r.readAsArrayBuffer(e)}))}var Pe,Ke,dt,De,Je,ve,Qe,Fe,mt,zt,_t,Wt,gt,Bt;class PHPRequestHandler{constructor(e,t={}){Q(this,mt),Q(this,_t),Q(this,gt),Q(this,Pe,void 0),Q(this,Ke,void 0),Q(this,dt,void 0),Q(this,De,void 0),Q(this,Je,void 0),Q(this,ve,void 0),Q(this,Qe,void 0),Q(this,Fe,void 0),te(this,Fe,new Semaphore({concurrency:1}));const{documentRoot:r="/www/",absoluteUrl:n=("object"==typeof location?null==location?void 0:location.href:"")}=t;this.php=e,te(this,Pe,r);const o=new URL(n);te(this,dt,o.hostname),te(this,De,o.port?Number(o.port):"https:"===o.protocol?443:80),te(this,Ke,(o.protocol||"").replace(":",""));const s=443!==H(this,De)&&80!==H(this,De);te(this,Je,[H(this,dt),s?`:${H(this,De)}`:""].join("")),te(this,ve,o.pathname.replace(/\/+$/,"")),te(this,Qe,[`${H(this,Ke)}://`,H(this,Je),H(this,ve)].join(""))}pathToInternalUrl(e){return`${this.absoluteUrl}${e}`}internalUrlToPath(e){const t=new URL(e);return t.pathname.startsWith(H(this,ve))&&(t.pathname=t.pathname.slice(H(this,ve).length)),toRelativeUrl(t)}get isRequestRunning(){return H(this,Fe).running>0}get absoluteUrl(){return H(this,Qe)}get documentRoot(){return H(this,Pe)}async request(e){const t=e.url.startsWith("http://")||e.url.startsWith("https://"),r=new URL(e.url,t?void 0:DEFAULT_BASE_URL),n=removePathPrefix(r.pathname,H(this,ve)),o=`${H(this,Pe)}${n}`;return seemsLikeAPHPRequestHandlerPath(o)?await ce(this,_t,Wt).call(this,e,r):ce(this,mt,zt).call(this,o)}}function inferMimeType(e){switch(e.split(".").pop()){case"css":return"text/css";case"js":return"application/javascript";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"svg":return"image/svg+xml";case"woff":return"font/woff";case"woff2":return"font/woff2";case"ttf":return"font/ttf";case"otf":return"font/otf";case"eot":return"font/eot";case"ico":return"image/x-icon";case"html":return"text/html";case"json":return"application/json";case"xml":return"application/xml";case"txt":case"md":return"text/plain";default:return"application-octet-stream"}}function seemsLikeAPHPRequestHandlerPath(e){return seemsLikeAPHPFile(e)||seemsLikeADirectoryRoot(e)}function seemsLikeAPHPFile(e){return e.endsWith(".php")||e.includes(".php/")}function seemsLikeADirectoryRoot(e){return!e.split("/").pop().includes(".")}Pe=new WeakMap,Ke=new WeakMap,dt=new WeakMap,De=new WeakMap,Je=new WeakMap,ve=new WeakMap,Qe=new WeakMap,Fe=new WeakMap,mt=new WeakSet,zt=function(e){if(!this.php.fileExists(e))return new PHPResponse(404,{"x-file-type":["static"]},(new TextEncoder).encode("404 File not found"));const t=this.php.readFileAsBuffer(e);return new PHPResponse(200,{"content-length":[`${t.byteLength}`],"content-type":[inferMimeType(e)],"accept-ranges":["bytes"],"cache-control":["public, max-age=0"]},t)},_t=new WeakSet,Wt=async function(e,t){var r,n;if(H(this,Fe).running>0&&"php"===(null==(r=e.headers)?void 0:r["x-request-issuer"]))return console.warn("Possible deadlock: Called request() before the previous request() have finished. PHP likely issued an HTTP call to itself. Normally this would lead to infinite waiting as Request 1 holds the lock that the Request 2 is waiting to acquire. That's not useful, so PHPRequestHandler will return error 502 instead."),new PHPResponse(502,{},(new TextEncoder).encode("502 Bad Gateway"));const o=await H(this,Fe).acquire();try{this.php.addServerGlobalEntry("REMOTE_ADDR","127.0.0.1"),this.php.addServerGlobalEntry("DOCUMENT_ROOT",H(this,Pe)),this.php.addServerGlobalEntry("HTTPS",H(this,Qe).startsWith("https://")?"on":"");let r="GET";const o={host:H(this,Je),...normalizeHeaders(e.headers||{})};let s,i=e.body;if("object"==typeof i&&!(i instanceof Uint8Array)){r="POST";const{bytes:e,contentType:t}=await encodeAsMultipart(i);i=e,o["content-type"]=t}try{let r=t.pathname;if(null!=(n=e.headers)&&n["x-rewrite-url"])try{r=new URL(e.headers["x-rewrite-url"]).pathname}catch{}s=ce(this,gt,Bt).call(this,r)}catch{return new PHPResponse(404,{},(new TextEncoder).encode("404 File not found"))}return await this.php.run({relativeUri:ensurePathPrefix(toRelativeUrl(t),H(this,ve)),protocol:H(this,Ke),method:e.method||r,body:i,scriptPath:s,headers:o})}finally{o()}},gt=new WeakSet,Bt=function(e){let t=removePathPrefix(e,H(this,ve));t.includes(".php")?t=t.split(".php")[0]+".php":this.php.isDir(`${H(this,Pe)}${t}`)?(t.endsWith("/")||(t=`${t}/`),t=`${t}index.php`):t="/index.php";const r=`${H(this,Pe)}${t}`;if(this.php.fileExists(r))return r;throw new Error(`File not found: ${r}`)};const FileErrorCodes={0:"No error occurred. System call completed successfully.",1:"Argument list too long.",2:"Permission denied.",3:"Address in use.",4:"Address not available.",5:"Address family not supported.",6:"Resource unavailable, or operation would block.",7:"Connection already in progress.",8:"Bad file descriptor.",9:"Bad message.",10:"Device or resource busy.",11:"Operation canceled.",12:"No child processes.",13:"Connection aborted.",14:"Connection refused.",15:"Connection reset.",16:"Resource deadlock would occur.",17:"Destination address required.",18:"Mathematics argument out of domain of function.",19:"Reserved.",20:"File exists.",21:"Bad address.",22:"File too large.",23:"Host is unreachable.",24:"Identifier removed.",25:"Illegal byte sequence.",26:"Operation in progress.",27:"Interrupted function.",28:"Invalid argument.",29:"I/O error.",30:"Socket is connected.",31:"There is a directory under that path.",32:"Too many levels of symbolic links.",33:"File descriptor value too large.",34:"Too many links.",35:"Message too large.",36:"Reserved.",37:"Filename too long.",38:"Network is down.",39:"Connection aborted by network.",40:"Network unreachable.",41:"Too many files open in system.",42:"No buffer space available.",43:"No such device.",44:"There is no such file or directory OR the parent directory does not exist.",45:"Executable file format error.",46:"No locks available.",47:"Reserved.",48:"Not enough space.",49:"No message of the desired type.",50:"Protocol not available.",51:"No space left on device.",52:"Function not supported.",53:"The socket is not connected.",54:"Not a directory or a symbolic link to a directory.",55:"Directory not empty.",56:"State not recoverable.",57:"Not a socket.",58:"Not supported, or operation not supported on socket.",59:"Inappropriate I/O control operation.",60:"No such device or address.",61:"Value too large to be stored in data type.",62:"Previous owner died.",63:"Operation not permitted.",64:"Broken pipe.",65:"Protocol error.",66:"Protocol not supported.",67:"Protocol wrong type for socket.",68:"Result too large.",69:"Read-only file system.",70:"Invalid seek.",71:"No such process.",72:"Reserved.",73:"Connection timed out.",74:"Text file busy.",75:"Cross-device link.",76:"Extension: Capabilities insufficient."};function getEmscriptenFsError(e){const t="object"==typeof e?null==e?void 0:e.errno:null;if(t in FileErrorCodes)return FileErrorCodes[t]}function rethrowFileSystemError(e=""){return function(t,r,n){const o=n.value;n.value=function(...t){try{return o.apply(this,t)}catch(r){const n="object"==typeof r?null==r?void 0:r.errno:null;if(n in FileErrorCodes){const o=FileErrorCodes[n],s="string"==typeof t[0]?t[0]:null,i=null!==s?e.replaceAll("{path}",s):e;throw new Error(`${i}: ${o}`,{cause:r})}throw r}}}}const loadedRuntimes=new Map;function getLoadedRuntime(e){return loadedRuntimes.get(e)}!function(){var e;typeof process<"u"&&"node"===(null==(e=process.release)?void 0:e.name)||(typeof window<"u"||typeof WorkerGlobalScope<"u"&&(self,WorkerGlobalScope))}();var __defProp=Object.defineProperty,__getOwnPropDesc=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,r,n)=>{for(var o,s=n>1?void 0:n?__getOwnPropDesc(t,r):t,i=e.length-1;i>=0;i--)(o=e[i])&&(s=(n?o(t,r,s):o(s))||s);return n&&s&&__defProp(t,r,s),s};const STRING="string",NUMBER="number",__private__dont__use=Symbol("__private__dont__use");var Me,Ze,Ye,Ee,Re,Te,be,Xe,$t,Gt,yt,Kt,vt,Jt,wt,Qt,Pt,Zt,Et,Yt,bt,Xt,St,er,Rt,tr,Tt,rr,kt,nr,Ct,sr;class BasePHP{constructor(e,t){Q(this,$t),Q(this,yt),Q(this,vt),Q(this,wt),Q(this,Pt),Q(this,Et),Q(this,bt),Q(this,St),Q(this,Rt),Q(this,Tt),Q(this,kt),Q(this,Ct),Q(this,Me,void 0),Q(this,Ze,void 0),Q(this,Ye,void 0),Q(this,Ee,void 0),Q(this,Re,void 0),Q(this,Te,void 0),Q(this,be,void 0),Q(this,Xe,void 0),te(this,Me,[]),te(this,Ee,!1),te(this,Re,null),te(this,Te,{}),te(this,be,new Map),te(this,Xe,[]),this.semaphore=new Semaphore({concurrency:1}),void 0!==e&&this.initializeRuntime(e),t&&(this.requestHandler=new PHPBrowser(new PHPRequestHandler(this,t)))}addEventListener(e,t){H(this,be).has(e)||H(this,be).set(e,new Set),H(this,be).get(e).add(t)}removeEventListener(e,t){var r;null==(r=H(this,be).get(e))||r.delete(t)}dispatchEvent(e){const t=H(this,be).get(e.type);if(t)for(const r of t)r(e)}async onMessage(e){H(this,Xe).push(e)}async setSpawnHandler(handler){"string"==typeof handler&&(handler=createSpawnHandler(eval(handler))),this[__private__dont__use].spawnProcess=handler}get absoluteUrl(){return this.requestHandler.requestHandler.absoluteUrl}get documentRoot(){return this.requestHandler.requestHandler.documentRoot}pathToInternalUrl(e){return this.requestHandler.requestHandler.pathToInternalUrl(e)}internalUrlToPath(e){return this.requestHandler.requestHandler.internalUrlToPath(e)}initializeRuntime(e){if(this[__private__dont__use])throw new Error("PHP runtime already initialized.");const t=getLoadedRuntime(e);if(!t)throw new Error("Invalid PHP runtime id.");this[__private__dont__use]=t,t.onMessage=async e=>{for(const t of H(this,Xe)){const r=await t(e);if(r)return r}return""},te(this,Re,improveWASMErrorReporting(t)),this.dispatchEvent({type:"runtime.initialized"})}async setSapiName(e){if(0!==this[__private__dont__use].ccall("wasm_set_sapi_name",NUMBER,[STRING],[e]))throw new Error("Could not set SAPI name. This can only be done before the PHP WASM module is initialized.Did you already dispatch any requests?");te(this,Ye,e)}setPhpIniPath(e){if(H(this,Ee))throw new Error("Cannot set PHP ini path after calling run().");te(this,Ze,e),this[__private__dont__use].ccall("wasm_set_phpini_path",null,["string"],[e])}setPhpIniEntry(e,t){if(H(this,Ee))throw new Error("Cannot set PHP ini entries after calling run().");H(this,Me).push([e,t])}chdir(e){this[__private__dont__use].FS.chdir(e)}async request(e,t){if(!this.requestHandler)throw new Error("No request handler available.");return this.requestHandler.request(e,t)}async run(e){const t=await this.semaphore.acquire();let r;try{if(H(this,Ee)||(ce(this,$t,Gt).call(this),te(this,Ee,!0)),e.scriptPath&&!this.fileExists(e.scriptPath))throw new Error(`The script path "${e.scriptPath}" does not exist.`);ce(this,St,er).call(this,e.scriptPath||""),ce(this,vt,Jt).call(this,e.relativeUri||""),ce(this,Pt,Zt).call(this,e.method||"GET");const t=normalizeHeaders(e.headers||{}),n=t.host||"example.com:443";ce(this,wt,Qt).call(this,n,e.protocol||"http"),ce(this,Et,Yt).call(this,t),e.body&&(r=ce(this,bt,Xt).call(this,e.body)),"string"==typeof e.code&&ce(this,kt,nr).call(this," ?>"+e.code),ce(this,Rt,tr).call(this);const o=e.env||{};for(const e in o)ce(this,Tt,rr).call(this,e,o[e]);const s=await ce(this,Ct,sr).call(this);if(e.throwOnError&&0!==s.exitCode){const e={stdout:s.text,stderr:s.errors};console.warn("PHP.run() output was:",e);const t=new Error(`PHP.run() failed with exit code ${s.exitCode} and the following output: `+s.errors);throw t.output=e,console.error(t),t}return s}finally{try{r&&this[__private__dont__use].free(r)}finally{t(),this.dispatchEvent({type:"request.end"})}}}addServerGlobalEntry(e,t){H(this,Te)[e]=t}defineConstant(e,t){let r={};try{r=JSON.parse(this.fileExists("/internal/consts.json")&&this.readFileAsText("/internal/consts.json")||"{}")}catch{}this.writeFile("/internal/consts.json",JSON.stringify({...r,[e]:t}))}mkdir(e){this[__private__dont__use].FS.mkdirTree(e)}mkdirTree(e){this.mkdir(e)}readFileAsText(e){return(new TextDecoder).decode(this.readFileAsBuffer(e))}readFileAsBuffer(e){return this[__private__dont__use].FS.readFile(e)}writeFile(e,t){this[__private__dont__use].FS.writeFile(e,t)}unlink(e){this[__private__dont__use].FS.unlink(e)}mv(e,t){try{this[__private__dont__use].FS.rename(e,t)}catch(r){const n=getEmscriptenFsError(r);throw n?new Error(`Could not move ${e} to ${t}: ${n}`,{cause:r}):r}}rmdir(e,t={recursive:!0}){null!=t&&t.recursive&&this.listFiles(e).forEach((r=>{const n=`${e}/${r}`;this.isDir(n)?this.rmdir(n,t):this.unlink(n)})),this[__private__dont__use].FS.rmdir(e)}listFiles(e,t={prependPath:!1}){if(!this.fileExists(e))return[];try{const r=this[__private__dont__use].FS.readdir(e).filter((e=>"."!==e&&".."!==e));if(t.prependPath){const t=e.replace(/\/$/,"");return r.map((e=>`${t}/${e}`))}return r}catch(r){return console.error(r,{path:e}),[]}}isDir(e){return!!this.fileExists(e)&&this[__private__dont__use].FS.isDir(this[__private__dont__use].FS.lookupPath(e).node.mode)}fileExists(e){try{return this[__private__dont__use].FS.lookupPath(e),!0}catch{return!1}}hotSwapPHPRuntime(e){const t=this[__private__dont__use].FS;try{this.exit()}catch{}if(this.initializeRuntime(e),H(this,Ze)&&this.setPhpIniPath(H(this,Ze)),H(this,Ye)&&this.setSapiName(H(this,Ye)),this.requestHandler){const e=this.documentRoot;copyFS(t,this[__private__dont__use].FS,e)}}exit(e=0){this.dispatchEvent({type:"runtime.beforedestroy"});try{this[__private__dont__use]._exit(e)}catch{}te(this,Ee,!1),te(this,Re,null),delete this[__private__dont__use].onMessage,delete this[__private__dont__use]}}function normalizeHeaders(e){const t={};for(const r in e)t[r.toLowerCase()]=e[r];return t}function copyFS(e,t,r){let n;try{n=e.lookupPath(r)}catch{return}if(!("contents"in n.node))return;if(!e.isDir(n.node.mode))return void t.writeFile(r,e.readFile(r));t.mkdirTree(r);const o=e.readdir(r).filter((e=>"."!==e&&".."!==e));for(const s of o)copyFS(e,t,joinPaths(r,s))}Me=new WeakMap,Ze=new WeakMap,Ye=new WeakMap,Ee=new WeakMap,Re=new WeakMap,Te=new WeakMap,be=new WeakMap,Xe=new WeakMap,$t=new WeakSet,Gt=function(){if(this.setPhpIniEntry("auto_prepend_file","/internal/consts.php"),this.fileExists("/internal/consts.php")||this.writeFile("/internal/consts.php","<?php\n\t\t\t\tif(file_exists('/internal/consts.json')) {\n\t\t\t\t\t$consts = json_decode(file_get_contents('/internal/consts.json'), true);\n\t\t\t\t\tforeach ($consts as $const => $value) {\n\t\t\t\t\t\tif (!defined($const) && is_scalar($value)) {\n\t\t\t\t\t\t\tdefine($const, $value);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}"),H(this,Me).length>0){const e=H(this,Me).map((([e,t])=>`${e}=${t}`)).join("\n")+"\n\n";this[__private__dont__use].ccall("wasm_set_phpini_entries",null,[STRING],[e])}this[__private__dont__use].ccall("php_wasm_init",null,[],[])},yt=new WeakSet,Kt=function(){const e="/internal/headers.json";if(!this.fileExists(e))throw new Error("SAPI Error: Could not find response headers file.");const t=JSON.parse(this.readFileAsText(e)),r={};for(const n of t.headers){if(!n.includes(": "))continue;const e=n.indexOf(": "),t=n.substring(0,e).toLowerCase(),o=n.substring(e+2);t in r||(r[t]=[]),r[t].push(o)}return{headers:r,httpStatusCode:t.status}},vt=new WeakSet,Jt=function(e){if(this[__private__dont__use].ccall("wasm_set_request_uri",null,[STRING],[e]),e.includes("?")){const t=e.substring(e.indexOf("?")+1);this[__private__dont__use].ccall("wasm_set_query_string",null,[STRING],[t])}},wt=new WeakSet,Qt=function(e,t){let r;this[__private__dont__use].ccall("wasm_set_request_host",null,[STRING],[e]);try{r=parseInt(new URL(e).port,10)}catch{}(!r||isNaN(r)||80===r)&&(r="https"===t?443:80),this[__private__dont__use].ccall("wasm_set_request_port",null,[NUMBER],[r]),("https"===t||!t&&443===r)&&this.addServerGlobalEntry("HTTPS","on")},Pt=new WeakSet,Zt=function(e){this[__private__dont__use].ccall("wasm_set_request_method",null,[STRING],[e])},Et=new WeakSet,Yt=function(e){e.cookie&&this[__private__dont__use].ccall("wasm_set_cookies",null,[STRING],[e.cookie]),e["content-type"]&&this[__private__dont__use].ccall("wasm_set_content_type",null,[STRING],[e["content-type"]]),e["content-length"]&&this[__private__dont__use].ccall("wasm_set_content_length",null,[NUMBER],[parseInt(e["content-length"],10)]);for(const t in e){let r="HTTP_";["content-type","content-length"].includes(t.toLowerCase())&&(r=""),this.addServerGlobalEntry(`${r}${t.toUpperCase().replace(/-/g,"_")}`,e[t])}},bt=new WeakSet,Xt=function(e){let t,r;"string"==typeof e?(console.warn("Passing a string as the request body is deprecated. Please use a Uint8Array instead. See https://github.com/WordPress/wordpress-playground/issues/997 for more details"),r=this[__private__dont__use].lengthBytesUTF8(e),t=r+1):(r=e.byteLength,t=e.byteLength);const n=this[__private__dont__use].malloc(t);if(!n)throw new Error("Could not allocate memory for the request body.");return"string"==typeof e?this[__private__dont__use].stringToUTF8(e,n,t+1):this[__private__dont__use].HEAPU8.set(e,n),this[__private__dont__use].ccall("wasm_set_request_body",null,[NUMBER],[n]),this[__private__dont__use].ccall("wasm_set_content_length",null,[NUMBER],[r]),n},St=new WeakSet,er=function(e){this[__private__dont__use].ccall("wasm_set_path_translated",null,[STRING],[e])},Rt=new WeakSet,tr=function(){for(const e in H(this,Te))this[__private__dont__use].ccall("wasm_add_SERVER_entry",null,[STRING,STRING],[e,H(this,Te)[e]])},Tt=new WeakSet,rr=function(e,t){this[__private__dont__use].ccall("wasm_add_ENV_entry",null,[STRING,STRING],[e,t])},kt=new WeakSet,nr=function(e){this[__private__dont__use].ccall("wasm_set_php_code",null,[STRING],[e])},Ct=new WeakSet,sr=async function(){var e;let t,r;try{t=await new Promise(((e,t)=>{var n;r=e=>{console.error(e),console.error(e.error);const r=new Error("Rethrown");r.cause=e.error,r.betterMessage=e.message,t(r)},null==(n=H(this,Re))||n.addEventListener("error",r);const o=this[__private__dont__use].ccall("wasm_sapi_handle_request",NUMBER,[],[],{async:!0});return o instanceof Promise?o.then(e,t):e(o)}))}catch(s){for(const n in this)"function"==typeof this[n]&&(this[n]=()=>{throw new Error("PHP runtime has crashed \u2013 see the earlier error for details.")});this.functionsMaybeMissingFromAsyncify=getFunctionsMaybeMissingFromAsyncify();const e=s,t="betterMessage"in e?e.betterMessage:e.message,r=new Error(t);throw r.cause=e,console.error(r),r}finally{null==(e=H(this,Re))||e.removeEventListener("error",r),te(this,Te,{})}const{headers:n,httpStatusCode:o}=ce(this,yt,Kt).call(this);return new PHPResponse(o,n,this.readFileAsBuffer("/internal/stdout"),this.readFileAsText("/internal/stderr"),t)},__decorateClass([rethrowFileSystemError('Could not create directory "{path}"')],BasePHP.prototype,"mkdir",1),__decorateClass([rethrowFileSystemError('Could not create directory "{path}"')],BasePHP.prototype,"mkdirTree",1),__decorateClass([rethrowFileSystemError('Could not read "{path}"')],BasePHP.prototype,"readFileAsText",1),__decorateClass([rethrowFileSystemError('Could not read "{path}"')],BasePHP.prototype,"readFileAsBuffer",1),__decorateClass([rethrowFileSystemError('Could not write to "{path}"')],BasePHP.prototype,"writeFile",1),__decorateClass([rethrowFileSystemError('Could not unlink "{path}"')],BasePHP.prototype,"unlink",1),__decorateClass([rethrowFileSystemError('Could not remove directory "{path}"')],BasePHP.prototype,"rmdir",1),__decorateClass([rethrowFileSystemError('Could not list files in "{path}"')],BasePHP.prototype,"listFiles",1),__decorateClass([rethrowFileSystemError('Could not stat "{path}"')],BasePHP.prototype,"isDir",1),__decorateClass([rethrowFileSystemError('Could not stat "{path}"')],BasePHP.prototype,"fileExists",1);const ResourceTypes=["vfs","literal","wordpress.org/themes","wordpress.org/plugins","url"];function isFileReference(e){return e&&"object"==typeof e&&"string"==typeof e.resource&&ResourceTypes.includes(e.resource)}class Resource{static create(e,{semaphore:t,progress:r}){let n;switch(e.resource){case"vfs":n=new VFSResource(e,r);break;case"literal":n=new LiteralResource(e,r);break;case"wordpress.org/themes":n=new CoreThemeResource(e,r);break;case"wordpress.org/plugins":n=new CorePluginResource(e,r);break;case"url":n=new UrlResource(e,r);break;default:throw new Error(`Invalid resource: ${e}`)}return n=new CachedResource(n),t&&(n=new SemaphoreResource(n,t)),n}setPlayground(e){this.playground=e}get isAsync(){return!1}}class VFSResource extends Resource{constructor(e,t){super(),this.resource=e,this.progress=t}async resolve(){var e;const t=await this.playground.readFileAsBuffer(this.resource.path);return null==(e=this.progress)||e.set(100),new File([t],this.name)}get name(){return this.resource.path.split("/").pop()||""}}class LiteralResource extends Resource{constructor(e,t){super(),this.resource=e,this.progress=t}async resolve(){var e;return null==(e=this.progress)||e.set(100),new File([this.resource.contents],this.resource.name)}get name(){return this.resource.name}}class FetchResource extends Resource{constructor(e){super(),this.progress=e}async resolve(){var e,t;null==(e=this.progress)||e.setCaption(this.caption);const r=this.getURL();let n=await fetch(r);if(n=await cloneResponseMonitorProgress(n,(null==(t=this.progress)?void 0:t.loadingListener)??noop),200!==n.status)throw new Error(`Could not download "${r}"`);return new File([await n.blob()],this.name)}get caption(){return`Downloading ${this.name}`}get name(){try{return new URL(this.getURL(),"http://example.com").pathname.split("/").pop()}catch{return this.getURL()}}get isAsync(){return!0}}const noop=()=>{};class UrlResource extends FetchResource{constructor(e,t){super(t),this.resource=e}getURL(){return this.resource.url}get caption(){return this.resource.caption??super.caption}}class CoreThemeResource extends FetchResource{constructor(e,t){super(t),this.resource=e}get name(){return zipNameToHumanName(this.resource.slug)}getURL(){return`https://downloads.wordpress.org/theme/${toDirectoryZipName(this.resource.slug)}`}}class CorePluginResource extends FetchResource{constructor(e,t){super(t),this.resource=e}get name(){return zipNameToHumanName(this.resource.slug)}getURL(){return`https://downloads.wordpress.org/plugin/${toDirectoryZipName(this.resource.slug)}`}}function toDirectoryZipName(e){return!e||e.endsWith(".zip")?e:e+".latest-stable.zip"}class DecoratedResource extends Resource{constructor(e){super(),this.resource=e}async resolve(){return this.resource.resolve()}async setPlayground(e){return this.resource.setPlayground(e)}get progress(){return this.resource.progress}set progress(e){this.resource.progress=e}get name(){return this.resource.name}get isAsync(){return this.resource.isAsync}}class CachedResource extends DecoratedResource{async resolve(){return this.promise||(this.promise=super.resolve()),this.promise}}class SemaphoreResource extends DecoratedResource{constructor(e,t){super(e),this.semaphore=t}async resolve(){return this.isAsync?this.semaphore.run((()=>super.resolve())):super.resolve()}}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ajv$1={exports:{}},core$2={},validate={},boolSchema={},errors={},codegen={},code$1={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(t){if(super(),!e.IDENTIFIER.test(t))throw new Error("CodeGen: name must be a valid identifier");this.str=t}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(e){super(),this._items="string"==typeof e?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const e=this._items[0];return""===e||'""'===e}get str(){var e;return null!==(e=this._str)&&void 0!==e?e:this._str=this._items.reduce(((e,t)=>`${e}${t}`),"")}get names(){var e;return null!==(e=this._names)&&void 0!==e?e:this._names=this._items.reduce(((e,t)=>(t instanceof r&&(e[t.str]=(e[t.str]||0)+1),e)),{})}}function o(e,...t){const r=[e[0]];let o=0;for(;o<t.length;)a(r,t[o]),r.push(e[++o]);return new n(r)}e._Code=n,e.nil=new n(""),e._=o;const s=new n("+");function i(e,...t){const r=[l(e[0])];let o=0;for(;o<t.length;)r.push(s),a(r,t[o]),r.push(s,l(e[++o]));return function(e){let t=1;for(;t<e.length-1;){if(e[t]===s){const r=c(e[t-1],e[t+1]);if(void 0!==r){e.splice(t-1,3,r);continue}e[t++]="+"}t++}}(r),new n(r)}function a(e,t){t instanceof n?e.push(...t._items):t instanceof r?e.push(t):e.push(function(e){return"number"==typeof e||"boolean"==typeof e||null===e?e:l(Array.isArray(e)?e.join(","):e)}(t))}function c(e,t){return'""'===t?e:'""'===e?t:"string"==typeof e?t instanceof r||'"'!==e[e.length-1]?void 0:"string"!=typeof t?`${e.slice(0,-1)}${t}"`:'"'===t[0]?e.slice(0,-1)+t.slice(1):void 0:"string"!=typeof t||'"'!==t[0]||e instanceof r?void 0:`"${e}${t.slice(1)}`}function l(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.str=i,e.addCodeArg=a,e.strConcat=function(e,t){return t.emptyStr()?e:e.emptyStr()?t:i`${e}${t}`},e.stringify=function(e){return new n(l(e))},e.safeStringify=l,e.getProperty=function(t){return"string"==typeof t&&e.IDENTIFIER.test(t)?new n(`.${t}`):o`[${t}]`},e.getEsmExportName=function(t){if("string"==typeof t&&e.IDENTIFIER.test(t))return new n(`${t}`);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)},e.regexpCode=function(e){return new n(e.toString())}}(code$1);var scope={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=code$1;class r extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}}var n,o;(o=n=e.UsedValueState||(e.UsedValueState={}))[o.Started=0]="Started",o[o.Completed=1]="Completed",e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class s{constructor({prefixes:e,parent:t}={}){this._names={},this._prefixes=e,this._parent=t}toName(e){return e instanceof t.Name?e:this.name(e)}name(e){return new t.Name(this._newName(e))}_newName(e){return`${e}${(this._names[e]||this._nameGroup(e)).index++}`}_nameGroup(e){var t,r;if(null!==(r=null===(t=this._parent)||void 0===t?void 0:t._prefixes)&&void 0!==r&&r.has(e)||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}}e.Scope=s;class i extends t.Name{constructor(e,t){super(t),this.prefix=e}setValue(e,{property:r,itemIndex:n}){this.value=e,this.scopePath=t._`.${new t.Name(r)}[${n}]`}}e.ValueScopeName=i;const a=t._`\n`;e.ValueScope=class extends s{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?a:t.nil}}get(){return this._scope}name(e){return new i(e,this._newName(e))}value(e,t){var r;if(void 0===t.ref)throw new Error("CodeGen: ref must be passed in value");const n=this.toName(e),{prefix:o}=n,s=null!==(r=t.key)&&void 0!==r?r:t.ref;let i=this._values[o];if(i){const e=i.get(s);if(e)return e}else i=this._values[o]=new Map;i.set(s,n);const a=this._scope[o]||(this._scope[o]=[]),c=a.length;return a[c]=t.ref,n.setValue(t,{property:o,itemIndex:c}),n}getValue(e,t){const r=this._values[e];if(r)return r.get(t)}scopeRefs(e,r=this._values){return this._reduceValues(r,(r=>{if(void 0===r.scopePath)throw new Error(`CodeGen: name "${r}" has no value`);return t._`${e}${r.scopePath}`}))}scopeCode(e=this._values,t,r){return this._reduceValues(e,(e=>{if(void 0===e.value)throw new Error(`CodeGen: name "${e}" has no value`);return e.value.code}),t,r)}_reduceValues(o,s,i={},a){let c=t.nil;for(const l in o){const d=o[l];if(!d)continue;const p=i[l]=i[l]||new Map;d.forEach((o=>{if(p.has(o))return;p.set(o,n.Started);let i=s(o);if(i){const r=this.opts.es5?e.varKinds.var:e.varKinds.const;c=t._`${c}${r} ${o} = ${i};${this.opts._n}`}else{if(!(i=null==a?void 0:a(o)))throw new r(o);c=t._`${c}${i}${this.opts._n}`}p.set(o,n.Completed)}))}return c}}}(scope),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=code$1,r=scope;var n=code$1;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var o=scope;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return o.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return o.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return o.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return o.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class s{optimizeNodes(){return this}optimizeNames(e,t){return this}}class i extends s{constructor(e,t,r){super(),this.varKind=e,this.name=t,this.rhs=r}render({es5:e,_n:t}){const n=e?r.varKinds.var:this.varKind,o=void 0===this.rhs?"":` = ${this.rhs}`;return`${n} ${this.name}${o};`+t}optimizeNames(e,t){if(e[this.name.str])return this.rhs&&(this.rhs=C(this.rhs,e,t)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class a extends s{constructor(e,t,r){super(),this.lhs=e,this.rhs=t,this.sideEffects=r}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,r){if(!(this.lhs instanceof t.Name)||e[this.lhs.str]||this.sideEffects)return this.rhs=C(this.rhs,e,r),this}get names(){return R(this.lhs instanceof t.Name?{}:{...this.lhs.names},this.rhs)}}class c extends a{constructor(e,t,r,n){super(e,r,n),this.op=t}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}}class l extends s{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`${this.label}:`+e}}class d extends s{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?` ${this.label}`:""};`+e}}class p extends s{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}}class u extends s{constructor(e){super(),this.code=e}render({_n:e}){return`${this.code};`+e}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(e,t){return this.code=C(this.code,e,t),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class h extends s{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce(((t,r)=>t+r.render(e)),"")}optimizeNodes(){const{nodes:e}=this;let t=e.length;for(;t--;){const r=e[t].optimizeNodes();Array.isArray(r)?e.splice(t,1,...r):r?e[t]=r:e.splice(t,1)}return e.length>0?this:void 0}optimizeNames(e,t){const{nodes:r}=this;let n=r.length;for(;n--;){const o=r[n];o.optimizeNames(e,t)||(x(e,o.names),r.splice(n,1))}return r.length>0?this:void 0}get names(){return this.nodes.reduce(((e,t)=>T(e,t.names)),{})}}class f extends h{render(e){return"{"+e._n+super.render(e)+"}"+e._n}}class m extends h{}class g extends f{}g.kind="else";class y extends f{constructor(e,t){super(t),this.condition=e}render(e){let t=`if(${this.condition})`+super.render(e);return this.else&&(t+="else "+this.else.render(e)),t}optimizeNodes(){super.optimizeNodes();const e=this.condition;if(!0===e)return this.nodes;let t=this.else;if(t){const e=t.optimizeNodes();t=this.else=Array.isArray(e)?new g(e):e}return t?!1===e?t instanceof y?t:t.nodes:this.nodes.length?this:new y(j(e),t instanceof y?[t]:t.nodes):!1!==e&&this.nodes.length?this:void 0}optimizeNames(e,t){var r;if(this.else=null===(r=this.else)||void 0===r?void 0:r.optimizeNames(e,t),super.optimizeNames(e,t)||this.else)return this.condition=C(this.condition,e,t),this}get names(){const e=super.names;return R(e,this.condition),this.else&&T(e,this.else.names),e}}y.kind="if";class _ extends f{}_.kind="for";class $ extends _{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iteration=C(this.iteration,e,t),this}get names(){return T(super.names,this.iteration.names)}}class v extends _{constructor(e,t,r,n){super(),this.varKind=e,this.name=t,this.from=r,this.to=n}render(e){const t=e.es5?r.varKinds.var:this.varKind,{name:n,from:o,to:s}=this;return`for(${t} ${n}=${o}; ${n}<${s}; ${n}++)`+super.render(e)}get names(){const e=R(super.names,this.from);return R(e,this.to)}}class w extends _{constructor(e,t,r,n){super(),this.loop=e,this.varKind=t,this.name=r,this.iterable=n}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iterable=C(this.iterable,e,t),this}get names(){return T(super.names,this.iterable.names)}}class b extends f{constructor(e,t,r){super(),this.name=e,this.args=t,this.async=r}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}}b.kind="func";class P extends h{render(e){return"return "+super.render(e)}}P.kind="return";class E extends f{render(e){let t="try"+super.render(e);return this.catch&&(t+=this.catch.render(e)),this.finally&&(t+=this.finally.render(e)),t}optimizeNodes(){var e,t;return super.optimizeNodes(),null===(e=this.catch)||void 0===e||e.optimizeNodes(),null===(t=this.finally)||void 0===t||t.optimizeNodes(),this}optimizeNames(e,t){var r,n;return super.optimizeNames(e,t),null===(r=this.catch)||void 0===r||r.optimizeNames(e,t),null===(n=this.finally)||void 0===n||n.optimizeNames(e,t),this}get names(){const e=super.names;return this.catch&&T(e,this.catch.names),this.finally&&T(e,this.finally.names),e}}class S extends f{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}}S.kind="catch";class k extends f{render(e){return"finally"+super.render(e)}}k.kind="finally";function T(e,t){for(const r in t)e[r]=(e[r]||0)+(t[r]||0);return e}function R(e,r){return r instanceof t._CodeOrName?T(e,r.names):e}function C(e,r,n){return e instanceof t.Name?s(e):(o=e)instanceof t._Code&&o._items.some((e=>e instanceof t.Name&&1===r[e.str]&&void 0!==n[e.str]))?new t._Code(e._items.reduce(((e,r)=>(r instanceof t.Name&&(r=s(r)),r instanceof t._Code?e.push(...r._items):e.push(r),e)),[])):e;var o;function s(e){const t=n[e.str];return void 0===t||1!==r[e.str]?e:(delete r[e.str],t)}}function x(e,t){for(const r in t)e[r]=(e[r]||0)-(t[r]||0)}function j(e){return"boolean"==typeof e||"number"==typeof e||null===e?!e:t._`!${A(e)}`}e.CodeGen=class{constructor(e,t={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...t,_n:t.lines?"\n":""},this._extScope=e,this._scope=new r.Scope({parent:e}),this._nodes=[new m]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,t){const r=this._extScope.value(e,t);return(this._values[r.prefix]||(this._values[r.prefix]=new Set)).add(r),r}getScopeValue(e,t){return this._extScope.getValue(e,t)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,t,r,n){const o=this._scope.toName(t);return void 0!==r&&n&&(this._constants[o.str]=r),this._leafNode(new i(e,o,r)),o}const(e,t,n){return this._def(r.varKinds.const,e,t,n)}let(e,t,n){return this._def(r.varKinds.let,e,t,n)}var(e,t,n){return this._def(r.varKinds.var,e,t,n)}assign(e,t,r){return this._leafNode(new a(e,t,r))}add(t,r){return this._leafNode(new c(t,e.operators.ADD,r))}code(e){return"function"==typeof e?e():e!==t.nil&&this._leafNode(new u(e)),this}object(...e){const r=["{"];for(const[n,o]of e)r.length>1&&r.push(","),r.push(n),(n!==o||this.opts.es5)&&(r.push(":"),(0,t.addCodeArg)(r,o));return r.push("}"),new t._Code(r)}if(e,t,r){if(this._blockNode(new y(e)),t&&r)this.code(t).else().code(r).endIf();else if(t)this.code(t).endIf();else if(r)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new y(e))}else(){return this._elseNode(new g)}endIf(){return this._endBlockNode(y,g)}_for(e,t){return this._blockNode(e),t&&this.code(t).endFor(),this}for(e,t){return this._for(new $(e),t)}forRange(e,t,n,o,s=(this.opts.es5?r.varKinds.var:r.varKinds.let)){const i=this._scope.toName(e);return this._for(new v(s,i,t,n),(()=>o(i)))}forOf(e,n,o,s=r.varKinds.const){const i=this._scope.toName(e);if(this.opts.es5){const e=n instanceof t.Name?n:this.var("_arr",n);return this.forRange("_i",0,t._`${e}.length`,(r=>{this.var(i,t._`${e}[${r}]`),o(i)}))}return this._for(new w("of",s,i,n),(()=>o(i)))}forIn(e,n,o,s=(this.opts.es5?r.varKinds.var:r.varKinds.const)){if(this.opts.ownProperties)return this.forOf(e,t._`Object.keys(${n})`,o);const i=this._scope.toName(e);return this._for(new w("in",s,i,n),(()=>o(i)))}endFor(){return this._endBlockNode(_)}label(e){return this._leafNode(new l(e))}break(e){return this._leafNode(new d(e))}return(e){const t=new P;if(this._blockNode(t),this.code(e),1!==t.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(P)}try(e,t,r){if(!t&&!r)throw new Error('CodeGen: "try" without "catch" and "finally"');const n=new E;if(this._blockNode(n),this.code(e),t){const e=this.name("e");this._currNode=n.catch=new S(e),t(e)}return r&&(this._currNode=n.finally=new k,this.code(r)),this._endBlockNode(S,k)}throw(e){return this._leafNode(new p(e))}block(e,t){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(t),this}endBlock(e){const t=this._blockStarts.pop();if(void 0===t)throw new Error("CodeGen: not in self-balancing block");const r=this._nodes.length-t;if(r<0||void 0!==e&&r!==e)throw new Error(`CodeGen: wrong number of nodes: ${r} vs ${e} expected`);return this._nodes.length=t,this}func(e,r=t.nil,n,o){return this._blockNode(new b(e,r,n)),o&&this.code(o).endFunc(),this}endFunc(){return this._endBlockNode(b)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,t){const r=this._currNode;if(r instanceof e||t&&r instanceof t)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${t?`${e.kind}/${t.kind}`:e.kind}"`)}_elseNode(e){const t=this._currNode;if(!(t instanceof y))throw new Error('CodeGen: "else" without "if"');return this._currNode=t.else=e,this}get _root(){return this._nodes[0]}get _currNode(){const e=this._nodes;return e[e.length-1]}set _currNode(e){const t=this._nodes;t[t.length-1]=e}},e.not=j;const N=I(e.operators.AND);e.and=function(...e){return e.reduce(N)};const O=I(e.operators.OR);function I(e){return(r,n)=>r===t.nil?n:n===t.nil?r:t._`${A(r)} ${e} ${A(n)}`}function A(e){return e instanceof t.Name?e:t._`(${e})`}e.or=function(...e){return e.reduce(O)}}(codegen);var util={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.checkStrictMode=e.getErrorPath=e.Type=e.useFunc=e.setEvaluated=e.evaluatedPropsToName=e.mergeEvaluated=e.eachItem=e.unescapeJsonPointer=e.escapeJsonPointer=e.escapeFragment=e.unescapeFragment=e.schemaRefOrVal=e.schemaHasRulesButRef=e.schemaHasRules=e.checkUnknownRules=e.alwaysValidSchema=e.toHash=void 0;const t=codegen,r=code$1;function n(e,t=e.schema){const{opts:r,self:n}=e;if(!r.strictSchema||"boolean"==typeof t)return;const o=n.RULES.keywords;for(const s in t)o[s]||h(e,`unknown keyword: "${s}"`)}function o(e,t){if("boolean"==typeof e)return!e;for(const r in e)if(t[r])return!0;return!1}function s(e){return"number"==typeof e?`${e}`:e.replace(/~/g,"~0").replace(/\//g,"~1")}function i(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function a({mergeNames:e,mergeToName:r,mergeValues:n,resultToName:o}){return(s,i,a,c)=>{const l=void 0===a?i:a instanceof t.Name?(i instanceof t.Name?e(s,i,a):r(s,i,a),a):i instanceof t.Name?(r(s,a,i),i):n(i,a);return c!==t.Name||l instanceof t.Name?l:o(s,l)}}function c(e,r){if(!0===r)return e.var("props",!0);const n=e.var("props",t._`{}`);return void 0!==r&&l(e,n,r),n}function l(e,r,n){Object.keys(n).forEach((n=>e.assign(t._`${r}${(0,t.getProperty)(n)}`,!0)))}e.toHash=function(e){const t={};for(const r of e)t[r]=!0;return t},e.alwaysValidSchema=function(e,t){return"boolean"==typeof t?t:0===Object.keys(t).length||(n(e,t),!o(t,e.self.RULES.all))},e.checkUnknownRules=n,e.schemaHasRules=o,e.schemaHasRulesButRef=function(e,t){if("boolean"==typeof e)return!e;for(const r in e)if("$ref"!==r&&t.all[r])return!0;return!1},e.schemaRefOrVal=function({topSchemaRef:e,schemaPath:r},n,o,s){if(!s){if("number"==typeof n||"boolean"==typeof n)return n;if("string"==typeof n)return t._`${n}`}return t._`${e}${r}${(0,t.getProperty)(o)}`},e.unescapeFragment=function(e){return i(decodeURIComponent(e))},e.escapeFragment=function(e){return encodeURIComponent(s(e))},e.escapeJsonPointer=s,e.unescapeJsonPointer=i,e.eachItem=function(e,t){if(Array.isArray(e))for(const r of e)t(r);else t(e)},e.mergeEvaluated={props:a({mergeNames:(e,r,n)=>e.if(t._`${n} !== true && ${r} !== undefined`,(()=>{e.if(t._`${r} === true`,(()=>e.assign(n,!0)),(()=>e.assign(n,t._`${n} || {}`).code(t._`Object.assign(${n}, ${r})`)))})),mergeToName:(e,r,n)=>e.if(t._`${n} !== true`,(()=>{!0===r?e.assign(n,!0):(e.assign(n,t._`${n} || {}`),l(e,n,r))})),mergeValues:(e,t)=>!0===e||{...e,...t},resultToName:c}),items:a({mergeNames:(e,r,n)=>e.if(t._`${n} !== true && ${r} !== undefined`,(()=>e.assign(n,t._`${r} === true ? true : ${n} > ${r} ? ${n} : ${r}`))),mergeToName:(e,r,n)=>e.if(t._`${n} !== true`,(()=>e.assign(n,!0===r||t._`${n} > ${r} ? ${n} : ${r}`))),mergeValues:(e,t)=>!0===e||Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})},e.evaluatedPropsToName=c,e.setEvaluated=l;const d={};var p,u;function h(e,t,r=e.opts.strictSchema){if(r){if(t=`strict mode: ${t}`,!0===r)throw new Error(t);e.self.logger.warn(t)}}e.useFunc=function(e,t){return e.scopeValue("func",{ref:t,code:d[t.code]||(d[t.code]=new r._Code(t.code))})},(u=p=e.Type||(e.Type={}))[u.Num=0]="Num",u[u.Str=1]="Str",e.getErrorPath=function(e,r,n){if(e instanceof t.Name){const o=r===p.Num;return n?o?t._`"[" + ${e} + "]"`:t._`"['" + ${e} + "']"`:o?t._`"/" + ${e}`:t._`"/" + ${e}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return n?(0,t.getProperty)(e).toString():"/"+s(e)},e.checkStrictMode=h}(util);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$t=codegen,names={data:new codegen_1$t.Name("data"),valCxt:new codegen_1$t.Name("valCxt"),instancePath:new codegen_1$t.Name("instancePath"),parentData:new codegen_1$t.Name("parentData"),parentDataProperty:new codegen_1$t.Name("parentDataProperty"),rootData:new codegen_1$t.Name("rootData"),dynamicAnchors:new codegen_1$t.Name("dynamicAnchors"),vErrors:new codegen_1$t.Name("vErrors"),errors:new codegen_1$t.Name("errors"),this:new codegen_1$t.Name("this"),self:new codegen_1$t.Name("self"),scope:new codegen_1$t.Name("scope"),json:new codegen_1$t.Name("json"),jsonPos:new codegen_1$t.Name("jsonPos"),jsonLen:new codegen_1$t.Name("jsonLen"),jsonPart:new codegen_1$t.Name("jsonPart")};names$1.default=names,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=codegen,r=util,n=names$1;function o(e,r){const o=e.const("err",r);e.if(t._`${n.default.vErrors} === null`,(()=>e.assign(n.default.vErrors,t._`[${o}]`)),t._`${n.default.vErrors}.push(${o})`),e.code(t._`${n.default.errors}++`)}function s(e,r){const{gen:n,validateName:o,schemaEnv:s}=e;s.$async?n.throw(t._`new ${e.ValidationError}(${r})`):(n.assign(t._`${o}.errors`,r),n.return(!1))}e.keywordError={message:({keyword:e})=>t.str`must pass "${e}" keyword validation`},e.keyword$DataError={message:({keyword:e,schemaType:r})=>r?t.str`"${e}" keyword must be ${r} ($data)`:t.str`"${e}" keyword is invalid ($data)`},e.reportError=function(r,n=e.keywordError,i,c){const{it:l}=r,{gen:d,compositeRule:p,allErrors:u}=l,h=a(r,n,i);c??(p||u)?o(d,h):s(l,t._`[${h}]`)},e.reportExtraError=function(t,r=e.keywordError,i){const{it:c}=t,{gen:l,compositeRule:d,allErrors:p}=c;o(l,a(t,r,i)),d||p||s(c,n.default.vErrors)},e.resetErrorsCount=function(e,r){e.assign(n.default.errors,r),e.if(t._`${n.default.vErrors} !== null`,(()=>e.if(r,(()=>e.assign(t._`${n.default.vErrors}.length`,r)),(()=>e.assign(n.default.vErrors,null)))))},e.extendErrors=function({gen:e,keyword:r,schemaValue:o,data:s,errsCount:i,it:a}){if(void 0===i)throw new Error("ajv implementation error");const c=e.name("err");e.forRange("i",i,n.default.errors,(i=>{e.const(c,t._`${n.default.vErrors}[${i}]`),e.if(t._`${c}.instancePath === undefined`,(()=>e.assign(t._`${c}.instancePath`,(0,t.strConcat)(n.default.instancePath,a.errorPath)))),e.assign(t._`${c}.schemaPath`,t.str`${a.errSchemaPath}/${r}`),a.opts.verbose&&(e.assign(t._`${c}.schema`,o),e.assign(t._`${c}.data`,s))}))};const i={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function a(e,r,o){const{createErrors:s}=e.it;return!1===s?t._`{}`:function(e,r,o={}){const{gen:s,it:a}=e,d=[c(a,o),l(e,o)];return function(e,{params:r,message:o},s){const{keyword:a,data:c,schemaValue:l,it:d}=e,{opts:p,propertyName:u,topSchemaRef:h,schemaPath:f}=d;s.push([i.keyword,a],[i.params,"function"==typeof r?r(e):r||t._`{}`]),p.messages&&s.push([i.message,"function"==typeof o?o(e):o]),p.verbose&&s.push([i.schema,l],[i.parentSchema,t._`${h}${f}`],[n.default.data,c]),u&&s.push([i.propertyName,u])}(e,r,d),s.object(...d)}(e,r,o)}function c({errorPath:e},{instancePath:o}){const s=o?t.str`${e}${(0,r.getErrorPath)(o,r.Type.Str)}`:e;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,s)]}function l({keyword:e,it:{errSchemaPath:n}},{schemaPath:o,parentSchema:s}){let a=s?n:t.str`${n}/${e}`;return o&&(a=t.str`${a}${(0,r.getErrorPath)(o,r.Type.Str)}`),[i.schemaPath,a]}}(errors),Object.defineProperty(boolSchema,"__esModule",{value:!0}),boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors,codegen_1$s=codegen,names_1$6=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(e){const{gen:t,schema:r,validateName:n}=e;!1===r?falseSchemaError(e,!1):"object"==typeof r&&!0===r.$async?t.return(names_1$6.default.data):(t.assign(codegen_1$s._`${n}.errors`,null),t.return(!0))}function boolOrEmptySchema(e,t){const{gen:r,schema:n}=e;!1===n?(r.var(t,!1),falseSchemaError(e)):r.var(t,!0)}function falseSchemaError(e,t){const{gen:r,data:n}=e,o={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,errors_1$2.reportError)(o,boolError,void 0,t)}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema,boolSchema.boolOrEmptySchema=boolOrEmptySchema;var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0}),rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(e){return"string"==typeof e&&jsonTypes.has(e)}function getRules(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}rules.isJSONType=isJSONType,rules.getRules=getRules;var applicability={};function schemaHasRulesForType({schema:e,self:t},r){const n=t.RULES.types[r];return n&&!0!==n&&shouldUseGroup(e,n)}function shouldUseGroup(e,t){return t.rules.some((t=>shouldUseRule(e,t)))}function shouldUseRule(e,t){var r;return void 0!==e[t.keyword]||(null===(r=t.definition.implements)||void 0===r?void 0:r.some((t=>void 0!==e[t])))}Object.defineProperty(applicability,"__esModule",{value:!0}),applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0,applicability.schemaHasRulesForType=schemaHasRulesForType,applicability.shouldUseGroup=shouldUseGroup,applicability.shouldUseRule=shouldUseRule,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.reportTypeError=e.checkDataTypes=e.checkDataType=e.coerceAndCheckDataType=e.getJSONTypes=e.getSchemaTypes=e.DataType=void 0;const t=rules,r=applicability,n=errors,o=codegen,s=util;var i,a;function c(e){const r=Array.isArray(e)?e:e?[e]:[];if(r.every(t.isJSONType))return r;throw new Error("type must be JSONType or JSONType[]: "+r.join(","))}(a=i=e.DataType||(e.DataType={}))[a.Correct=0]="Correct",a[a.Wrong=1]="Wrong",e.getSchemaTypes=function(e){const t=c(e.type);if(t.includes("null")){if(!1===e.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&void 0!==e.nullable)throw new Error('"nullable" cannot be used without "type"');!0===e.nullable&&t.push("null")}return t},e.getJSONTypes=c,e.coerceAndCheckDataType=function(e,t){const{gen:n,data:s,opts:a}=e,c=function(e,t){return t?e.filter((e=>l.has(e)||"array"===t&&"array"===e)):[]}(t,a.coerceTypes),d=t.length>0&&!(0===c.length&&1===t.length&&(0,r.schemaHasRulesForType)(e,t[0]));if(d){const r=p(t,s,a.strictNumbers,i.Wrong);n.if(r,(()=>{c.length?function(e,t,r){const{gen:n,data:s,opts:i}=e,a=n.let("dataType",o._`typeof ${s}`),c=n.let("coerced",o._`undefined`);"array"===i.coerceTypes&&n.if(o._`${a} == 'object' && Array.isArray(${s}) && ${s}.length == 1`,(()=>n.assign(s,o._`${s}[0]`).assign(a,o._`typeof ${s}`).if(p(t,s,i.strictNumbers),(()=>n.assign(c,s))))),n.if(o._`${c} !== undefined`);for(const o of r)(l.has(o)||"array"===o&&"array"===i.coerceTypes)&&d(o);function d(e){switch(e){case"string":return void n.elseIf(o._`${a} == "number" || ${a} == "boolean"`).assign(c,o._`"" + ${s}`).elseIf(o._`${s} === null`).assign(c,o._`""`);case"number":return void n.elseIf(o._`${a} == "boolean" || ${s} === null
              || (${a} == "string" && ${s} && ${s} == +${s})`).assign(c,o._`+${s}`);case"integer":return void n.elseIf(o._`${a} === "boolean" || ${s} === null
              || (${a} === "string" && ${s} && ${s} == +${s} && !(${s} % 1))`).assign(c,o._`+${s}`);case"boolean":return void n.elseIf(o._`${s} === "false" || ${s} === 0 || ${s} === null`).assign(c,!1).elseIf(o._`${s} === "true" || ${s} === 1`).assign(c,!0);case"null":return n.elseIf(o._`${s} === "" || ${s} === 0 || ${s} === false`),void n.assign(c,null);case"array":n.elseIf(o._`${a} === "string" || ${a} === "number"
              || ${a} === "boolean" || ${s} === null`).assign(c,o._`[${s}]`)}}n.else(),h(e),n.endIf(),n.if(o._`${c} !== undefined`,(()=>{n.assign(s,c),function({gen:e,parentData:t,parentDataProperty:r},n){e.if(o._`${t} !== undefined`,(()=>e.assign(o._`${t}[${r}]`,n)))}(e,c)}))}(e,t,c):h(e)}))}return d};const l=new Set(["string","number","integer","boolean","null"]);function d(e,t,r,n=i.Correct){const s=n===i.Correct?o.operators.EQ:o.operators.NEQ;let a;switch(e){case"null":return o._`${t} ${s} null`;case"array":a=o._`Array.isArray(${t})`;break;case"object":a=o._`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":a=c(o._`!(${t} % 1) && !isNaN(${t})`);break;case"number":a=c();break;default:return o._`typeof ${t} ${s} ${e}`}return n===i.Correct?a:(0,o.not)(a);function c(e=o.nil){return(0,o.and)(o._`typeof ${t} == "number"`,e,r?o._`isFinite(${t})`:o.nil)}}function p(e,t,r,n){if(1===e.length)return d(e[0],t,r,n);let i;const a=(0,s.toHash)(e);if(a.array&&a.object){const e=o._`typeof ${t} != "object"`;i=a.null?e:o._`!${t} || ${e}`,delete a.null,delete a.array,delete a.object}else i=o.nil;a.number&&delete a.integer;for(const s in a)i=(0,o.and)(i,d(s,t,r,n));return i}e.checkDataType=d,e.checkDataTypes=p;const u={message:({schema:e})=>`must be ${e}`,params:({schema:e,schemaValue:t})=>"string"==typeof e?o._`{type: ${e}}`:o._`{type: ${t}}`};function h(e){const t=function(e){const{gen:t,data:r,schema:n}=e,o=(0,s.schemaRefOrVal)(e,n,"type");return{gen:t,keyword:"type",data:r,schema:n.type,schemaCode:o,schemaValue:o,parentSchema:n,params:{},it:e}}(e);(0,n.reportError)(t,u)}e.reportTypeError=h}(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0}),defaults.assignDefaults=void 0;const codegen_1$r=codegen,util_1$p=util;function assignDefaults(e,t){const{properties:r,items:n}=e.schema;if("object"===t&&r)for(const o in r)assignDefault(e,o,r[o].default);else"array"===t&&Array.isArray(n)&&n.forEach(((t,r)=>assignDefault(e,r,t.default)))}function assignDefault(e,t,r){const{gen:n,compositeRule:o,data:s,opts:i}=e;if(void 0===r)return;const a=codegen_1$r._`${s}${(0,codegen_1$r.getProperty)(t)}`;if(o)return void(0,util_1$p.checkStrictMode)(e,`default is ignored for: ${a}`);let c=codegen_1$r._`${a} === undefined`;"empty"===i.useDefaults&&(c=codegen_1$r._`${c} || ${a} === null || ${a} === ""`),n.if(c,codegen_1$r._`${a} = ${(0,codegen_1$r.stringify)(r)}`)}defaults.assignDefaults=assignDefaults;var keyword={},code={};Object.defineProperty(code,"__esModule",{value:!0}),code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const codegen_1$q=codegen,util_1$o=util,names_1$5=names$1,util_2$1=util;function checkReportMissingProp(e,t){const{gen:r,data:n,it:o}=e;r.if(noPropertyInData(r,n,t,o.opts.ownProperties),(()=>{e.setParams({missingProperty:codegen_1$q._`${t}`},!0),e.error()}))}function checkMissingProp({gen:e,data:t,it:{opts:r}},n,o){return(0,codegen_1$q.or)(...n.map((n=>(0,codegen_1$q.and)(noPropertyInData(e,t,n,r.ownProperties),codegen_1$q._`${o} = ${n}`))))}function reportMissingProp(e,t){e.setParams({missingProperty:t},!0),e.error()}function hasPropFunc(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:codegen_1$q._`Object.prototype.hasOwnProperty`})}function isOwnProperty(e,t,r){return codegen_1$q._`${hasPropFunc(e)}.call(${t}, ${r})`}function propertyInData(e,t,r,n){const o=codegen_1$q._`${t}${(0,codegen_1$q.getProperty)(r)} !== undefined`;return n?codegen_1$q._`${o} && ${isOwnProperty(e,t,r)}`:o}function noPropertyInData(e,t,r,n){const o=codegen_1$q._`${t}${(0,codegen_1$q.getProperty)(r)} === undefined`;return n?(0,codegen_1$q.or)(o,(0,codegen_1$q.not)(isOwnProperty(e,t,r))):o}function allSchemaProperties(e){return e?Object.keys(e).filter((e=>"__proto__"!==e)):[]}function schemaProperties(e,t){return allSchemaProperties(t).filter((r=>!(0,util_1$o.alwaysValidSchema)(e,t[r])))}function callValidateCode({schemaCode:e,data:t,it:{gen:r,topSchemaRef:n,schemaPath:o,errorPath:s},it:i},a,c,l){const d=l?codegen_1$q._`${e}, ${t}, ${n}${o}`:t,p=[[names_1$5.default.instancePath,(0,codegen_1$q.strConcat)(names_1$5.default.instancePath,s)],[names_1$5.default.parentData,i.parentData],[names_1$5.default.parentDataProperty,i.parentDataProperty],[names_1$5.default.rootData,names_1$5.default.rootData]];i.opts.dynamicRef&&p.push([names_1$5.default.dynamicAnchors,names_1$5.default.dynamicAnchors]);const u=codegen_1$q._`${d}, ${r.object(...p)}`;return c!==codegen_1$q.nil?codegen_1$q._`${a}.call(${c}, ${u})`:codegen_1$q._`${a}(${u})`}code.checkReportMissingProp=checkReportMissingProp,code.checkMissingProp=checkMissingProp,code.reportMissingProp=reportMissingProp,code.hasPropFunc=hasPropFunc,code.isOwnProperty=isOwnProperty,code.propertyInData=propertyInData,code.noPropertyInData=noPropertyInData,code.allSchemaProperties=allSchemaProperties,code.schemaProperties=schemaProperties,code.callValidateCode=callValidateCode;const newRegExp=codegen_1$q._`new RegExp`;function usePattern({gen:e,it:{opts:t}},r){const n=t.unicodeRegExp?"u":"",{regExp:o}=t.code,s=o(r,n);return e.scopeValue("pattern",{key:s.toString(),ref:s,code:codegen_1$q._`${"new RegExp"===o.code?newRegExp:(0,util_2$1.useFunc)(e,o)}(${r}, ${n})`})}function validateArray(e){const{gen:t,data:r,keyword:n,it:o}=e,s=t.name("valid");if(o.allErrors){const e=t.let("valid",!0);return i((()=>t.assign(e,!1))),e}return t.var(s,!0),i((()=>t.break())),s;function i(o){const i=t.const("len",codegen_1$q._`${r}.length`);t.forRange("i",0,i,(r=>{e.subschema({keyword:n,dataProp:r,dataPropType:util_1$o.Type.Num},s),t.if((0,codegen_1$q.not)(s),o)}))}}function validateUnion(e){const{gen:t,schema:r,keyword:n,it:o}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some((e=>(0,util_1$o.alwaysValidSchema)(o,e)))&&!o.opts.unevaluated)return;const s=t.let("valid",!1),i=t.name("_valid");t.block((()=>r.forEach(((r,o)=>{const a=e.subschema({keyword:n,schemaProp:o,compositeRule:!0},i);t.assign(s,codegen_1$q._`${s} || ${i}`),e.mergeValidEvaluated(a,i)||t.if((0,codegen_1$q.not)(s))})))),e.result(s,(()=>e.reset()),(()=>e.error(!0)))}code.usePattern=usePattern,code.validateArray=validateArray,code.validateUnion=validateUnion,Object.defineProperty(keyword,"__esModule",{value:!0}),keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$p=codegen,names_1$4=names$1,code_1$9=code,errors_1$1=errors;function macroKeywordCode(e,t){const{gen:r,keyword:n,schema:o,parentSchema:s,it:i}=e,a=t.macro.call(i.self,o,s,i),c=useKeyword(r,n,a);!1!==i.opts.validateSchema&&i.self.validateSchema(a,!0);const l=r.name("valid");e.subschema({schema:a,schemaPath:codegen_1$p.nil,errSchemaPath:`${i.errSchemaPath}/${n}`,topSchemaRef:c,compositeRule:!0},l),e.pass(l,(()=>e.error(!0)))}function funcKeywordCode(e,t){var r;const{gen:n,keyword:o,schema:s,parentSchema:i,$data:a,it:c}=e;checkAsyncKeyword(c,t);const l=!a&&t.compile?t.compile.call(c.self,s,i,c):t.validate,d=useKeyword(n,o,l),p=n.let("valid");function u(r=(t.async?codegen_1$p._`await `:codegen_1$p.nil)){const o=c.opts.passContext?names_1$4.default.this:names_1$4.default.self,s=!("compile"in t&&!a||!1===t.schema);n.assign(p,codegen_1$p._`${r}${(0,code_1$9.callValidateCode)(e,d,o,s)}`,t.modifying)}function h(e){var r;n.if((0,codegen_1$p.not)(null!==(r=t.valid)&&void 0!==r?r:p),e)}e.block$data(p,(function(){if(!1===t.errors)u(),t.modifying&&modifyData(e),h((()=>e.error()));else{const r=t.async?function(){const e=n.let("ruleErrs",null);return n.try((()=>u(codegen_1$p._`await `)),(t=>n.assign(p,!1).if(codegen_1$p._`${t} instanceof ${c.ValidationError}`,(()=>n.assign(e,codegen_1$p._`${t}.errors`)),(()=>n.throw(t))))),e}():function(){const e=codegen_1$p._`${d}.errors`;return n.assign(e,null),u(codegen_1$p.nil),e}();t.modifying&&modifyData(e),h((()=>addErrs(e,r)))}})),e.ok(null!==(r=t.valid)&&void 0!==r?r:p)}function modifyData(e){const{gen:t,data:r,it:n}=e;t.if(n.parentData,(()=>t.assign(r,codegen_1$p._`${n.parentData}[${n.parentDataProperty}]`)))}function addErrs(e,t){const{gen:r}=e;r.if(codegen_1$p._`Array.isArray(${t})`,(()=>{r.assign(names_1$4.default.vErrors,codegen_1$p._`${names_1$4.default.vErrors} === null ? ${t} : ${names_1$4.default.vErrors}.concat(${t})`).assign(names_1$4.default.errors,codegen_1$p._`${names_1$4.default.vErrors}.length`),(0,errors_1$1.extendErrors)(e)}),(()=>e.error()))}function checkAsyncKeyword({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function useKeyword(e,t,r){if(void 0===r)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword","function"==typeof r?{ref:r}:{ref:r,code:(0,codegen_1$p.stringify)(r)})}function validSchemaType(e,t,r=!1){return!t.length||t.some((t=>"array"===t?Array.isArray(e):"object"===t?e&&"object"==typeof e&&!Array.isArray(e):typeof e==t||r&&typeof e>"u"))}function validateKeywordUsage({schema:e,opts:t,self:r,errSchemaPath:n},o,s){if(Array.isArray(o.keyword)?!o.keyword.includes(s):o.keyword!==s)throw new Error("ajv implementation error");const i=o.dependencies;if(null!=i&&i.some((t=>!Object.prototype.hasOwnProperty.call(e,t))))throw new Error(`parent schema must have dependencies of ${s}: ${i.join(",")}`);if(o.validateSchema&&!o.validateSchema(e[s])){const e=`keyword "${s}" value is invalid at path "${n}": `+r.errorsText(o.validateSchema.errors);if("log"!==t.validateSchema)throw new Error(e);r.logger.error(e)}}keyword.macroKeywordCode=macroKeywordCode,keyword.funcKeywordCode=funcKeywordCode,keyword.validSchemaType=validSchemaType,keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0}),subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$o=codegen,util_1$n=util;function getSubschema(e,{keyword:t,schemaProp:r,schema:n,schemaPath:o,errSchemaPath:s,topSchemaRef:i}){if(void 0!==t&&void 0!==n)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==t){const n=e.schema[t];return void 0===r?{schema:n,schemaPath:codegen_1$o._`${e.schemaPath}${(0,codegen_1$o.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:n[r],schemaPath:codegen_1$o._`${e.schemaPath}${(0,codegen_1$o.getProperty)(t)}${(0,codegen_1$o.getProperty)(r)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,util_1$n.escapeFragment)(r)}`}}if(void 0!==n){if(void 0===o||void 0===s||void 0===i)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:o,topSchemaRef:i,errSchemaPath:s}}throw new Error('either "keyword" or "schema" must be passed')}function extendSubschemaData(e,t,{dataProp:r,dataPropType:n,data:o,dataTypes:s,propertyName:i}){if(void 0!==o&&void 0!==r)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:a}=t;if(void 0!==r){const{errorPath:o,dataPathArr:s,opts:i}=t;c(a.let("data",codegen_1$o._`${t.data}${(0,codegen_1$o.getProperty)(r)}`,!0)),e.errorPath=codegen_1$o.str`${o}${(0,util_1$n.getErrorPath)(r,n,i.jsPropertySyntax)}`,e.parentDataProperty=codegen_1$o._`${r}`,e.dataPathArr=[...s,e.parentDataProperty]}if(void 0!==o){c(o instanceof codegen_1$o.Name?o:a.let("data",o,!0)),void 0!==i&&(e.propertyName=i)}function c(r){e.data=r,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,r]}s&&(e.dataTypes=s)}function extendSubschemaMode(e,{jtdDiscriminator:t,jtdMetadata:r,compositeRule:n,createErrors:o,allErrors:s}){void 0!==n&&(e.compositeRule=n),void 0!==o&&(e.createErrors=o),void 0!==s&&(e.allErrors=s),e.jtdDiscriminator=t,e.jtdMetadata=r}subschema.getSubschema=getSubschema,subschema.extendSubschemaData=extendSubschemaData,subschema.extendSubschemaMode=extendSubschemaMode;var resolve$1={},fastDeepEqual=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,s;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,s[o]))return!1;for(o=n;0!=o--;){var i=s[o];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function(e,t,r){"function"==typeof t&&(r=t,t={}),_traverse(t,"function"==typeof(r=t.cb||r)?r:r.pre||function(){},r.post||function(){},e,"",e)};function _traverse(e,t,r,n,o,s,i,a,c,l){if(n&&"object"==typeof n&&!Array.isArray(n)){for(var d in t(n,o,s,i,a,c,l),n){var p=n[d];if(Array.isArray(p)){if(d in traverse$1.arrayKeywords)for(var u=0;u<p.length;u++)_traverse(e,t,r,p[u],o+"/"+d+"/"+u,s,o,d,n,u)}else if(d in traverse$1.propsKeywords){if(p&&"object"==typeof p)for(var h in p)_traverse(e,t,r,p[h],o+"/"+d+"/"+escapeJsonPtr(h),s,o,d,n,h)}else(d in traverse$1.keywords||e.allKeys&&!(d in traverse$1.skipKeywords))&&_traverse(e,t,r,p,o+"/"+d,s,o,d,n)}r(n,o,s,i,a,c,l)}}function escapeJsonPtr(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};var jsonSchemaTraverseExports=jsonSchemaTraverse.exports;Object.defineProperty(resolve$1,"__esModule",{value:!0}),resolve$1.getSchemaRefs=resolve$1.resolveUrl=resolve$1.normalizeId=resolve$1._getFullPath=resolve$1.getFullPath=resolve$1.inlineRef=void 0;const util_1$m=util,equal$2=fastDeepEqual,traverse=jsonSchemaTraverseExports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(e,t=!0){return"boolean"==typeof e||(!0===t?!hasRef(e):!!t&&countKeys(e)<=t)}resolve$1.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(e){for(const t in e){if(REF_KEYWORDS.has(t))return!0;const r=e[t];if(Array.isArray(r)&&r.some(hasRef)||"object"==typeof r&&hasRef(r))return!0}return!1}function countKeys(e){let t=0;for(const r in e){if("$ref"===r)return 1/0;if(t++,!SIMPLE_INLINED.has(r)&&("object"==typeof e[r]&&(0,util_1$m.eachItem)(e[r],(e=>t+=countKeys(e))),t===1/0))return 1/0}return t}function getFullPath(e,t="",r){!1!==r&&(t=normalizeId(t));const n=e.parse(t);return _getFullPath(e,n)}function _getFullPath(e,t){return e.serialize(t).split("#")[0]+"#"}resolve$1.getFullPath=getFullPath,resolve$1._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(e){return e?e.replace(TRAILING_SLASH_HASH,""):""}function resolveUrl(e,t,r){return r=normalizeId(r),e.resolve(t,r)}resolve$1.normalizeId=normalizeId,resolve$1.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(e,t){if("boolean"==typeof e)return{};const{schemaId:r,uriResolver:n}=this.opts,o=normalizeId(e[r]||t),s={"":o},i=getFullPath(n,o,!1),a={},c=new Set;return traverse(e,{allKeys:!0},((e,t,n,o)=>{if(void 0===o)return;const p=i+t;let u=s[o];function h(t){const r=this.opts.uriResolver.resolve;if(t=normalizeId(u?r(u,t):t),c.has(t))throw d(t);c.add(t);let n=this.refs[t];return"string"==typeof n&&(n=this.refs[n]),"object"==typeof n?l(e,n.schema,t):t!==normalizeId(p)&&("#"===t[0]?(l(e,a[t],t),a[t]=e):this.refs[t]=p),t}function f(e){if("string"==typeof e){if(!ANCHOR.test(e))throw new Error(`invalid anchor "${e}"`);h.call(this,`#${e}`)}}"string"==typeof e[r]&&(u=h.call(this,e[r])),f.call(this,e.$anchor),f.call(this,e.$dynamicAnchor),s[t]=u})),a;function l(e,t,r){if(void 0!==t&&!equal$2(e,t))throw d(r)}function d(e){return new Error(`reference "${e}" resolves to more than one schema`)}}resolve$1.getSchemaRefs=getSchemaRefs,Object.defineProperty(validate,"__esModule",{value:!0}),validate.getData=validate.KeywordCxt=validate.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$n=codegen,names_1$3=names$1,resolve_1$2=resolve$1,util_1$l=util,errors_1=errors;function validateFunctionCode(e){isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))?topSchemaObjCode(e):validateFunction(e,(()=>(0,boolSchema_1.topBoolOrEmptySchema)(e)))}function validateFunction({gen:e,validateName:t,schema:r,schemaEnv:n,opts:o},s){o.code.es5?e.func(t,codegen_1$n._`${names_1$3.default.data}, ${names_1$3.default.valCxt}`,n.$async,(()=>{e.code(codegen_1$n._`"use strict"; ${funcSourceUrl(r,o)}`),destructureValCxtES5(e,o),e.code(s)})):e.func(t,codegen_1$n._`${names_1$3.default.data}, ${destructureValCxt(o)}`,n.$async,(()=>e.code(funcSourceUrl(r,o)).code(s)))}function destructureValCxt(e){return codegen_1$n._`{${names_1$3.default.instancePath}="", ${names_1$3.default.parentData}, ${names_1$3.default.parentDataProperty}, ${names_1$3.default.rootData}=${names_1$3.default.data}${e.dynamicRef?codegen_1$n._`, ${names_1$3.default.dynamicAnchors}={}`:codegen_1$n.nil}}={}`}function destructureValCxtES5(e,t){e.if(names_1$3.default.valCxt,(()=>{e.var(names_1$3.default.instancePath,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.instancePath}`),e.var(names_1$3.default.parentData,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.parentData}`),e.var(names_1$3.default.parentDataProperty,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.parentDataProperty}`),e.var(names_1$3.default.rootData,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.rootData}`),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.dynamicAnchors}`)}),(()=>{e.var(names_1$3.default.instancePath,codegen_1$n._`""`),e.var(names_1$3.default.parentData,codegen_1$n._`undefined`),e.var(names_1$3.default.parentDataProperty,codegen_1$n._`undefined`),e.var(names_1$3.default.rootData,names_1$3.default.data),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,codegen_1$n._`{}`)}))}function topSchemaObjCode(e){const{schema:t,opts:r,gen:n}=e;validateFunction(e,(()=>{r.$comment&&t.$comment&&commentKeyword(e),checkNoDefault(e),n.let(names_1$3.default.vErrors,null),n.let(names_1$3.default.errors,0),r.unevaluated&&resetEvaluated(e),typeAndKeywords(e),returnResults(e)}))}function resetEvaluated(e){const{gen:t,validateName:r}=e;e.evaluated=t.const("evaluated",codegen_1$n._`${r}.evaluated`),t.if(codegen_1$n._`${e.evaluated}.dynamicProps`,(()=>t.assign(codegen_1$n._`${e.evaluated}.props`,codegen_1$n._`undefined`))),t.if(codegen_1$n._`${e.evaluated}.dynamicItems`,(()=>t.assign(codegen_1$n._`${e.evaluated}.items`,codegen_1$n._`undefined`)))}function funcSourceUrl(e,t){const r="object"==typeof e&&e[t.schemaId];return r&&(t.code.source||t.code.process)?codegen_1$n._`/*# sourceURL=${r} */`:codegen_1$n.nil}function subschemaCode(e,t){isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))?subSchemaObjCode(e,t):(0,boolSchema_1.boolOrEmptySchema)(e,t)}function schemaCxtHasRules({schema:e,self:t}){if("boolean"==typeof e)return!e;for(const r in e)if(t.RULES.all[r])return!0;return!1}function isSchemaObj(e){return"boolean"!=typeof e.schema}function subSchemaObjCode(e,t){const{schema:r,gen:n,opts:o}=e;o.$comment&&r.$comment&&commentKeyword(e),updateContext(e),checkAsyncSchema(e);const s=n.const("_errs",names_1$3.default.errors);typeAndKeywords(e,s),n.var(t,codegen_1$n._`${s} === ${names_1$3.default.errors}`)}function checkKeywords(e){(0,util_1$l.checkUnknownRules)(e),checkRefsAndKeywords(e)}function typeAndKeywords(e,t){if(e.opts.jtd)return schemaKeywords(e,[],!1,t);const r=(0,dataType_1$1.getSchemaTypes)(e.schema);schemaKeywords(e,r,!(0,dataType_1$1.coerceAndCheckDataType)(e,r),t)}function checkRefsAndKeywords(e){const{schema:t,errSchemaPath:r,opts:n,self:o}=e;t.$ref&&n.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(t,o.RULES)&&o.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function checkNoDefault(e){const{schema:t,opts:r}=e;void 0!==t.default&&r.useDefaults&&r.strictSchema&&(0,util_1$l.checkStrictMode)(e,"default is ignored in the schema root")}function updateContext(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,resolve_1$2.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function checkAsyncSchema(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:e,schemaEnv:t,schema:r,errSchemaPath:n,opts:o}){const s=r.$comment;if(!0===o.$comment)e.code(codegen_1$n._`${names_1$3.default.self}.logger.log(${s})`);else if("function"==typeof o.$comment){const r=codegen_1$n.str`${n}/$comment`,o=e.scopeValue("root",{ref:t.root});e.code(codegen_1$n._`${names_1$3.default.self}.opts.$comment(${s}, ${r}, ${o}.schema)`)}}function returnResults(e){const{gen:t,schemaEnv:r,validateName:n,ValidationError:o,opts:s}=e;r.$async?t.if(codegen_1$n._`${names_1$3.default.errors} === 0`,(()=>t.return(names_1$3.default.data)),(()=>t.throw(codegen_1$n._`new ${o}(${names_1$3.default.vErrors})`))):(t.assign(codegen_1$n._`${n}.errors`,names_1$3.default.vErrors),s.unevaluated&&assignEvaluated(e),t.return(codegen_1$n._`${names_1$3.default.errors} === 0`))}function assignEvaluated({gen:e,evaluated:t,props:r,items:n}){r instanceof codegen_1$n.Name&&e.assign(codegen_1$n._`${t}.props`,r),n instanceof codegen_1$n.Name&&e.assign(codegen_1$n._`${t}.items`,n)}function schemaKeywords(e,t,r,n){const{gen:o,schema:s,data:i,allErrors:a,opts:c,self:l}=e,{RULES:d}=l;function p(l){(0,applicability_1.shouldUseGroup)(s,l)&&(l.type?(o.if((0,dataType_2.checkDataType)(l.type,i,c.strictNumbers)),iterateKeywords(e,l),1===t.length&&t[0]===l.type&&r&&(o.else(),(0,dataType_2.reportTypeError)(e)),o.endIf()):iterateKeywords(e,l),a||o.if(codegen_1$n._`${names_1$3.default.errors} === ${n||0}`))}!s.$ref||!c.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(s,d)?(c.jtd||checkStrictTypes(e,t),o.block((()=>{for(const e of d.rules)p(e);p(d.post)}))):o.block((()=>keywordCode(e,"$ref",d.all.$ref.definition)))}function iterateKeywords(e,t){const{gen:r,schema:n,opts:{useDefaults:o}}=e;o&&(0,defaults_1.assignDefaults)(e,t.type),r.block((()=>{for(const r of t.rules)(0,applicability_1.shouldUseRule)(n,r)&&keywordCode(e,r.keyword,r.definition,t.type)}))}function checkStrictTypes(e,t){e.schemaEnv.meta||!e.opts.strictTypes||(checkContextTypes(e,t),e.opts.allowUnionTypes||checkMultipleTypes(e,t),checkKeywordTypes(e,e.dataTypes))}function checkContextTypes(e,t){if(t.length){if(!e.dataTypes.length)return void(e.dataTypes=t);t.forEach((t=>{includesType(e.dataTypes,t)||strictTypesError(e,`type "${t}" not allowed by context "${e.dataTypes.join(",")}"`)})),narrowSchemaTypes(e,t)}}function checkMultipleTypes(e,t){t.length>1&&(2!==t.length||!t.includes("null"))&&strictTypesError(e,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(e,t){const r=e.self.RULES.all;for(const n in r){const o=r[n];if("object"==typeof o&&(0,applicability_1.shouldUseRule)(e.schema,o)){const{type:r}=o.definition;r.length&&!r.some((e=>hasApplicableType(t,e)))&&strictTypesError(e,`missing type "${r.join(",")}" for keyword "${n}"`)}}}function hasApplicableType(e,t){return e.includes(t)||"number"===t&&e.includes("integer")}function includesType(e,t){return e.includes(t)||"integer"===t&&e.includes("number")}function narrowSchemaTypes(e,t){const r=[];for(const n of e.dataTypes)includesType(t,n)?r.push(n):t.includes("integer")&&"number"===n&&r.push("integer");e.dataTypes=r}function strictTypesError(e,t){t+=` at "${e.schemaEnv.baseId+e.errSchemaPath}" (strictTypes)`,(0,util_1$l.checkStrictMode)(e,t,e.opts.strictTypes)}validate.validateFunctionCode=validateFunctionCode;class KeywordCxt{constructor(e,t,r){if((0,keyword_1.validateKeywordUsage)(e,t,r),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=r,this.data=e.data,this.schema=e.schema[r],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$l.schemaRefOrVal)(e,this.schema,r,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",getData(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,t.schemaType,t.allowUndefined))throw new Error(`${r} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:!1!==t.errors)&&(this.errsCount=e.gen.const("_errs",names_1$3.default.errors))}result(e,t,r){this.failResult((0,codegen_1$n.not)(e),t,r)}failResult(e,t,r){this.gen.if(e),r?r():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.failResult((0,codegen_1$n.not)(e),void 0,t)}fail(e){if(void 0===e)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:t}=this;this.fail(codegen_1$n._`${t} !== undefined && (${(0,codegen_1$n.or)(this.invalid$data(),e)})`)}error(e,t,r){if(t)return this.setParams(t),this._error(e,r),void this.setParams({});this._error(e,r)}_error(e,t){(e?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,t)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,r=codegen_1$n.nil){this.gen.block((()=>{this.check$data(e,r),t()}))}check$data(e=codegen_1$n.nil,t=codegen_1$n.nil){if(!this.$data)return;const{gen:r,schemaCode:n,schemaType:o,def:s}=this;r.if((0,codegen_1$n.or)(codegen_1$n._`${n} === undefined`,t)),e!==codegen_1$n.nil&&r.assign(e,!0),(o.length||s.validateSchema)&&(r.elseIf(this.invalid$data()),this.$dataError(),e!==codegen_1$n.nil&&r.assign(e,!1)),r.else()}invalid$data(){const{gen:e,schemaCode:t,schemaType:r,def:n,it:o}=this;return(0,codegen_1$n.or)(function(){if(r.length){if(!(t instanceof codegen_1$n.Name))throw new Error("ajv implementation error");const e=Array.isArray(r)?r:[r];return codegen_1$n._`${(0,dataType_2.checkDataTypes)(e,t,o.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$n.nil}(),function(){if(n.validateSchema){const r=e.scopeValue("validate$data",{ref:n.validateSchema});return codegen_1$n._`!${r}(${t})`}return codegen_1$n.nil}())}subschema(e,t){const r=(0,subschema_1.getSubschema)(this.it,e);(0,subschema_1.extendSubschemaData)(r,this.it,e),(0,subschema_1.extendSubschemaMode)(r,e);const n={...this.it,...r,items:void 0,props:void 0};return subschemaCode(n,t),n}mergeEvaluated(e,t){const{it:r,gen:n}=this;r.opts.unevaluated&&(!0!==r.props&&void 0!==e.props&&(r.props=util_1$l.mergeEvaluated.props(n,e.props,r.props,t)),!0!==r.items&&void 0!==e.items&&(r.items=util_1$l.mergeEvaluated.items(n,e.items,r.items,t)))}mergeValidEvaluated(e,t){const{it:r,gen:n}=this;if(r.opts.unevaluated&&(!0!==r.props||!0!==r.items))return n.if(t,(()=>this.mergeEvaluated(e,codegen_1$n.Name))),!0}}function keywordCode(e,t,r,n){const o=new KeywordCxt(e,r,t);"code"in r?r.code(o,n):o.$data&&r.validate?(0,keyword_1.funcKeywordCode)(o,r):"macro"in r?(0,keyword_1.macroKeywordCode)(o,r):(r.compile||r.validate)&&(0,keyword_1.funcKeywordCode)(o,r)}validate.KeywordCxt=KeywordCxt;const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(e,{dataLevel:t,dataNames:r,dataPathArr:n}){let o,s;if(""===e)return names_1$3.default.rootData;if("/"===e[0]){if(!JSON_POINTER.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);o=e,s=names_1$3.default.rootData}else{const i=RELATIVE_JSON_POINTER.exec(e);if(!i)throw new Error(`Invalid JSON-pointer: ${e}`);const a=+i[1];if(o=i[2],"#"===o){if(a>=t)throw new Error(c("property/index",a));return n[t-a]}if(a>t)throw new Error(c("data",a));if(s=r[t-a],!o)return s}let i=s;const a=o.split("/");for(const l of a)l&&(s=codegen_1$n._`${s}${(0,codegen_1$n.getProperty)((0,util_1$l.unescapeJsonPointer)(l))}`,i=codegen_1$n._`${i} && ${s}`);return i;function c(e,r){return`Cannot access ${e} ${r} levels up, current level is ${t}`}}validate.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$1;class MissingRefError extends Error{constructor(e,t,r,n){super(n||`can't resolve reference ${r} from id ${t}`),this.missingRef=(0,resolve_1$1.resolveUrl)(e,t,r),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(e,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0}),compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$m=codegen,validation_error_1=validation_error,names_1$2=names$1,resolve_1=resolve$1,util_1$k=util,validate_1$1=validate;class SchemaEnv{constructor(e){var t;let r;this.refs={},this.dynamicAnchors={},"object"==typeof e.schema&&(r=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=null!==(t=e.baseId)&&void 0!==t?t:(0,resolve_1.normalizeId)(null==r?void 0:r[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=null==r?void 0:r.$async,this.refs={}}}function compileSchema(e){const t=getCompilingSchema.call(this,e);if(t)return t;const r=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:n,lines:o}=this.opts.code,{ownProperties:s}=this.opts,i=new codegen_1$m.CodeGen(this.scope,{es5:n,lines:o,ownProperties:s});let a;e.$async&&(a=i.scopeValue("Error",{ref:validation_error_1.default,code:codegen_1$m._`require("ajv/dist/runtime/validation_error").default`}));const c=i.scopeName("validate");e.validateName=c;const l={gen:i,allErrors:this.opts.allErrors,data:names_1$2.default.data,parentData:names_1$2.default.parentData,parentDataProperty:names_1$2.default.parentDataProperty,dataNames:[names_1$2.default.data],dataPathArr:[codegen_1$m.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:i.scopeValue("schema",!0===this.opts.code.source?{ref:e.schema,code:(0,codegen_1$m.stringify)(e.schema)}:{ref:e.schema}),validateName:c,ValidationError:a,schema:e.schema,schemaEnv:e,rootId:r,baseId:e.baseId||r,schemaPath:codegen_1$m.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:codegen_1$m._`""`,opts:this.opts,self:this};let d;try{this._compilations.add(e),(0,validate_1$1.validateFunctionCode)(l),i.optimize(this.opts.code.optimize);const t=i.toString();d=`${i.scopeRefs(names_1$2.default.scope)}return ${t}`,this.opts.code.process&&(d=this.opts.code.process(d,e));const r=new Function(`${names_1$2.default.self}`,`${names_1$2.default.scope}`,d)(this,this.scope.get());if(this.scope.value(c,{ref:r}),r.errors=null,r.schema=e.schema,r.schemaEnv=e,e.$async&&(r.$async=!0),!0===this.opts.code.source&&(r.source={validateName:c,validateCode:t,scopeValues:i._values}),this.opts.unevaluated){const{props:e,items:t}=l;r.evaluated={props:e instanceof codegen_1$m.Name?void 0:e,items:t instanceof codegen_1$m.Name?void 0:t,dynamicProps:e instanceof codegen_1$m.Name,dynamicItems:t instanceof codegen_1$m.Name},r.source&&(r.source.evaluated=(0,codegen_1$m.stringify)(r.evaluated))}return e.validate=r,e}catch(p){throw delete e.validate,delete e.validateName,d&&this.logger.error("Error compiling schema, function code:",d),p}finally{this._compilations.delete(e)}}function resolveRef(e,t,r){var n;r=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,r);const o=e.refs[r];if(o)return o;let s=resolve.call(this,e,r);if(void 0===s){const o=null===(n=e.localRefs)||void 0===n?void 0:n[r],{schemaId:i}=this.opts;o&&(s=new SchemaEnv({schema:o,schemaId:i,root:e,baseId:t}))}return void 0!==s?e.refs[r]=inlineOrCompile.call(this,s):void 0}function inlineOrCompile(e){return(0,resolve_1.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:compileSchema.call(this,e)}function getCompilingSchema(e){for(const t of this._compilations)if(sameSchemaEnv(t,e))return t}function sameSchemaEnv(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function resolve(e,t){let r;for(;"string"==typeof(r=this.refs[t]);)t=r;return r||this.schemas[t]||resolveSchema.call(this,e,t)}function resolveSchema(e,t){const r=this.opts.uriResolver.parse(t),n=(0,resolve_1._getFullPath)(this.opts.uriResolver,r);let o=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&n===o)return getJsonPointer.call(this,r,e);const s=(0,resolve_1.normalizeId)(n),i=this.refs[s]||this.schemas[s];if("string"==typeof i){const t=resolveSchema.call(this,e,i);return"object"!=typeof(null==t?void 0:t.schema)?void 0:getJsonPointer.call(this,r,t)}if("object"==typeof(null==i?void 0:i.schema)){if(i.validate||compileSchema.call(this,i),s===(0,resolve_1.normalizeId)(t)){const{schema:t}=i,{schemaId:r}=this.opts,n=t[r];return n&&(o=(0,resolve_1.resolveUrl)(this.opts.uriResolver,o,n)),new SchemaEnv({schema:t,schemaId:r,root:e,baseId:o})}return getJsonPointer.call(this,r,i)}}compile.SchemaEnv=SchemaEnv,compile.compileSchema=compileSchema,compile.resolveRef=resolveRef,compile.getCompilingSchema=getCompilingSchema,compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(e,{baseId:t,schema:r,root:n}){var o;if("/"!==(null===(o=e.fragment)||void 0===o?void 0:o[0]))return;for(const a of e.fragment.slice(1).split("/")){if("boolean"==typeof r)return;const e=r[(0,util_1$k.unescapeFragment)(a)];if(void 0===e)return;const n="object"==typeof(r=e)&&r[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(a)&&n&&(t=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,n))}let s;if("boolean"!=typeof r&&r.$ref&&!(0,util_1$k.schemaHasRulesButRef)(r,this.RULES)){const e=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,r.$ref);s=resolveSchema.call(this,n,e)}const{schemaId:i}=this.opts;return s=s||new SchemaEnv({schema:r,schemaId:i,root:n,baseId:t}),s.schema!==s.root.schema?s:void 0}const $id$1="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$1="object",required$1=["$data"],properties$2={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$1,description:description,type:type$1,required:required$1,properties:properties$2,additionalProperties:additionalProperties$1};var uri$1={},uri_all={exports:{}},t;t=uri_all.exports,function(e){function t(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(t.length>1){t[0]=t[0].slice(0,-1);for(var n=t.length-1,o=1;o<n;++o)t[o]=t[o].slice(1,-1);return t[n]=t[n].slice(1),t.join("")}return t[0]}function r(e){return"(?:"+e+")"}function n(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function o(e){return e.toUpperCase()}function s(e){return null!=e?e instanceof Array?e:"number"!=typeof e.length||e.split||e.setInterval||e.call?[e]:Array.prototype.slice.call(e):[]}function i(e,t){var r=e;if(t)for(var n in t)r[n]=t[n];return r}function a(e){var n="[A-Za-z]",o="[0-9]",s=t(o,"[A-Fa-f]"),i=r(r("%[EFef]"+s+"%"+s+s+"%"+s+s)+"|"+r("%[89A-Fa-f]"+s+"%"+s+s)+"|"+r("%"+s+s)),a="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",c=t("[\\:\\/\\?\\#\\[\\]\\@]",a),l=e?"[\\uE000-\\uF8FF]":"[]",d=t(n,o,"[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");r(n+t(n,o,"[\\+\\-\\.]")+"*"),r(r(i+"|"+t(d,a,"[\\:]"))+"*");var p=r(r("25[0-5]")+"|"+r("2[0-4]"+o)+"|"+r("1"+o+o)+"|"+r("0?[1-9]"+o)+"|0?0?"+o),u=r(p+"\\."+p+"\\."+p+"\\."+p),h=r(s+"{1,4}"),f=r(r(h+"\\:"+h)+"|"+u),m=r(r(h+"\\:")+"{6}"+f),g=r("\\:\\:"+r(h+"\\:")+"{5}"+f),y=r(r(h)+"?\\:\\:"+r(h+"\\:")+"{4}"+f),_=r(r(r(h+"\\:")+"{0,1}"+h)+"?\\:\\:"+r(h+"\\:")+"{3}"+f),$=r(r(r(h+"\\:")+"{0,2}"+h)+"?\\:\\:"+r(h+"\\:")+"{2}"+f),v=r(r(r(h+"\\:")+"{0,3}"+h)+"?\\:\\:"+h+"\\:"+f),w=r(r(r(h+"\\:")+"{0,4}"+h)+"?\\:\\:"+f),b=r(r(r(h+"\\:")+"{0,5}"+h)+"?\\:\\:"+h),P=r(r(r(h+"\\:")+"{0,6}"+h)+"?\\:\\:"),E=r([m,g,y,_,$,v,w,b,P].join("|")),S=r(r(d+"|"+i)+"+");r("[vV]"+s+"+\\."+t(d,a,"[\\:]")+"+"),r(r(i+"|"+t(d,a))+"*");var k=r(i+"|"+t(d,a,"[\\:\\@]"));return r(r(i+"|"+t(d,a,"[\\@]"))+"+"),r(r(k+"|"+t("[\\/\\?]",l))+"*"),{NOT_SCHEME:new RegExp(t("[^]",n,o,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",d,a),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",d,a),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",d,a),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",d,a),"g"),NOT_QUERY:new RegExp(t("[^\\%]",d,a,"[\\:\\@\\/\\?]",l),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",d,a,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",d,a),"g"),UNRESERVED:new RegExp(d,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",d,c),"g"),PCT_ENCODED:new RegExp(i,"g"),IPV4ADDRESS:new RegExp("^("+u+")$"),IPV6ADDRESS:new RegExp("^\\[?("+E+")"+r(r("\\%25|\\%(?!"+s+"{2})")+"("+S+")")+"?\\]?$")}}var c=a(!1),l=a(!0),d=function(){function e(e,t){var r=[],n=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(c){o=!0,s=c}finally{try{!n&&a.return&&a.return()}finally{if(o)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},u=2147483647,h=36,f=1,m=26,g=38,y=700,_=72,$=128,v="-",w=/^xn--/,b=/[^\0-\x7E]/,P=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=h-f,k=Math.floor,T=String.fromCharCode;function R(e){throw new RangeError(E[e])}function C(e,t){for(var r=[],n=e.length;n--;)r[n]=t(e[n]);return r}function x(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+C((e=e.replace(P,".")).split("."),t).join(".")}function j(e){for(var t=[],r=0,n=e.length;r<n;){var o=e.charCodeAt(r++);if(o>=55296&&o<=56319&&r<n){var s=e.charCodeAt(r++);56320==(64512&s)?t.push(((1023&o)<<10)+(1023&s)+65536):(t.push(o),r--)}else t.push(o)}return t}var N=function(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:h},O=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},I=function(e,t,r){var n=0;for(e=r?k(e/y):e>>1,e+=k(e/t);e>S*m>>1;n+=h)e=k(e/S);return k(n+(S+1)*e/(e+g))},A=function(e){var t=[],r=e.length,n=0,o=$,s=_,i=e.lastIndexOf(v);i<0&&(i=0);for(var a=0;a<i;++a)e.charCodeAt(a)>=128&&R("not-basic"),t.push(e.charCodeAt(a));for(var c=i>0?i+1:0;c<r;){for(var l=n,d=1,p=h;;p+=h){c>=r&&R("invalid-input");var g=N(e.charCodeAt(c++));(g>=h||g>k((u-n)/d))&&R("overflow"),n+=g*d;var y=p<=s?f:p>=s+m?m:p-s;if(g<y)break;var w=h-y;d>k(u/w)&&R("overflow"),d*=w}var b=t.length+1;s=I(n-l,b,0==l),k(n/b)>u-o&&R("overflow"),o+=k(n/b),n%=b,t.splice(n++,0,o)}return String.fromCodePoint.apply(String,t)},F=function(e){var t=[],r=(e=j(e)).length,n=$,o=0,s=_,i=!0,a=!1,c=void 0;try{for(var l,d=e[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var p=l.value;p<128&&t.push(T(p))}}catch(B){a=!0,c=B}finally{try{!i&&d.return&&d.return()}finally{if(a)throw c}}var g=t.length,y=g;for(g&&t.push(v);y<r;){var w=u,b=!0,P=!1,E=void 0;try{for(var S,C=e[Symbol.iterator]();!(b=(S=C.next()).done);b=!0){var x=S.value;x>=n&&x<w&&(w=x)}}catch(B){P=!0,E=B}finally{try{!b&&C.return&&C.return()}finally{if(P)throw E}}var N=y+1;w-n>k((u-o)/N)&&R("overflow"),o+=(w-n)*N,n=w;var A=!0,F=!1,D=void 0;try{for(var M,q=e[Symbol.iterator]();!(A=(M=q.next()).done);A=!0){var H=M.value;if(H<n&&++o>u&&R("overflow"),H==n){for(var L=o,U=h;;U+=h){var W=U<=s?f:U>=s+m?m:U-s;if(L<W)break;var V=L-W,z=h-W;t.push(T(O(W+V%z,0))),L=k(V/z)}t.push(T(O(L,0))),s=I(o,N,y==g),o=0,++y}}}catch(B){F=!0,D=B}finally{try{!A&&q.return&&q.return()}finally{if(F)throw D}}++o,++n}return t.join("")},D=function(e){return x(e,(function(e){return w.test(e)?A(e.slice(4).toLowerCase()):e}))},M=function(e){return x(e,(function(e){return b.test(e)?"xn--"+F(e):e}))},q={version:"2.1.0",ucs2:{decode:j,encode:function(e){return String.fromCodePoint.apply(String,p(e))}},decode:A,encode:F,toASCII:M,toUnicode:D},H={};function L(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function U(e){for(var t="",r=0,n=e.length;r<n;){var o=parseInt(e.substr(r+1,2),16);if(o<128)t+=String.fromCharCode(o),r+=3;else if(o>=194&&o<224){if(n-r>=6){var s=parseInt(e.substr(r+4,2),16);t+=String.fromCharCode((31&o)<<6|63&s)}else t+=e.substr(r,6);r+=6}else if(o>=224){if(n-r>=9){var i=parseInt(e.substr(r+4,2),16),a=parseInt(e.substr(r+7,2),16);t+=String.fromCharCode((15&o)<<12|(63&i)<<6|63&a)}else t+=e.substr(r,9);r+=9}else t+=e.substr(r,3),r+=3}return t}function W(e,t){function r(e){var r=U(e);return r.match(t.UNRESERVED)?r:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,r).replace(t.NOT_USERINFO,L).replace(t.PCT_ENCODED,o)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,r).toLowerCase().replace(t.NOT_HOST,L).replace(t.PCT_ENCODED,o)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,r).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,L).replace(t.PCT_ENCODED,o)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,r).replace(t.NOT_QUERY,L).replace(t.PCT_ENCODED,o)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,r).replace(t.NOT_FRAGMENT,L).replace(t.PCT_ENCODED,o)),e}function V(e){return e.replace(/^0*(.*)/,"$1")||"0"}function z(e,t){var r=e.match(t.IPV4ADDRESS)||[],n=d(r,2)[1];return n?n.split(".").map(V).join("."):e}function B(e,t){var r=e.match(t.IPV6ADDRESS)||[],n=d(r,3),o=n[1],s=n[2];if(o){for(var i=o.toLowerCase().split("::").reverse(),a=d(i,2),c=a[0],l=a[1],p=l?l.split(":").map(V):[],u=c.split(":").map(V),h=t.IPV4ADDRESS.test(u[u.length-1]),f=h?7:8,m=u.length-f,g=Array(f),y=0;y<f;++y)g[y]=p[y]||u[m+y]||"";h&&(g[f-1]=z(g[f-1],t));var _=g.reduce((function(e,t,r){if(!t||"0"===t){var n=e[e.length-1];n&&n.index+n.length===r?n.length++:e.push({index:r,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],$=void 0;if(_&&_.length>1){var v=g.slice(0,_.index),w=g.slice(_.index+_.length);$=v.join(":")+"::"+w.join(":")}else $=g.join(":");return s&&($+="%"+s),$}return e}var G=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,K=void 0==="".match(/(){0}/)[1];function Q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},n=!1!==t.iri?l:c;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var o=e.match(G);if(o){K?(r.scheme=o[1],r.userinfo=o[3],r.host=o[4],r.port=parseInt(o[5],10),r.path=o[6]||"",r.query=o[7],r.fragment=o[8],isNaN(r.port)&&(r.port=o[5])):(r.scheme=o[1]||void 0,r.userinfo=-1!==e.indexOf("@")?o[3]:void 0,r.host=-1!==e.indexOf("//")?o[4]:void 0,r.port=parseInt(o[5],10),r.path=o[6]||"",r.query=-1!==e.indexOf("?")?o[7]:void 0,r.fragment=-1!==e.indexOf("#")?o[8]:void 0,isNaN(r.port)&&(r.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?o[4]:void 0)),r.host&&(r.host=B(z(r.host,n),n)),void 0!==r.scheme||void 0!==r.userinfo||void 0!==r.host||void 0!==r.port||r.path||void 0!==r.query?void 0===r.scheme?r.reference="relative":void 0===r.fragment?r.reference="absolute":r.reference="uri":r.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==r.reference&&(r.error=r.error||"URI is not a "+t.reference+" reference.");var s=H[(t.scheme||r.scheme||"").toLowerCase()];if(t.unicodeSupport||s&&s.unicodeSupport)W(r,n);else{if(r.host&&(t.domainHost||s&&s.domainHost))try{r.host=q.toASCII(r.host.replace(n.PCT_ENCODED,U).toLowerCase())}catch(i){r.error=r.error||"Host's domain name can not be converted to ASCII via punycode: "+i}W(r,c)}s&&s.parse&&s.parse(r,t)}else r.error=r.error||"URI can not be parsed.";return r}function J(e,t){var r=!1!==t.iri?l:c,n=[];return void 0!==e.userinfo&&(n.push(e.userinfo),n.push("@")),void 0!==e.host&&n.push(B(z(String(e.host),r),r).replace(r.IPV6ADDRESS,(function(e,t,r){return"["+t+(r?"%25"+r:"")+"]"}))),("number"==typeof e.port||"string"==typeof e.port)&&(n.push(":"),n.push(String(e.port))),n.length?n.join(""):void 0}var Z=/^\.\.?\//,Y=/^\/\.(\/|$)/,X=/^\/\.\.(\/|$)/,ee=/^\/?(?:.|\n)*?(?=\/|$)/;function te(e){for(var t=[];e.length;)if(e.match(Z))e=e.replace(Z,"");else if(e.match(Y))e=e.replace(Y,"/");else if(e.match(X))e=e.replace(X,"/"),t.pop();else if("."===e||".."===e)e="";else{var r=e.match(ee);if(!r)throw new Error("Unexpected dot segment condition");var n=r[0];e=e.slice(n.length),t.push(n)}return t.join("")}function re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.iri?l:c,n=[],o=H[(t.scheme||e.scheme||"").toLowerCase()];if(o&&o.serialize&&o.serialize(e,t),e.host&&!r.IPV6ADDRESS.test(e.host)&&(t.domainHost||o&&o.domainHost))try{e.host=t.iri?q.toUnicode(e.host):q.toASCII(e.host.replace(r.PCT_ENCODED,U).toLowerCase())}catch(a){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+a}W(e,r),"suffix"!==t.reference&&e.scheme&&(n.push(e.scheme),n.push(":"));var s=J(e,t);if(void 0!==s&&("suffix"!==t.reference&&n.push("//"),n.push(s),e.path&&"/"!==e.path.charAt(0)&&n.push("/")),void 0!==e.path){var i=e.path;!t.absolutePath&&(!o||!o.absolutePath)&&(i=te(i)),void 0===s&&(i=i.replace(/^\/\//,"/%2F")),n.push(i)}return void 0!==e.query&&(n.push("?"),n.push(e.query)),void 0!==e.fragment&&(n.push("#"),n.push(e.fragment)),n.join("")}function ne(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};return arguments[3]||(e=Q(re(e,r),r),t=Q(re(t,r),r)),!(r=r||{}).tolerant&&t.scheme?(n.scheme=t.scheme,n.userinfo=t.userinfo,n.host=t.host,n.port=t.port,n.path=te(t.path||""),n.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(n.userinfo=t.userinfo,n.host=t.host,n.port=t.port,n.path=te(t.path||""),n.query=t.query):(t.path?("/"===t.path.charAt(0)?n.path=te(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?n.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:n.path=t.path:n.path="/"+t.path,n.path=te(n.path)),n.query=t.query):(n.path=e.path,void 0!==t.query?n.query=t.query:n.query=e.query),n.userinfo=e.userinfo,n.host=e.host,n.port=e.port),n.scheme=e.scheme),n.fragment=t.fragment,n}function oe(e,t,r){var n=i({scheme:"null"},r);return re(ne(Q(e,n),Q(t,n),n,!0),n)}function se(e,t){return"string"==typeof e?e=re(Q(e,t),t):"object"===n(e)&&(e=Q(re(e,t),t)),e}function ie(e,t,r){return"string"==typeof e?e=re(Q(e,r),r):"object"===n(e)&&(e=re(e,r)),"string"==typeof t?t=re(Q(t,r),r):"object"===n(t)&&(t=re(t,r)),e===t}function ae(e,t){return e&&e.toString().replace(t&&t.iri?l.ESCAPE:c.ESCAPE,L)}function ce(e,t){return e&&e.toString().replace(t&&t.iri?l.PCT_ENCODED:c.PCT_ENCODED,U)}var le={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){var r="https"===String(e.scheme).toLowerCase();return(e.port===(r?443:80)||""===e.port)&&(e.port=void 0),e.path||(e.path="/"),e}},de={scheme:"https",domainHost:le.domainHost,parse:le.parse,serialize:le.serialize};function pe(e){return"boolean"==typeof e.secure?e.secure:"wss"===String(e.scheme).toLowerCase()}var ue={scheme:"ws",domainHost:!0,parse:function(e,t){var r=e;return r.secure=pe(r),r.resourceName=(r.path||"/")+(r.query?"?"+r.query:""),r.path=void 0,r.query=void 0,r},serialize:function(e,t){if((e.port===(pe(e)?443:80)||""===e.port)&&(e.port=void 0),"boolean"==typeof e.secure&&(e.scheme=e.secure?"wss":"ws",e.secure=void 0),e.resourceName){var r=e.resourceName.split("?"),n=d(r,2),o=n[0],s=n[1];e.path=o&&"/"!==o?o:void 0,e.query=s,e.resourceName=void 0}return e.fragment=void 0,e}},he={scheme:"wss",domainHost:ue.domainHost,parse:ue.parse,serialize:ue.serialize},fe={},me="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",ge="[0-9A-Fa-f]",ye=r(r("%[EFef]"+ge+"%"+ge+ge+"%"+ge+ge)+"|"+r("%[89A-Fa-f]"+ge+"%"+ge+ge)+"|"+r("%"+ge+ge)),_e="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",$e=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),ve="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",we=new RegExp(me,"g"),be=new RegExp(ye,"g"),Pe=new RegExp(t("[^]",_e,"[\\.]",'[\\"]',$e),"g"),Ee=new RegExp(t("[^]",me,ve),"g"),Se=Ee;function ke(e){var t=U(e);return t.match(we)?t:e}var Te={scheme:"mailto",parse:function(e,t){var r=e,n=r.to=r.path?r.path.split(","):[];if(r.path=void 0,r.query){for(var o=!1,s={},i=r.query.split("&"),a=0,c=i.length;a<c;++a){var l=i[a].split("=");switch(l[0]){case"to":for(var d=l[1].split(","),p=0,u=d.length;p<u;++p)n.push(d[p]);break;case"subject":r.subject=ce(l[1],t);break;case"body":r.body=ce(l[1],t);break;default:o=!0,s[ce(l[0],t)]=ce(l[1],t)}}o&&(r.headers=s)}r.query=void 0;for(var h=0,f=n.length;h<f;++h){var m=n[h].split("@");if(m[0]=ce(m[0]),t.unicodeSupport)m[1]=ce(m[1],t).toLowerCase();else try{m[1]=q.toASCII(ce(m[1],t).toLowerCase())}catch(g){r.error=r.error||"Email address's domain name can not be converted to ASCII via punycode: "+g}n[h]=m.join("@")}return r},serialize:function(e,t){var r=e,n=s(e.to);if(n){for(var i=0,a=n.length;i<a;++i){var c=String(n[i]),l=c.lastIndexOf("@"),d=c.slice(0,l).replace(be,ke).replace(be,o).replace(Pe,L),p=c.slice(l+1);try{p=t.iri?q.toUnicode(p):q.toASCII(ce(p,t).toLowerCase())}catch(m){r.error=r.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+m}n[i]=d+"@"+p}r.path=n.join(",")}var u=e.headers=e.headers||{};e.subject&&(u.subject=e.subject),e.body&&(u.body=e.body);var h=[];for(var f in u)u[f]!==fe[f]&&h.push(f.replace(be,ke).replace(be,o).replace(Ee,L)+"="+u[f].replace(be,ke).replace(be,o).replace(Se,L));return h.length&&(r.query=h.join("&")),r}},Re=/^([^\:]+)\:(.*)/,Ce={scheme:"urn",parse:function(e,t){var r=e.path&&e.path.match(Re),n=e;if(r){var o=t.scheme||n.scheme||"urn",s=r[1].toLowerCase(),i=r[2],a=o+":"+(t.nid||s),c=H[a];n.nid=s,n.nss=i,n.path=void 0,c&&(n=c.parse(n,t))}else n.error=n.error||"URN can not be parsed.";return n},serialize:function(e,t){var r=t.scheme||e.scheme||"urn",n=e.nid,o=r+":"+(t.nid||n),s=H[o];s&&(e=s.serialize(e,t));var i=e,a=e.nss;return i.path=(n||t.nid)+":"+a,i}},xe=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,je={scheme:"urn:uuid",parse:function(e,t){var r=e;return r.uuid=r.nss,r.nss=void 0,!t.tolerant&&(!r.uuid||!r.uuid.match(xe))&&(r.error=r.error||"UUID is not valid."),r},serialize:function(e,t){var r=e;return r.nss=(e.uuid||"").toLowerCase(),r}};H[le.scheme]=le,H[de.scheme]=de,H[ue.scheme]=ue,H[he.scheme]=he,H[Te.scheme]=Te,H[Ce.scheme]=Ce,H[je.scheme]=je,e.SCHEMES=H,e.pctEncChar=L,e.pctDecChars=U,e.parse=Q,e.removeDotSegments=te,e.serialize=re,e.resolveComponents=ne,e.resolve=oe,e.normalize=se,e.equal=ie,e.escapeComponent=ae,e.unescapeComponent=ce,Object.defineProperty(e,"__esModule",{value:!0})}(t);var uri_allExports=uri_all.exports;Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_allExports;uri.code='require("ajv/dist/runtime/uri").default',uri$1.default=uri,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=validate;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var r=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return r.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return r.CodeGen}});const n=validation_error,o=ref_error,s=rules,i=compile,a=codegen,c=resolve$1,l=dataType,d=util,p=require$$9,u=uri$1,h=(e,t)=>new RegExp(e,t);h.code="new RegExp";const f=["removeAdditional","useDefaults","coerceTypes"],m=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),g={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},y={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'};function _(e){var t,r,n,o,s,i,a,c,l,d,p,f,m,g,y,_,$,v,w,b,P,E,S,k,T;const R=e.strict,C=null===(t=e.code)||void 0===t?void 0:t.optimize,x=!0===C||void 0===C?1:C||0,j=null!==(n=null===(r=e.code)||void 0===r?void 0:r.regExp)&&void 0!==n?n:h,N=null!==(o=e.uriResolver)&&void 0!==o?o:u.default;return{strictSchema:null===(i=null!==(s=e.strictSchema)&&void 0!==s?s:R)||void 0===i||i,strictNumbers:null===(c=null!==(a=e.strictNumbers)&&void 0!==a?a:R)||void 0===c||c,strictTypes:null!==(d=null!==(l=e.strictTypes)&&void 0!==l?l:R)&&void 0!==d?d:"log",strictTuples:null!==(f=null!==(p=e.strictTuples)&&void 0!==p?p:R)&&void 0!==f?f:"log",strictRequired:null!==(g=null!==(m=e.strictRequired)&&void 0!==m?m:R)&&void 0!==g&&g,code:e.code?{...e.code,optimize:x,regExp:j}:{optimize:x,regExp:j},loopRequired:null!==(y=e.loopRequired)&&void 0!==y?y:200,loopEnum:null!==(_=e.loopEnum)&&void 0!==_?_:200,meta:null===($=e.meta)||void 0===$||$,messages:null===(v=e.messages)||void 0===v||v,inlineRefs:null===(w=e.inlineRefs)||void 0===w||w,schemaId:null!==(b=e.schemaId)&&void 0!==b?b:"$id",addUsedSchema:null===(P=e.addUsedSchema)||void 0===P||P,validateSchema:null===(E=e.validateSchema)||void 0===E||E,validateFormats:null===(S=e.validateFormats)||void 0===S||S,unicodeRegExp:null===(k=e.unicodeRegExp)||void 0===k||k,int32range:null===(T=e.int32range)||void 0===T||T,uriResolver:N}}class ${constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,..._(e)};const{es5:t,lines:r}=this.opts.code;this.scope=new a.ValueScope({scope:{},prefixes:m,es5:t,lines:r}),this.logger=function(e){if(!1===e)return k;if(void 0===e)return console;if(e.log&&e.warn&&e.error)return e;throw new Error("logger must implement log, warn and error methods")}(e.logger);const n=e.validateFormats;e.validateFormats=!1,this.RULES=(0,s.getRules)(),v.call(this,g,e,"NOT SUPPORTED"),v.call(this,y,e,"DEPRECATED","warn"),this._metaOpts=S.call(this),e.formats&&P.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&E.call(this,e.keywords),"object"==typeof e.meta&&this.addMetaSchema(e.meta),b.call(this),e.validateFormats=n}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:e,meta:t,schemaId:r}=this.opts;let n=p;"id"===r&&(n={...p},n.id=n.$id,delete n.$id),t&&e&&this.addMetaSchema(n,n[r],!1)}defaultMeta(){const{meta:e,schemaId:t}=this.opts;return this.opts.defaultMeta="object"==typeof e?e[t]||e:void 0}validate(e,t){let r;if("string"==typeof e){if(r=this.getSchema(e),!r)throw new Error(`no schema with key or ref "${e}"`)}else r=this.compile(e);const n=r(t);return"$async"in r||(this.errors=r.errors),n}compile(e,t){const r=this._addSchema(e,t);return r.validate||this._compileSchemaEnv(r)}compileAsync(e,t){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:r}=this.opts;return n.call(this,e,t);async function n(e,t){await s.call(this,e.$schema);const r=this._addSchema(e,t);return r.validate||i.call(this,r)}async function s(e){e&&!this.getSchema(e)&&await n.call(this,{$ref:e},!0)}async function i(e){try{return this._compileSchemaEnv(e)}catch(t){if(!(t instanceof o.default))throw t;return a.call(this,t),await c.call(this,t.missingSchema),i.call(this,e)}}function a({missingSchema:e,missingRef:t}){if(this.refs[e])throw new Error(`AnySchema ${e} is loaded but ${t} cannot be resolved`)}async function c(e){const r=await l.call(this,e);this.refs[e]||await s.call(this,r.$schema),this.refs[e]||this.addSchema(r,e,t)}async function l(e){const t=this._loading[e];if(t)return t;try{return await(this._loading[e]=r(e))}finally{delete this._loading[e]}}}addSchema(e,t,r,n=this.opts.validateSchema){if(Array.isArray(e)){for(const t of e)this.addSchema(t,void 0,r,n);return this}let o;if("object"==typeof e){const{schemaId:t}=this.opts;if(o=e[t],void 0!==o&&"string"!=typeof o)throw new Error(`schema ${t} must be string`)}return t=(0,c.normalizeId)(t||o),this._checkUnique(t),this.schemas[t]=this._addSchema(e,r,t,n,!0),this}addMetaSchema(e,t,r=this.opts.validateSchema){return this.addSchema(e,t,!0,r),this}validateSchema(e,t){if("boolean"==typeof e)return!0;let r;if(r=e.$schema,void 0!==r&&"string"!=typeof r)throw new Error("$schema must be a string");if(r=r||this.opts.defaultMeta||this.defaultMeta(),!r)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const n=this.validate(r,e);if(!n&&t){const e="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(e);this.logger.error(e)}return n}getSchema(e){let t;for(;"string"==typeof(t=w.call(this,e));)e=t;if(void 0===t){const{schemaId:r}=this.opts,n=new i.SchemaEnv({schema:{},schemaId:r});if(t=i.resolveSchema.call(this,n,e),!t)return;this.refs[e]=t}return t.validate||this._compileSchemaEnv(t)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const t=w.call(this,e);return"object"==typeof t&&this._cache.delete(t.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{const t=e;this._cache.delete(t);let r=e[this.opts.schemaId];return r&&(r=(0,c.normalizeId)(r),delete this.schemas[r],delete this.refs[r]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(const t of e)this.addKeyword(t);return this}addKeyword(e,t){let r;if("string"==typeof e)r=e,"object"==typeof t&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),t.keyword=r);else{if("object"!=typeof e||void 0!==t)throw new Error("invalid addKeywords parameters");if(r=(t=e).keyword,Array.isArray(r)&&!r.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(R.call(this,r,t),!t)return(0,d.eachItem)(r,(e=>C.call(this,e))),this;j.call(this,t);const n={...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)};return(0,d.eachItem)(r,0===n.type.length?e=>C.call(this,e,n):e=>n.type.forEach((t=>C.call(this,e,n,t)))),this}getKeyword(e){const t=this.RULES.all[e];return"object"==typeof t?t.definition:!!t}removeKeyword(e){const{RULES:t}=this;delete t.keywords[e],delete t.all[e];for(const r of t.rules){const t=r.rules.findIndex((t=>t.keyword===e));t>=0&&r.rules.splice(t,1)}return this}addFormat(e,t){return"string"==typeof t&&(t=new RegExp(t)),this.formats[e]=t,this}errorsText(e=this.errors,{separator:t=", ",dataVar:r="data"}={}){return e&&0!==e.length?e.map((e=>`${r}${e.instancePath} ${e.message}`)).reduce(((e,r)=>e+t+r)):"No errors"}$dataMetaSchema(e,t){const r=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(const n of t){const t=n.split("/").slice(1);let o=e;for(const e of t)o=o[e];for(const e in r){const t=r[e];if("object"!=typeof t)continue;const{$data:n}=t.definition,s=o[e];n&&s&&(o[e]=O(s))}}return e}_removeAllSchemas(e,t){for(const r in e){const n=e[r];(!t||t.test(r))&&("string"==typeof n?delete e[r]:n&&!n.meta&&(this._cache.delete(n.schema),delete e[r]))}}_addSchema(e,t,r,n=this.opts.validateSchema,o=this.opts.addUsedSchema){let s;const{schemaId:a}=this.opts;if("object"==typeof e)s=e[a];else{if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof e)throw new Error("schema must be object or boolean")}let l=this._cache.get(e);if(void 0!==l)return l;r=(0,c.normalizeId)(s||r);const d=c.getSchemaRefs.call(this,e,r);return l=new i.SchemaEnv({schema:e,schemaId:a,meta:t,baseId:r,localRefs:d}),this._cache.set(l.schema,l),o&&!r.startsWith("#")&&(r&&this._checkUnique(r),this.refs[r]=l),n&&this.validateSchema(e,!0),l}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):i.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){const t=this.opts;this.opts=this._metaOpts;try{i.compileSchema.call(this,e)}finally{this.opts=t}}}function v(e,t,r,n="error"){for(const o in e){const s=o;s in t&&this.logger[n](`${r}: option ${o}. ${e[s]}`)}}function w(e){return e=(0,c.normalizeId)(e),this.schemas[e]||this.refs[e]}function b(){const e=this.opts.schemas;if(e)if(Array.isArray(e))this.addSchema(e);else for(const t in e)this.addSchema(e[t],t)}function P(){for(const e in this.opts.formats){const t=this.opts.formats[e];t&&this.addFormat(e,t)}}function E(e){if(Array.isArray(e))this.addVocabulary(e);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const t in e){const r=e[t];r.keyword||(r.keyword=t),this.addKeyword(r)}}}function S(){const e={...this.opts};for(const t of f)delete e[t];return e}e.default=$,$.ValidationError=n.default,$.MissingRefError=o.default;const k={log(){},warn(){},error(){}};const T=/^[a-z_$][a-z0-9_$:-]*$/i;function R(e,t){const{RULES:r}=this;if((0,d.eachItem)(e,(e=>{if(r.keywords[e])throw new Error(`Keyword ${e} is already defined`);if(!T.test(e))throw new Error(`Keyword ${e} has invalid name`)})),t&&t.$data&&!("code"in t)&&!("validate"in t))throw new Error('$data keyword must have "code" or "validate" function')}function C(e,t,r){var n;const o=null==t?void 0:t.post;if(r&&o)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:s}=this;let i=o?s.post:s.rules.find((({type:e})=>e===r));if(i||(i={type:r,rules:[]},s.rules.push(i)),s.keywords[e]=!0,!t)return;const a={keyword:e,definition:{...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)}};t.before?x.call(this,i,a,t.before):i.rules.push(a),s.all[e]=a,null===(n=t.implements)||void 0===n||n.forEach((e=>this.addKeyword(e)))}function x(e,t,r){const n=e.rules.findIndex((e=>e.keyword===r));n>=0?e.rules.splice(n,0,t):(e.rules.push(t),this.logger.warn(`rule ${r} is not defined`))}function j(e){let{metaSchema:t}=e;void 0!==t&&(e.$data&&this.opts.$data&&(t=O(t)),e.validateSchema=this.compile(t,!0))}const N={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function O(e){return{anyOf:[e,N]}}}(core$2);var draft7={},core$1={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$s={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$s;var ref={};Object.defineProperty(ref,"__esModule",{value:!0}),ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code,codegen_1$l=codegen,names_1$1=names$1,compile_1$1=compile,util_1$j=util,def$r={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:r,it:n}=e,{baseId:o,schemaEnv:s,validateName:i,opts:a,self:c}=n,{root:l}=s;if(("#"===r||"#/"===r)&&o===l.baseId)return function(){if(s===l)return callRef(e,i,s,s.$async);const r=t.scopeValue("root",{ref:l});return callRef(e,codegen_1$l._`${r}.validate`,l,l.$async)}();const d=compile_1$1.resolveRef.call(c,l,o,r);if(void 0===d)throw new ref_error_1.default(n.opts.uriResolver,o,r);return d instanceof compile_1$1.SchemaEnv?function(t){const r=getValidate(e,t);callRef(e,r,t,t.$async)}(d):function(n){const o=t.scopeValue("schema",!0===a.code.source?{ref:n,code:(0,codegen_1$l.stringify)(n)}:{ref:n}),s=t.name("valid"),i=e.subschema({schema:n,dataTypes:[],schemaPath:codegen_1$l.nil,topSchemaRef:o,errSchemaPath:r},s);e.mergeEvaluated(i),e.ok(s)}(d)}};function getValidate(e,t){const{gen:r}=e;return t.validate?r.scopeValue("validate",{ref:t.validate}):codegen_1$l._`${r.scopeValue("wrapper",{ref:t})}.validate`}function callRef(e,t,r,n){const{gen:o,it:s}=e,{allErrors:i,schemaEnv:a,opts:c}=s,l=c.passContext?names_1$1.default.this:codegen_1$l.nil;function d(e){const t=codegen_1$l._`${e}.errors`;o.assign(names_1$1.default.vErrors,codegen_1$l._`${names_1$1.default.vErrors} === null ? ${t} : ${names_1$1.default.vErrors}.concat(${t})`),o.assign(names_1$1.default.errors,codegen_1$l._`${names_1$1.default.vErrors}.length`)}function p(e){var t;if(!s.opts.unevaluated)return;const n=null===(t=null==r?void 0:r.validate)||void 0===t?void 0:t.evaluated;if(!0!==s.props)if(n&&!n.dynamicProps)void 0!==n.props&&(s.props=util_1$j.mergeEvaluated.props(o,n.props,s.props));else{const t=o.var("props",codegen_1$l._`${e}.evaluated.props`);s.props=util_1$j.mergeEvaluated.props(o,t,s.props,codegen_1$l.Name)}if(!0!==s.items)if(n&&!n.dynamicItems)void 0!==n.items&&(s.items=util_1$j.mergeEvaluated.items(o,n.items,s.items));else{const t=o.var("items",codegen_1$l._`${e}.evaluated.items`);s.items=util_1$j.mergeEvaluated.items(o,t,s.items,codegen_1$l.Name)}}n?function(){if(!a.$async)throw new Error("async schema referenced by sync schema");const r=o.let("valid");o.try((()=>{o.code(codegen_1$l._`await ${(0,code_1$8.callValidateCode)(e,t,l)}`),p(t),i||o.assign(r,!0)}),(e=>{o.if(codegen_1$l._`!(${e} instanceof ${s.ValidationError})`,(()=>o.throw(e))),d(e),i||o.assign(r,!1)})),e.ok(r)}():e.result((0,code_1$8.callValidateCode)(e,t,l),(()=>p(t)),(()=>d(t)))}ref.getValidate=getValidate,ref.callRef=callRef,ref.default=def$r,Object.defineProperty(core$1,"__esModule",{value:!0});const id_1=id,ref_1=ref,core=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1.default];core$1.default=core;var validation$1={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$k=codegen,ops=codegen_1$k.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$i={message:({keyword:e,schemaCode:t})=>codegen_1$k.str`must be ${KWDs[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>codegen_1$k._`{comparison: ${KWDs[e].okStr}, limit: ${t}}`},def$q={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$i,code(e){const{keyword:t,data:r,schemaCode:n}=e;e.fail$data(codegen_1$k._`${r} ${KWDs[t].fail} ${n} || isNaN(${r})`)}};limitNumber.default=def$q;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$j=codegen,error$h={message:({schemaCode:e})=>codegen_1$j.str`must be multiple of ${e}`,params:({schemaCode:e})=>codegen_1$j._`{multipleOf: ${e}}`},def$p={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$h,code(e){const{gen:t,data:r,schemaCode:n,it:o}=e,s=o.opts.multipleOfPrecision,i=t.let("res"),a=s?codegen_1$j._`Math.abs(Math.round(${i}) - ${i}) > 1e-${s}`:codegen_1$j._`${i} !== parseInt(${i})`;e.fail$data(codegen_1$j._`(${n} === 0 || (${i} = ${r}/${n}, ${a}))`)}};multipleOf.default=def$p;var limitLength={},ucs2length$1={};function ucs2length(e){const t=e.length;let r,n=0,o=0;for(;o<t;)n++,r=e.charCodeAt(o++),r>=55296&&r<=56319&&o<t&&(r=e.charCodeAt(o),56320==(64512&r)&&o++);return n}Object.defineProperty(ucs2length$1,"__esModule",{value:!0}),ucs2length$1.default=ucs2length,ucs2length.code='require("ajv/dist/runtime/ucs2length").default',Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$i=codegen,util_1$i=util,ucs2length_1=ucs2length$1,error$g={message({keyword:e,schemaCode:t}){const r="maxLength"===e?"more":"fewer";return codegen_1$i.str`must NOT have ${r} than ${t} characters`},params:({schemaCode:e})=>codegen_1$i._`{limit: ${e}}`},def$o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$g,code(e){const{keyword:t,data:r,schemaCode:n,it:o}=e,s="maxLength"===t?codegen_1$i.operators.GT:codegen_1$i.operators.LT,i=!1===o.opts.unicode?codegen_1$i._`${r}.length`:codegen_1$i._`${(0,util_1$i.useFunc)(e.gen,ucs2length_1.default)}(${r})`;e.fail$data(codegen_1$i._`${i} ${s} ${n}`)}};limitLength.default=def$o;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code,codegen_1$h=codegen,error$f={message:({schemaCode:e})=>codegen_1$h.str`must match pattern "${e}"`,params:({schemaCode:e})=>codegen_1$h._`{pattern: ${e}}`},def$n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$f,code(e){const{data:t,$data:r,schema:n,schemaCode:o,it:s}=e,i=s.opts.unicodeRegExp?"u":"",a=r?codegen_1$h._`(new RegExp(${o}, ${i}))`:(0,code_1$7.usePattern)(e,n);e.fail$data(codegen_1$h._`!${a}.test(${t})`)}};pattern.default=def$n;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$g=codegen,error$e={message({keyword:e,schemaCode:t}){const r="maxProperties"===e?"more":"fewer";return codegen_1$g.str`must NOT have ${r} than ${t} properties`},params:({schemaCode:e})=>codegen_1$g._`{limit: ${e}}`},def$m={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$e,code(e){const{keyword:t,data:r,schemaCode:n}=e,o="maxProperties"===t?codegen_1$g.operators.GT:codegen_1$g.operators.LT;e.fail$data(codegen_1$g._`Object.keys(${r}).length ${o} ${n}`)}};limitProperties.default=def$m;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code,codegen_1$f=codegen,util_1$h=util,error$d={message:({params:{missingProperty:e}})=>codegen_1$f.str`must have required property '${e}'`,params:({params:{missingProperty:e}})=>codegen_1$f._`{missingProperty: ${e}}`},def$l={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$d,code(e){const{gen:t,schema:r,schemaCode:n,data:o,$data:s,it:i}=e,{opts:a}=i;if(!s&&0===r.length)return;const c=r.length>=a.loopRequired;if(i.allErrors?function(){if(c||s)e.block$data(codegen_1$f.nil,l);else for(const t of r)(0,code_1$6.checkReportMissingProp)(e,t)}():function(){const i=t.let("missing");if(c||s){const r=t.let("valid",!0);e.block$data(r,(()=>function(r,s){e.setParams({missingProperty:r}),t.forOf(r,n,(()=>{t.assign(s,(0,code_1$6.propertyInData)(t,o,r,a.ownProperties)),t.if((0,codegen_1$f.not)(s),(()=>{e.error(),t.break()}))}),codegen_1$f.nil)}(i,r))),e.ok(r)}else t.if((0,code_1$6.checkMissingProp)(e,r,i)),(0,code_1$6.reportMissingProp)(e,i),t.else()}(),a.strictRequired){const t=e.parentSchema.properties,{definedProperties:n}=e.it;for(const e of r)if(void 0===(null==t?void 0:t[e])&&!n.has(e)){const t=`required property "${e}" is not defined at "${i.schemaEnv.baseId+i.errSchemaPath}" (strictRequired)`;(0,util_1$h.checkStrictMode)(i,t,i.opts.strictRequired)}}function l(){t.forOf("prop",n,(r=>{e.setParams({missingProperty:r}),t.if((0,code_1$6.noPropertyInData)(t,o,r,a.ownProperties),(()=>e.error()))}))}}};required.default=def$l;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$e=codegen,error$c={message({keyword:e,schemaCode:t}){const r="maxItems"===e?"more":"fewer";return codegen_1$e.str`must NOT have ${r} than ${t} items`},params:({schemaCode:e})=>codegen_1$e._`{limit: ${e}}`},def$k={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$c,code(e){const{keyword:t,data:r,schemaCode:n}=e,o="maxItems"===t?codegen_1$e.operators.GT:codegen_1$e.operators.LT;e.fail$data(codegen_1$e._`${r}.length ${o} ${n}`)}};limitItems.default=def$k;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default',equal$1.default=equal,Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$d=codegen,util_1$g=util,equal_1$2=equal$1,error$b={message:({params:{i:e,j:t}})=>codegen_1$d.str`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>codegen_1$d._`{i: ${e}, j: ${t}}`},def$j={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$b,code(e){const{gen:t,data:r,$data:n,schema:o,parentSchema:s,schemaCode:i,it:a}=e;if(!n&&!o)return;const c=t.let("valid"),l=s.items?(0,dataType_1.getSchemaTypes)(s.items):[];function d(n,o){const s=t.name("item"),i=(0,dataType_1.checkDataTypes)(l,s,a.opts.strictNumbers,dataType_1.DataType.Wrong),d=t.const("indices",codegen_1$d._`{}`);t.for(codegen_1$d._`;${n}--;`,(()=>{t.let(s,codegen_1$d._`${r}[${n}]`),t.if(i,codegen_1$d._`continue`),l.length>1&&t.if(codegen_1$d._`typeof ${s} == "string"`,codegen_1$d._`${s} += "_"`),t.if(codegen_1$d._`typeof ${d}[${s}] == "number"`,(()=>{t.assign(o,codegen_1$d._`${d}[${s}]`),e.error(),t.assign(c,!1).break()})).code(codegen_1$d._`${d}[${s}] = ${n}`)}))}function p(n,o){const s=(0,util_1$g.useFunc)(t,equal_1$2.default),i=t.name("outer");t.label(i).for(codegen_1$d._`;${n}--;`,(()=>t.for(codegen_1$d._`${o} = ${n}; ${o}--;`,(()=>t.if(codegen_1$d._`${s}(${r}[${n}], ${r}[${o}])`,(()=>{e.error(),t.assign(c,!1).break(i)}))))))}e.block$data(c,(function(){const n=t.let("i",codegen_1$d._`${r}.length`),o=t.let("j");e.setParams({i:n,j:o}),t.assign(c,!0),t.if(codegen_1$d._`${n} > 1`,(()=>(l.length>0&&!l.some((e=>"object"===e||"array"===e))?d:p)(n,o)))}),codegen_1$d._`${i} === false`),e.ok(c)}};uniqueItems.default=def$j;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util,equal_1$1=equal$1,error$a={message:"must be equal to constant",params:({schemaCode:e})=>codegen_1$c._`{allowedValue: ${e}}`},def$i={keyword:"const",$data:!0,error:error$a,code(e){const{gen:t,data:r,$data:n,schemaCode:o,schema:s}=e;n||s&&"object"==typeof s?e.fail$data(codegen_1$c._`!${(0,util_1$f.useFunc)(t,equal_1$1.default)}(${r}, ${o})`):e.fail(codegen_1$c._`${s} !== ${r}`)}};_const.default=def$i;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util,equal_1=equal$1,error$9={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>codegen_1$b._`{allowedValues: ${e}}`},def$h={keyword:"enum",schemaType:"array",$data:!0,error:error$9,code(e){const{gen:t,data:r,$data:n,schema:o,schemaCode:s,it:i}=e;if(!n&&0===o.length)throw new Error("enum must have non-empty array");const a=o.length>=i.opts.loopEnum;let c;const l=()=>c??(c=(0,util_1$e.useFunc)(t,equal_1.default));let d;if(a||n)d=t.let("valid"),e.block$data(d,(function(){t.assign(d,!1),t.forOf("v",s,(e=>t.if(codegen_1$b._`${l()}(${r}, ${e})`,(()=>t.assign(d,!0).break()))))}));else{if(!Array.isArray(o))throw new Error("ajv implementation error");const e=t.const("vSchema",s);d=(0,codegen_1$b.or)(...o.map(((t,n)=>function(e,t){const n=o[t];return"object"==typeof n&&null!==n?codegen_1$b._`${l()}(${r}, ${e}[${t}])`:codegen_1$b._`${r} === ${n}`}(e,n))))}e.pass(d)}};_enum.default=def$h,Object.defineProperty(validation$1,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$1.default=validation;var applicator={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0}),additionalItems.validateAdditionalItems=void 0;const codegen_1$a=codegen,util_1$d=util,error$8={message:({params:{len:e}})=>codegen_1$a.str`must NOT have more than ${e} items`,params:({params:{len:e}})=>codegen_1$a._`{limit: ${e}}`},def$g={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$8,code(e){const{parentSchema:t,it:r}=e,{items:n}=t;Array.isArray(n)?validateAdditionalItems(e,n):(0,util_1$d.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas')}};function validateAdditionalItems(e,t){const{gen:r,schema:n,data:o,keyword:s,it:i}=e;i.items=!0;const a=r.const("len",codegen_1$a._`${o}.length`);if(!1===n)e.setParams({len:t.length}),e.pass(codegen_1$a._`${a} <= ${t.length}`);else if("object"==typeof n&&!(0,util_1$d.alwaysValidSchema)(i,n)){const n=r.var("valid",codegen_1$a._`${a} <= ${t.length}`);r.if((0,codegen_1$a.not)(n),(()=>function(n){r.forRange("i",t.length,a,(t=>{e.subschema({keyword:s,dataProp:t,dataPropType:util_1$d.Type.Num},n),i.allErrors||r.if((0,codegen_1$a.not)(n),(()=>r.break()))}))}(n))),e.ok(n)}}additionalItems.validateAdditionalItems=validateAdditionalItems,additionalItems.default=def$g;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0}),items.validateTuple=void 0;const codegen_1$9=codegen,util_1$c=util,code_1$5=code,def$f={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:r}=e;if(Array.isArray(t))return validateTuple(e,"additionalItems",t);r.items=!0,!(0,util_1$c.alwaysValidSchema)(r,t)&&e.ok((0,code_1$5.validateArray)(e))}};function validateTuple(e,t,r=e.schema){const{gen:n,parentSchema:o,data:s,keyword:i,it:a}=e;(function(e){const{opts:n,errSchemaPath:o}=a,s=r.length,c=s===e.minItems&&(s===e.maxItems||!1===e[t]);if(n.strictTuples&&!c){const e=`"${i}" is ${s}-tuple, but minItems or maxItems/${t} are not specified or different at path "${o}"`;(0,util_1$c.checkStrictMode)(a,e,n.strictTuples)}})(o),a.opts.unevaluated&&r.length&&!0!==a.items&&(a.items=util_1$c.mergeEvaluated.items(n,r.length,a.items));const c=n.name("valid"),l=n.const("len",codegen_1$9._`${s}.length`);r.forEach(((t,r)=>{(0,util_1$c.alwaysValidSchema)(a,t)||(n.if(codegen_1$9._`${l} > ${r}`,(()=>e.subschema({keyword:i,schemaProp:r,dataProp:r},c))),e.ok(c))}))}items.validateTuple=validateTuple,items.default=def$f,Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,items_1$1.validateTuple)(e,"items")};prefixItems.default=def$e;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$8=codegen,util_1$b=util,code_1$4=code,additionalItems_1$1=additionalItems,error$7={message:({params:{len:e}})=>codegen_1$8.str`must NOT have more than ${e} items`,params:({params:{len:e}})=>codegen_1$8._`{limit: ${e}}`},def$d={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$7,code(e){const{schema:t,parentSchema:r,it:n}=e,{prefixItems:o}=r;n.items=!0,!(0,util_1$b.alwaysValidSchema)(n,t)&&(o?(0,additionalItems_1$1.validateAdditionalItems)(e,o):e.ok((0,code_1$4.validateArray)(e)))}};items2020.default=def$d;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$a=util,error$6={message:({params:{min:e,max:t}})=>void 0===t?codegen_1$7.str`must contain at least ${e} valid item(s)`:codegen_1$7.str`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>void 0===t?codegen_1$7._`{minContains: ${e}}`:codegen_1$7._`{minContains: ${e}, maxContains: ${t}}`},def$c={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$6,code(e){const{gen:t,schema:r,parentSchema:n,data:o,it:s}=e;let i,a;const{minContains:c,maxContains:l}=n;s.opts.next?(i=void 0===c?1:c,a=l):i=1;const d=t.const("len",codegen_1$7._`${o}.length`);if(e.setParams({min:i,max:a}),void 0===a&&0===i)return void(0,util_1$a.checkStrictMode)(s,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==a&&i>a)return(0,util_1$a.checkStrictMode)(s,'"minContains" > "maxContains" is always invalid'),void e.fail();if((0,util_1$a.alwaysValidSchema)(s,r)){let t=codegen_1$7._`${d} >= ${i}`;return void 0!==a&&(t=codegen_1$7._`${t} && ${d} <= ${a}`),void e.pass(t)}s.items=!0;const p=t.name("valid");function u(){const e=t.name("_valid"),r=t.let("count",0);h(e,(()=>t.if(e,(()=>function(e){t.code(codegen_1$7._`${e}++`),void 0===a?t.if(codegen_1$7._`${e} >= ${i}`,(()=>t.assign(p,!0).break())):(t.if(codegen_1$7._`${e} > ${a}`,(()=>t.assign(p,!1).break())),1===i?t.assign(p,!0):t.if(codegen_1$7._`${e} >= ${i}`,(()=>t.assign(p,!0))))}(r)))))}function h(r,n){t.forRange("i",0,d,(t=>{e.subschema({keyword:"contains",dataProp:t,dataPropType:util_1$a.Type.Num,compositeRule:!0},r),n()}))}void 0===a&&1===i?h(p,(()=>t.if(p,(()=>t.break())))):0===i?(t.let(p,!0),void 0!==a&&t.if(codegen_1$7._`${o}.length > 0`,u)):(t.let(p,!1),u()),e.result(p,(()=>e.reset()))}};contains.default=def$c;var dependencies={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=codegen,r=util,n=code;e.error={message:({params:{property:e,depsCount:r,deps:n}})=>{const o=1===r?"property":"properties";return t.str`must have ${o} ${n} when property ${e} is present`},params:({params:{property:e,depsCount:r,deps:n,missingProperty:o}})=>t._`{property: ${e},
    missingProperty: ${o},
    depsCount: ${r},
    deps: ${n}}`};const o={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(e){const[t,r]=function({schema:e}){const t={},r={};for(const n in e){if("__proto__"===n)continue;(Array.isArray(e[n])?t:r)[n]=e[n]}return[t,r]}(e);s(e,t),i(e,r)}};function s(e,r=e.schema){const{gen:o,data:s,it:i}=e;if(0===Object.keys(r).length)return;const a=o.let("missing");for(const c in r){const l=r[c];if(0===l.length)continue;const d=(0,n.propertyInData)(o,s,c,i.opts.ownProperties);e.setParams({property:c,depsCount:l.length,deps:l.join(", ")}),i.allErrors?o.if(d,(()=>{for(const t of l)(0,n.checkReportMissingProp)(e,t)})):(o.if(t._`${d} && (${(0,n.checkMissingProp)(e,l,a)})`),(0,n.reportMissingProp)(e,a),o.else())}}function i(e,t=e.schema){const{gen:o,data:s,keyword:i,it:a}=e,c=o.name("valid");for(const l in t)(0,r.alwaysValidSchema)(a,t[l])||(o.if((0,n.propertyInData)(o,s,l,a.opts.ownProperties),(()=>{const t=e.subschema({keyword:i,schemaProp:l},c);e.mergeValidEvaluated(t,c)}),(()=>o.var(c,!0))),e.ok(c))}e.validatePropertyDeps=s,e.validateSchemaDeps=i,e.default=o}(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$9=util,error$5={message:"property name must be valid",params:({params:e})=>codegen_1$6._`{propertyName: ${e.propertyName}}`},def$b={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$5,code(e){const{gen:t,schema:r,data:n,it:o}=e;if((0,util_1$9.alwaysValidSchema)(o,r))return;const s=t.name("valid");t.forIn("key",n,(r=>{e.setParams({propertyName:r}),e.subschema({keyword:"propertyNames",data:r,dataTypes:["string"],propertyName:r,compositeRule:!0},s),t.if((0,codegen_1$6.not)(s),(()=>{e.error(!0),o.allErrors||t.break()}))})),e.ok(s)}};propertyNames.default=def$b;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code,codegen_1$5=codegen,names_1=names$1,util_1$8=util,error$4={message:"must NOT have additional properties",params:({params:e})=>codegen_1$5._`{additionalProperty: ${e.additionalProperty}}`},def$a={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$4,code(e){const{gen:t,schema:r,parentSchema:n,data:o,errsCount:s,it:i}=e;if(!s)throw new Error("ajv implementation error");const{allErrors:a,opts:c}=i;if(i.props=!0,"all"!==c.removeAdditional&&(0,util_1$8.alwaysValidSchema)(i,r))return;const l=(0,code_1$3.allSchemaProperties)(n.properties),d=(0,code_1$3.allSchemaProperties)(n.patternProperties);function p(e){t.code(codegen_1$5._`delete ${o}[${e}]`)}function u(n){if("all"===c.removeAdditional||c.removeAdditional&&!1===r)p(n);else{if(!1===r)return e.setParams({additionalProperty:n}),e.error(),void(a||t.break());if("object"==typeof r&&!(0,util_1$8.alwaysValidSchema)(i,r)){const r=t.name("valid");"failing"===c.removeAdditional?(h(n,r,!1),t.if((0,codegen_1$5.not)(r),(()=>{e.reset(),p(n)}))):(h(n,r),a||t.if((0,codegen_1$5.not)(r),(()=>t.break())))}}}function h(t,r,n){const o={keyword:"additionalProperties",dataProp:t,dataPropType:util_1$8.Type.Str};!1===n&&Object.assign(o,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(o,r)}t.forIn("key",o,(r=>{l.length||d.length?t.if(function(r){let o;if(l.length>8){const e=(0,util_1$8.schemaRefOrVal)(i,n.properties,"properties");o=(0,code_1$3.isOwnProperty)(t,e,r)}else o=l.length?(0,codegen_1$5.or)(...l.map((e=>codegen_1$5._`${r} === ${e}`))):codegen_1$5.nil;return d.length&&(o=(0,codegen_1$5.or)(o,...d.map((t=>codegen_1$5._`${(0,code_1$3.usePattern)(e,t)}.test(${r})`)))),(0,codegen_1$5.not)(o)}(r),(()=>u(r))):u(r)})),e.ok(codegen_1$5._`${s} === ${names_1.default.errors}`)}};additionalProperties.default=def$a;var properties$1={};Object.defineProperty(properties$1,"__esModule",{value:!0});const validate_1=validate,code_1$2=code,util_1$7=util,additionalProperties_1$1=additionalProperties,def$9={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,parentSchema:n,data:o,it:s}=e;"all"===s.opts.removeAdditional&&void 0===n.additionalProperties&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(s,additionalProperties_1$1.default,"additionalProperties"));const i=(0,code_1$2.allSchemaProperties)(r);for(const p of i)s.definedProperties.add(p);s.opts.unevaluated&&i.length&&!0!==s.props&&(s.props=util_1$7.mergeEvaluated.props(t,(0,util_1$7.toHash)(i),s.props));const a=i.filter((e=>!(0,util_1$7.alwaysValidSchema)(s,r[e])));if(0===a.length)return;const c=t.name("valid");for(const p of a)l(p)?d(p):(t.if((0,code_1$2.propertyInData)(t,o,p,s.opts.ownProperties)),d(p),s.allErrors||t.else().var(c,!0),t.endIf()),e.it.definedProperties.add(p),e.ok(c);function l(e){return s.opts.useDefaults&&!s.compositeRule&&void 0!==r[e].default}function d(t){e.subschema({keyword:"properties",schemaProp:t,dataProp:t},c)}}};properties$1.default=def$9;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code,codegen_1$4=codegen,util_1$6=util,util_2=util,def$8={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:r,data:n,parentSchema:o,it:s}=e,{opts:i}=s,a=(0,code_1$1.allSchemaProperties)(r),c=a.filter((e=>(0,util_1$6.alwaysValidSchema)(s,r[e])));if(0===a.length||c.length===a.length&&(!s.opts.unevaluated||!0===s.props))return;const l=i.strictSchema&&!i.allowMatchingProperties&&o.properties,d=t.name("valid");!0!==s.props&&!(s.props instanceof codegen_1$4.Name)&&(s.props=(0,util_2.evaluatedPropsToName)(t,s.props));const{props:p}=s;function u(e){for(const t in l)new RegExp(e).test(t)&&(0,util_1$6.checkStrictMode)(s,`property ${t} matches pattern ${e} (use allowMatchingProperties)`)}function h(r){t.forIn("key",n,(n=>{t.if(codegen_1$4._`${(0,code_1$1.usePattern)(e,r)}.test(${n})`,(()=>{const o=c.includes(r);o||e.subschema({keyword:"patternProperties",schemaProp:r,dataProp:n,dataPropType:util_2.Type.Str},d),s.opts.unevaluated&&!0!==p?t.assign(codegen_1$4._`${p}[${n}]`,!0):!o&&!s.allErrors&&t.if((0,codegen_1$4.not)(d),(()=>t.break()))}))}))}!function(){for(const e of a)l&&u(e),s.allErrors?h(e):(t.var(d,!0),h(e),t.if(d))}()}};patternProperties.default=def$8;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$5=util,def$7={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:r,it:n}=e;if((0,util_1$5.alwaysValidSchema)(n,r))return void e.fail();const o=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},o),e.failResult(o,(()=>e.reset()),(()=>e.error()))},error:{message:"must NOT be valid"}};not.default=def$7;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code,def$6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$6;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$4=util,error$3={message:"must match exactly one schema in oneOf",params:({params:e})=>codegen_1$3._`{passingSchemas: ${e.passing}}`},def$5={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$3,code(e){const{gen:t,schema:r,parentSchema:n,it:o}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(o.opts.discriminator&&n.discriminator)return;const s=r,i=t.let("valid",!1),a=t.let("passing",null),c=t.name("_valid");e.setParams({passing:a}),t.block((function(){s.forEach(((r,n)=>{let s;(0,util_1$4.alwaysValidSchema)(o,r)?t.var(c,!0):s=e.subschema({keyword:"oneOf",schemaProp:n,compositeRule:!0},c),n>0&&t.if(codegen_1$3._`${c} && ${i}`).assign(i,!1).assign(a,codegen_1$3._`[${a}, ${n}]`).else(),t.if(c,(()=>{t.assign(i,!0),t.assign(a,n),s&&e.mergeEvaluated(s,codegen_1$3.Name)}))}))})),e.result(i,(()=>e.reset()),(()=>e.error(!0)))}};oneOf.default=def$5;var allOf={};Object.defineProperty(allOf,"__esModule",{value:!0});const util_1$3=util,def$4={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:r,it:n}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");const o=t.name("valid");r.forEach(((t,r)=>{if((0,util_1$3.alwaysValidSchema)(n,t))return;const s=e.subschema({keyword:"allOf",schemaProp:r},o);e.ok(o),e.mergeEvaluated(s)}))}};allOf.default=def$4;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$2=util,error$2={message:({params:e})=>codegen_1$2.str`must match "${e.ifClause}" schema`,params:({params:e})=>codegen_1$2._`{failingKeyword: ${e.ifClause}}`},def$3={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$2,code(e){const{gen:t,parentSchema:r,it:n}=e;void 0===r.then&&void 0===r.else&&(0,util_1$2.checkStrictMode)(n,'"if" without "then" and "else" is ignored');const o=hasSchema(n,"then"),s=hasSchema(n,"else");if(!o&&!s)return;const i=t.let("valid",!0),a=t.name("_valid");if(function(){const t=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},a);e.mergeEvaluated(t)}(),e.reset(),o&&s){const r=t.let("ifClause");e.setParams({ifClause:r}),t.if(a,c("then",r),c("else",r))}else o?t.if(a,c("then")):t.if((0,codegen_1$2.not)(a),c("else"));function c(r,n){return()=>{const o=e.subschema({keyword:r},a);t.assign(i,a),e.mergeValidEvaluated(o,i),n?t.assign(n,codegen_1$2._`${r}`):e.setParams({ifClause:r})}}e.pass(i,(()=>e.error(!0)))}};function hasSchema(e,t){const r=e.schema[t];return void 0!==r&&!(0,util_1$2.alwaysValidSchema)(e,r)}_if.default=def$3;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$1=util,def$2={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:r}){void 0===t.if&&(0,util_1$1.checkStrictMode)(r,`"${e}" without "if" is ignored`)}};thenElse.default=def$2,Object.defineProperty(applicator,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$1,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf,if_1=_if,thenElse_1=thenElse;function getApplicator(e=!1){const t=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1.default,properties_1.default,patternProperties_1.default];return e?t.push(prefixItems_1.default,items2020_1.default):t.push(additionalItems_1.default,items_1.default),t.push(contains_1.default),t}applicator.default=getApplicator;var format$2={},format$1={};Object.defineProperty(format$1,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:e})=>codegen_1$1.str`must match format "${e}"`,params:({schemaCode:e})=>codegen_1$1._`{format: ${e}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(e,t){const{gen:r,data:n,$data:o,schema:s,schemaCode:i,it:a}=e,{opts:c,errSchemaPath:l,schemaEnv:d,self:p}=a;c.validateFormats&&(o?function(){const o=r.scopeValue("formats",{ref:p.formats,code:c.code.formats}),s=r.const("fDef",codegen_1$1._`${o}[${i}]`),a=r.let("fType"),l=r.let("format");r.if(codegen_1$1._`typeof ${s} == "object" && !(${s} instanceof RegExp)`,(()=>r.assign(a,codegen_1$1._`${s}.type || "string"`).assign(l,codegen_1$1._`${s}.validate`)),(()=>r.assign(a,codegen_1$1._`"string"`).assign(l,s))),e.fail$data((0,codegen_1$1.or)(!1===c.strictSchema?codegen_1$1.nil:codegen_1$1._`${i} && !${l}`,function(){const e=d.$async?codegen_1$1._`(${s}.async ? await ${l}(${n}) : ${l}(${n}))`:codegen_1$1._`${l}(${n})`,r=codegen_1$1._`(typeof ${l} == "function" ? ${e} : ${l}.test(${n}))`;return codegen_1$1._`${l} && ${l} !== true && ${a} === ${t} && !${r}`}()))}():function(){const o=p.formats[s];if(!o)return void function(){if(!1===c.strictSchema)return void p.logger.warn(e());throw new Error(e());function e(){return`unknown format "${s}" ignored in schema at path "${l}"`}}();if(!0===o)return;const[i,a,u]=function(e){const t=e instanceof RegExp?(0,codegen_1$1.regexpCode)(e):c.code.formats?codegen_1$1._`${c.code.formats}${(0,codegen_1$1.getProperty)(s)}`:void 0,n=r.scopeValue("formats",{key:s,ref:e,code:t});return"object"!=typeof e||e instanceof RegExp?["string",e,n]:[e.type||"string",e.validate,codegen_1$1._`${n}.validate`]}(o);i===t&&e.pass(function(){if("object"==typeof o&&!(o instanceof RegExp)&&o.async){if(!d.$async)throw new Error("async format in sync schema");return codegen_1$1._`await ${u}(${n})`}return"function"==typeof a?codegen_1$1._`${u}(${n})`:codegen_1$1._`${u}.test(${n})`}())}())}};format$1.default=def$1,Object.defineProperty(format$2,"__esModule",{value:!0});const format_1$1=format$1,format=[format_1$1.default];format$2.default=format;var metadata={};Object.defineProperty(metadata,"__esModule",{value:!0}),metadata.contentVocabulary=metadata.metadataVocabulary=void 0,metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"],Object.defineProperty(draft7,"__esModule",{value:!0});const core_1=core$1,validation_1=validation$1,applicator_1=applicator,format_1=format$2,metadata_1=metadata,draft7Vocabularies=[core_1.default,validation_1.default,(0,applicator_1.default)(),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary];draft7.default=draft7Vocabularies;var discriminator={},types={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DiscrError=void 0,function(e){e.Tag="tag",e.Mapping="mapping"}(e.DiscrError||(e.DiscrError={}))}(types),Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,util_1=util,error={message:({params:{discrError:e,tagName:t}})=>e===types_1.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:r}})=>codegen_1._`{error: ${e}, tag: ${r}, tagValue: ${t}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error:error,code(e){const{gen:t,data:r,schema:n,parentSchema:o,it:s}=e,{oneOf:i}=o;if(!s.opts.discriminator)throw new Error("discriminator: requires discriminator option");const a=n.propertyName;if("string"!=typeof a)throw new Error("discriminator: requires propertyName");if(n.mapping)throw new Error("discriminator: mapping is not supported");if(!i)throw new Error("discriminator: requires oneOf keyword");const c=t.let("valid",!1),l=t.const("tag",codegen_1._`${r}${(0,codegen_1.getProperty)(a)}`);function d(r){const n=t.name("valid"),o=e.subschema({keyword:"oneOf",schemaProp:r},n);return e.mergeEvaluated(o,codegen_1.Name),n}t.if(codegen_1._`typeof ${l} == "string"`,(()=>function(){const r=function(){var e;const t={},r=c(o);let n=!0;for(let o=0;o<i.length;o++){let t=i[o];null!=t&&t.$ref&&!(0,util_1.schemaHasRulesButRef)(t,s.self.RULES)&&(t=compile_1.resolveRef.call(s.self,s.schemaEnv.root,s.baseId,null==t?void 0:t.$ref),t instanceof compile_1.SchemaEnv&&(t=t.schema));const d=null===(e=null==t?void 0:t.properties)||void 0===e?void 0:e[a];if("object"!=typeof d)throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${a}"`);n=n&&(r||c(t)),l(d,o)}if(!n)throw new Error(`discriminator: "${a}" must be required`);return t;function c({required:e}){return Array.isArray(e)&&e.includes(a)}function l(e,t){if(e.const)d(e.const,t);else{if(!e.enum)throw new Error(`discriminator: "properties/${a}" must have "const" or "enum"`);for(const r of e.enum)d(r,t)}}function d(e,r){if("string"!=typeof e||e in t)throw new Error(`discriminator: "${a}" values must be unique strings`);t[e]=r}}();t.if(!1);for(const e in r)t.elseIf(codegen_1._`${l} === ${e}`),t.assign(c,d(r[e]));t.else(),e.error(!1,{discrError:types_1.DiscrError.Mapping,tag:l,tagName:a}),t.endIf()}()),(()=>e.error(!1,{discrError:types_1.DiscrError.Tag,tag:l,tagName:a}))),e.ok(c)}};discriminator.default=def;const $schema$1="http://json-schema.org/draft-07/schema#",$id="http://json-schema.org/draft-07/schema#",title="Core schema meta-schema",definitions$1={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type=["object","boolean"],properties={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema:$schema$1,$id:$id,title:title,definitions:definitions$1,type:type,properties:properties,default:!0};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const r=core$2,n=draft7,o=discriminator,s=require$$3,i=["/properties"],a="http://json-schema.org/draft-07/schema";class c extends r.default{_addVocabularies(){super._addVocabularies(),n.default.forEach((e=>this.addVocabulary(e))),this.opts.discriminator&&this.addKeyword(o.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const e=this.opts.$data?this.$dataMetaSchema(s,i):s;this.addMetaSchema(e,a,!1),this.refs["http://json-schema.org/schema"]=a}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(a)?a:void 0)}}e.exports=t=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var l=validate;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var d=codegen;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return d._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return d.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return d.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return d.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return d.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return d.CodeGen}});var p=validation_error;Object.defineProperty(t,"ValidationError",{enumerable:!0,get:function(){return p.default}});var u=ref_error;Object.defineProperty(t,"MissingRefError",{enumerable:!0,get:function(){return u.default}})}(ajv$1,ajv$1.exports);var ajvExports=ajv$1.exports;const Ajv=getDefaultExportFromCjs(ajvExports),$schema="http://json-schema.org/schema",$ref="#/definitions/Blueprint",definitions={Blueprint:{type:"object",properties:{landingPage:{type:"string",description:"The URL to navigate to after the blueprint has been run."},description:{type:"string",description:"Optional description. It doesn't do anything but is exposed as a courtesy to developers who may want to document which blueprint file does what."},preferredVersions:{type:"object",properties:{php:{anyOf:[{$ref:"#/definitions/SupportedPHPVersion"},{type:"string",const:"latest"}],description:"The preferred PHP version to use. If not specified, the latest supported version will be used"},wp:{type:"string",description:"The preferred WordPress version to use. If not specified, the latest supported version will be used"}},required:["php","wp"],additionalProperties:!1,description:"The preferred PHP and WordPress versions to use."},features:{type:"object",properties:{networking:{type:"boolean",description:"Should boot with support for network request via wp_safe_remote_get?"}},additionalProperties:!1},constants:{type:"object",additionalProperties:{type:"string"},description:"PHP Constants to define on every request",deprecated:"This experimental option will change without warning.\nUse `steps` instead."},plugins:{type:"array",items:{anyOf:[{type:"string"},{$ref:"#/definitions/FileReference"}]},description:"WordPress plugins to install and activate",deprecated:"This experimental option will change without warning.\nUse `steps` instead."},siteOptions:{type:"object",additionalProperties:{type:"string"},properties:{blogname:{type:"string",description:"The site title"}},description:"WordPress site options to define",deprecated:"This experimental option will change without warning.\nUse `steps` instead."},login:{anyOf:[{type:"boolean"},{type:"object",properties:{username:{type:"string"},password:{type:"string"}},required:["username","password"],additionalProperties:!1}],description:"User to log in as. If true, logs the user in as admin/password."},phpExtensionBundles:{type:"array",items:{$ref:"#/definitions/SupportedPHPExtensionBundle"},description:"The PHP extensions to use."},steps:{type:"array",items:{anyOf:[{$ref:"#/definitions/StepDefinition"},{type:"string"},{not:{}},{type:"boolean",const:!1},{type:"null"}]},description:"The steps to run after every other operation in this Blueprint was executed."},$schema:{type:"string"}},additionalProperties:!1},SupportedPHPVersion:{type:"string",enum:["8.3","8.2","8.1","8.0","7.4","7.3","7.2","7.1","7.0"]},FileReference:{anyOf:[{$ref:"#/definitions/VFSReference"},{$ref:"#/definitions/LiteralReference"},{$ref:"#/definitions/CoreThemeReference"},{$ref:"#/definitions/CorePluginReference"},{$ref:"#/definitions/UrlReference"}]},VFSReference:{type:"object",properties:{resource:{type:"string",const:"vfs",description:"Identifies the file resource as Virtual File System (VFS)"},path:{type:"string",description:"The path to the file in the VFS"}},required:["resource","path"],additionalProperties:!1},LiteralReference:{type:"object",properties:{resource:{type:"string",const:"literal",description:"Identifies the file resource as a literal file"},name:{type:"string",description:"The name of the file"},contents:{anyOf:[{type:"string"},{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}],description:"The contents of the file"}},required:["resource","name","contents"],additionalProperties:!1},CoreThemeReference:{type:"object",properties:{resource:{type:"string",const:"wordpress.org/themes",description:"Identifies the file resource as a WordPress Core theme"},slug:{type:"string",description:"The slug of the WordPress Core theme"}},required:["resource","slug"],additionalProperties:!1},CorePluginReference:{type:"object",properties:{resource:{type:"string",const:"wordpress.org/plugins",description:"Identifies the file resource as a WordPress Core plugin"},slug:{type:"string",description:"The slug of the WordPress Core plugin"}},required:["resource","slug"],additionalProperties:!1},UrlReference:{type:"object",properties:{resource:{type:"string",const:"url",description:"Identifies the file resource as a URL"},url:{type:"string",description:"The URL of the file"},caption:{type:"string",description:"Optional caption for displaying a progress message"}},required:["resource","url"],additionalProperties:!1},SupportedPHPExtensionBundle:{type:"string",const:"kitchen-sink"},StepDefinition:{type:"object",discriminator:{propertyName:"step"},required:["step"],oneOf:[{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"activatePlugin"},pluginPath:{type:"string",description:"Path to the plugin directory as absolute path (/wordpress/wp-content/plugins/plugin-name); or the plugin entry file relative to the plugins directory (plugin-name/plugin-name.php)."},pluginName:{type:"string",description:"Optional. Plugin name to display in the progress bar."}},required:["pluginPath","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"activateTheme"},themeFolderName:{type:"string",description:"The name of the theme folder inside wp-content/themes/"}},required:["step","themeFolderName"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"cp"},fromPath:{type:"string",description:"Source path"},toPath:{type:"string",description:"Target path"}},required:["fromPath","step","toPath"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"defineWpConfigConsts"},consts:{type:"object",additionalProperties:{},description:"The constants to define"},method:{type:"string",enum:["rewrite-wp-config","define-before-run"],description:"The method of defining the constants. Possible values are:\n\n- rewrite-wp-config: Default. Rewrites the wp-config.php file to                      explicitly call define() with the requested                      name and value. This method alters the file                      on the disk, but it doesn't conflict with                      existing define() calls in wp-config.php.\n- define-before-run: Defines the constant before running the requested                      script. It doesn't alter any files on the disk, but                      constants defined this way may conflict with existing                      define() calls in wp-config.php."},virtualize:{type:"boolean",deprecated:"This option is noop and will be removed in a future version.\nThis option is only kept in here to avoid breaking Blueprint schema validation\nfor existing apps using this option."}},required:["consts","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"defineSiteUrl"},siteUrl:{type:"string",description:"The URL"}},required:["siteUrl","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"enableMultisite"}},required:["step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"importFile"},file:{$ref:"#/definitions/FileReference",description:"The file to import"}},required:["file","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"importWordPressFiles"},wordPressFilesZip:{$ref:"#/definitions/FileReference",description:"The zip file containing the top-level WordPress files and directories."},pathInZip:{type:"string",description:"The path inside the zip file where the WordPress files are."}},required:["step","wordPressFilesZip"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"installPlugin",description:"The step identifier."},pluginZipFile:{$ref:"#/definitions/FileReference",description:"The plugin zip file to install."},options:{$ref:"#/definitions/InstallPluginOptions",description:"Optional installation options."}},required:["pluginZipFile","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"installTheme",description:"The step identifier."},themeZipFile:{$ref:"#/definitions/FileReference",description:"The theme zip file to install."},options:{type:"object",properties:{activate:{type:"boolean",description:"Whether to activate the theme after installing it."}},additionalProperties:!1,description:"Optional installation options."}},required:["step","themeZipFile"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"login"},username:{type:"string",description:"The user to log in as. Defaults to 'admin'."},password:{type:"string",description:"The password to log in with. Defaults to 'password'."}},required:["step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"mkdir"},path:{type:"string",description:"The path of the directory you want to create"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"mv"},fromPath:{type:"string",description:"Source path"},toPath:{type:"string",description:"Target path"}},required:["fromPath","step","toPath"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"request"},request:{$ref:"#/definitions/PHPRequest",description:"Request details (See /wordpress-playground/api/universal/interface/PHPRequest)"}},required:["request","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"rm"},path:{type:"string",description:"The path to remove"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"rmdir"},path:{type:"string",description:"The path to remove"}},required:["path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runPHP",description:"The step identifier."},code:{type:"string",description:"The PHP code to run."}},required:["code","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runPHPWithOptions"},options:{$ref:"#/definitions/PHPRunOptions",description:"Run options (See /wordpress-playground/api/universal/interface/PHPRunOptions)"}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runWpInstallationWizard"},options:{$ref:"#/definitions/WordPressInstallationOptions"}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"runSql",description:"The step identifier."},sql:{$ref:"#/definitions/FileReference",description:"The SQL to run. Each non-empty line must contain a valid SQL query."}},required:["sql","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"setPhpIniEntry"},key:{type:"string",description:'Entry name e.g. "display_errors"'},value:{type:"string",description:'Entry value as a string e.g. "1"'}},required:["key","step","value"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"setSiteOptions",description:'The name of the step. Must be "setSiteOptions".'},options:{type:"object",additionalProperties:{},description:"The options to set on the site."}},required:["options","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"unzip"},zipFile:{$ref:"#/definitions/FileReference",description:"The zip file to extract"},zipPath:{type:"string",description:"The path of the zip file to extract",deprecated:"Use zipFile instead."},extractToPath:{type:"string",description:"The path to extract the zip file to"}},required:["extractToPath","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"updateUserMeta"},meta:{type:"object",additionalProperties:{},description:'An object of user meta values to set, e.g. { "first_name": "John" }'},userId:{type:"number",description:"User ID"}},required:["meta","step","userId"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"writeFile"},path:{type:"string",description:"The path of the file to write to"},data:{anyOf:[{$ref:"#/definitions/FileReference"},{type:"string"},{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}],description:"The data to write"}},required:["data","path","step"]},{type:"object",additionalProperties:!1,properties:{progress:{type:"object",properties:{weight:{type:"number"},caption:{type:"string"}},additionalProperties:!1},step:{type:"string",const:"wp-cli",description:"The step identifier."},command:{anyOf:[{type:"string"},{type:"array",items:{type:"string"}}],description:"The WP CLI command to run."},wpCliPath:{type:"string",description:"wp-cli.phar path"}},required:["command","step"]}]},InstallPluginOptions:{type:"object",properties:{activate:{type:"boolean",description:"Whether to activate the plugin after installing it."}},additionalProperties:!1},PHPRequest:{type:"object",properties:{method:{$ref:"#/definitions/HTTPMethod",description:"Request method. Default: `GET`."},url:{type:"string",description:"Request path or absolute URL."},headers:{$ref:"#/definitions/PHPRequestHeaders",description:"Request headers."},files:{type:"object",additionalProperties:{type:"object",properties:{size:{type:"number"},type:{type:"string"},lastModified:{type:"number"},name:{type:"string"},webkitRelativePath:{type:"string"}},required:["lastModified","name","size","type","webkitRelativePath"],additionalProperties:!1},description:"Uploaded files"},body:{type:"string",description:"Request body without the files."},formData:{type:"object",additionalProperties:{},description:"Form data. If set, the request body will be ignored and the content-type header will be set to `application/x-www-form-urlencoded`."}},required:["url"],additionalProperties:!1},HTTPMethod:{type:"string",enum:["GET","POST","HEAD","OPTIONS","PATCH","PUT","DELETE"]},PHPRequestHeaders:{type:"object",additionalProperties:{type:"string"}},PHPRunOptions:{type:"object",properties:{relativeUri:{type:"string",description:"Request path following the domain:port part."},scriptPath:{type:"string",description:"Path of the .php file to execute."},protocol:{type:"string",description:"Request protocol."},method:{$ref:"#/definitions/HTTPMethod",description:"Request method. Default: `GET`."},headers:{$ref:"#/definitions/PHPRequestHeaders",description:"Request headers."},body:{type:"string",description:"Request body without the files."},fileInfos:{type:"array",items:{$ref:"#/definitions/FileInfo"},description:"Uploaded files."},code:{type:"string",description:"The code snippet to eval instead of a php file."},throwOnError:{type:"boolean",description:"Whether to throw an error if the PHP process exits with a non-zero code or outputs to stderr."}},additionalProperties:!1},FileInfo:{type:"object",properties:{key:{type:"string"},name:{type:"string"},type:{type:"string"},data:{type:"object",properties:{BYTES_PER_ELEMENT:{type:"number"},buffer:{type:"object",properties:{byteLength:{type:"number"}},required:["byteLength"],additionalProperties:!1},byteLength:{type:"number"},byteOffset:{type:"number"},length:{type:"number"}},required:["BYTES_PER_ELEMENT","buffer","byteLength","byteOffset","length"],additionalProperties:{type:"number"}}},required:["key","name","type","data"],additionalProperties:!1},WordPressInstallationOptions:{type:"object",properties:{adminUsername:{type:"string"},adminPassword:{type:"string"}},additionalProperties:!1}},blueprintSchema={$schema:$schema,$ref:$ref,definitions:definitions},{wpCLI:wpCLI,...otherStepHandlers}=allStepHandlers,keyedStepHandlers={...otherStepHandlers,"wp-cli":wpCLI};function compileBlueprint(e,{progress:t=new ProgressTracker,semaphore:r=new Semaphore({concurrency:3}),onStepCompleted:n=(()=>{})}={}){var o,s,i,a,c;if((e={...e,steps:(e.steps||[]).filter(isStepDefinition)}).constants&&e.steps.unshift({step:"defineWpConfigConsts",consts:e.constants}),e.siteOptions&&e.steps.unshift({step:"setSiteOptions",options:e.siteOptions}),e.plugins){const t=e.plugins.map((e=>"string"==typeof e?e.startsWith("https://")?{resource:"url",url:e}:{resource:"wordpress.org/plugins",slug:e}:e)).map((e=>({step:"installPlugin",pluginZipFile:e})));e.steps.unshift(...t)}e.login&&e.steps.push({step:"login",...!0===e.login?{username:"admin",password:"password"}:e.login});const l=null==(o=e.steps)?void 0:o.findIndex((e=>"object"==typeof e&&"wp-cli"===(null==e?void 0:e.step)));void 0!==l&&l>-1&&(e.phpExtensionBundles||(e.phpExtensionBundles=[]),e.phpExtensionBundles.includes("kitchen-sink")||(e.phpExtensionBundles.push("kitchen-sink"),console.warn("The WP-CLI step used in your Blueprint requires the iconv and mbstring PHP extensions. However, you did not specify the kitchen-sink extension bundle. Playground will override your choice and load the kitchen-sink PHP extensions bundle to prevent the WP-CLI step from failing. ")),null==(s=e.steps)||s.splice(l,0,{step:"writeFile",data:{resource:"url",url:"https://playground.wordpress.net/wp-cli.phar"},path:"/tmp/wp-cli.phar"}));const{valid:d,errors:p}=validateBlueprint(e);if(!d){const e=new Error(`Invalid blueprint: ${p[0].message} at ${p[0].instancePath}`);throw e.errors=p,e}const u=e.steps||[],h=u.reduce(((e,t)=>{var r;return e+((null==(r=t.progress)?void 0:r.weight)||1)}),0),f=u.map((e=>compileStep(e,{semaphore:r,rootProgressTracker:t,totalProgressWeight:h})));return{versions:{php:compileVersion(null==(i=e.preferredVersions)?void 0:i.php,SupportedPHPVersions,LatestSupportedPHPVersion),wp:(null==(a=e.preferredVersions)?void 0:a.wp)||"latest"},phpExtensions:compilePHPExtensions([],e.phpExtensionBundles||[]),features:{networking:(null==(c=e.features)?void 0:c.networking)??!1},run:async r=>{try{for(const{resources:e}of f)for(const t of e)t.setPlayground(r),t.isAsync&&t.resolve();for(const[e,{run:t,step:s}]of Object.entries(f))try{const e=await t(r);n(e,s)}catch(o){throw console.error(o),new Error(`Error when executing the blueprint step #${e} (${JSON.stringify(s)}) ${o instanceof Error?`: ${o.message}`:o}`,{cause:o})}}finally{try{await r.goTo(e.landingPage||"/")}catch{}t.finish()}}}}const ajv=new Ajv({discriminator:!0});let blueprintValidator;function validateBlueprint(e){var t;blueprintValidator=ajv.compile(blueprintSchema);const r=blueprintValidator(e);if(r)return{valid:r};const n=new Set;for(const o of blueprintValidator.errors)o.schemaPath.startsWith("#/properties/steps/items/anyOf")||n.add(o.instancePath);return{valid:r,errors:null==(t=blueprintValidator.errors)?void 0:t.filter((e=>!(e.schemaPath.startsWith("#/properties/steps/items/anyOf")&&n.has(e.instancePath))))}}function compileVersion(e,t,r){return e&&t.includes(e)?e:r}function compilePHPExtensions(e,t){const r=SupportedPHPExtensionsList.filter((t=>e.includes(t))),n=t.flatMap((e=>e in SupportedPHPExtensionBundles?SupportedPHPExtensionBundles[e]:[]));return Array.from(new Set([...r,...n]))}function isStepDefinition(e){return!("object"!=typeof e||!e)}function compileStep(e,{semaphore:t,rootProgressTracker:r,totalProgressWeight:n}){var o;const s=r.stage(((null==(o=e.progress)?void 0:o.weight)||1)/n),i={};for(const d of Object.keys(e)){let r=e[d];isFileReference(r)&&(r=Resource.create(r,{semaphore:t})),i[d]=r}const a=getResources(i),c=getResources(i).filter((e=>e.isAsync)),l=1/(c.length+1);for(const d of c)d.progress=s.stage(l);return{run:async t=>{var r;try{return s.fillSlowly(),await keyedStepHandlers[e.step](t,await resolveArguments(i),{tracker:s,initialCaption:null==(r=e.progress)?void 0:r.caption})}finally{s.finish()}},step:e,resources:a}}function getResources(e){const t=[];for(const r in e){const n=e[r];n instanceof Resource&&t.push(n)}return t}async function resolveArguments(e){const t={};for(const r in e){const n=e[r];t[r]=n instanceof Resource?await n.resolve():n}return t}async function runBlueprintSteps(e,t){await e.run(t)}function setPluginProxyURL(){}const proxyMarker=Symbol("Comlink.proxy"),createEndpoint=Symbol("Comlink.endpoint"),releaseProxy=Symbol("Comlink.releaseProxy"),finalizer=Symbol("Comlink.finalizer"),throwMarker=Symbol("Comlink.thrown"),isObject=e=>"object"==typeof e&&null!==e||"function"==typeof e,proxyTransferHandler={canHandle:e=>isObject(e)&&e[proxyMarker],serialize(e){const{port1:t,port2:r}=new MessageChannel;return expose(e,t),[r,[r]]},deserialize:e=>(e.start(),wrap(e))},throwTransferHandler={canHandle:e=>isObject(e)&&throwMarker in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},transferHandlers=new Map([["proxy",proxyTransferHandler],["throw",throwTransferHandler]]);function isAllowedOrigin(e,t){for(const r of e)if(t===r||"*"===r||r instanceof RegExp&&r.test(t))return!0;return!1}function expose(e,t=globalThis,r=["*"]){t.addEventListener("message",(function n(o){if(!o||!o.data)return;if(!isAllowedOrigin(r,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);const{id:s,type:i,path:a}=Object.assign({path:[]},o.data),c=(o.data.argumentList||[]).map(fromWireValue);let l;try{const t=a.slice(0,-1).reduce(((e,t)=>e[t]),e),r=a.reduce(((e,t)=>e[t]),e);switch(i){case"GET":l=r;break;case"SET":t[a.slice(-1)[0]]=fromWireValue(o.data.value),l=!0;break;case"APPLY":l=r.apply(t,c);break;case"CONSTRUCT":l=proxy(new r(...c));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;expose(e,r),l=transfer(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(d){l={value:d,[throwMarker]:0}}Promise.resolve(l).catch((e=>({value:e,[throwMarker]:0}))).then((r=>{const[o,a]=toWireValue(r);t.postMessage(Object.assign(Object.assign({},o),{id:s}),a),"RELEASE"===i&&(t.removeEventListener("message",n),closeEndPoint(t),finalizer in e&&"function"==typeof e[finalizer]&&e[finalizer]())})).catch((e=>{const[r,n]=toWireValue({value:new TypeError("Unserializable return value"),[throwMarker]:0});t.postMessage(Object.assign(Object.assign({},r),{id:s}),n)}))})),t.start&&t.start()}function isMessagePort(e){return"MessagePort"===e.constructor.name}function closeEndPoint(e){isMessagePort(e)&&e.close()}function wrap(e,t){return createProxy(e,[],t)}function throwIfProxyReleased(e){if(e)throw new Error("Proxy has been released and is not useable")}function releaseEndpoint(e){return requestResponseMessage(e,{type:"RELEASE"}).then((()=>{closeEndPoint(e)}))}const proxyCounter=new WeakMap,proxyFinalizers="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(proxyCounter.get(e)||0)-1;proxyCounter.set(e,t),0===t&&releaseEndpoint(e)}));function registerProxy(e,t){const r=(proxyCounter.get(t)||0)+1;proxyCounter.set(t,r),proxyFinalizers&&proxyFinalizers.register(e,t,e)}function unregisterProxy(e){proxyFinalizers&&proxyFinalizers.unregister(e)}function createProxy(e,t=[],r=function(){}){let n=!1;const o=new Proxy(r,{get(r,s){if(throwIfProxyReleased(n),s===releaseProxy)return()=>{unregisterProxy(o),releaseEndpoint(e),n=!0};if("then"===s){if(0===t.length)return{then:()=>o};const r=requestResponseMessage(e,{type:"GET",path:t.map((e=>e.toString()))}).then(fromWireValue);return r.then.bind(r)}return createProxy(e,[...t,s])},set(r,o,s){throwIfProxyReleased(n);const[i,a]=toWireValue(s);return requestResponseMessage(e,{type:"SET",path:[...t,o].map((e=>e.toString())),value:i},a).then(fromWireValue)},apply(r,o,s){throwIfProxyReleased(n);const i=t[t.length-1];if(i===createEndpoint)return requestResponseMessage(e,{type:"ENDPOINT"}).then(fromWireValue);if("bind"===i)return createProxy(e,t.slice(0,-1));const[a,c]=processArguments(s);return requestResponseMessage(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:a},c).then(fromWireValue)},construct(r,o){throwIfProxyReleased(n);const[s,i]=processArguments(o);return requestResponseMessage(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:s},i).then(fromWireValue)}});return registerProxy(o,e),o}function myFlat(e){return Array.prototype.concat.apply([],e)}function processArguments(e){const t=e.map(toWireValue);return[t.map((e=>e[0])),myFlat(t.map((e=>e[1])))]}const transferCache=new WeakMap;function transfer(e,t){return transferCache.set(e,t),e}function proxy(e){return Object.assign(e,{[proxyMarker]:!0})}function windowEndpoint(e,t=globalThis,r="*"){return{postMessage:(t,n)=>e.postMessage(t,r,n),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function toWireValue(e){for(const[t,r]of transferHandlers)if(r.canHandle(e)){const[n,o]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},o]}return[{type:"RAW",value:e},transferCache.get(e)||[]]}function fromWireValue(e){switch(e.type){case"HANDLER":return transferHandlers.get(e.name).deserialize(e.value);case"RAW":return e.value}}function requestResponseMessage(e,t,r){return new Promise((n=>{const o=generateUUID();e.addEventListener("message",(function t(r){!r.data||!r.data.id||r.data.id!==o||(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:o},t),r)}))}function generateUUID(){return new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-")}function consumeAPI(e,t=void 0){setupTransferHandlers();const r=wrap(e instanceof Worker?e:windowEndpoint(e,t)),n=proxyClone(r);return new Proxy(n,{get:(e,t)=>"isConnected"===t?async()=>{for(;;)try{await runWithTimeout(r.isConnected(),200);break}catch{}}:r[t]})}async function runWithTimeout(e,t){return new Promise(((r,n)=>{setTimeout(n,t),e.then(r)}))}let isTransferHandlersSetup=!1;function setupTransferHandlers(){isTransferHandlersSetup||(isTransferHandlersSetup=!0,transferHandlers.set("EVENT",{canHandle:e=>e instanceof CustomEvent,serialize:e=>[{detail:e.detail},[]],deserialize:e=>e}),transferHandlers.set("FUNCTION",{canHandle:e=>"function"==typeof e,serialize(e){console.debug("[Comlink][Performance] Proxying a function");const{port1:t,port2:r}=new MessageChannel;return expose(e,t),[r,[r]]},deserialize:e=>(e.start(),wrap(e))}),transferHandlers.set("PHPResponse",{canHandle:e=>"object"==typeof e&&null!==e&&"headers"in e&&"bytes"in e&&"errors"in e&&"exitCode"in e&&"httpStatusCode"in e,serialize:e=>[e.toRawData(),[]],deserialize:e=>PHPResponse.fromRawData(e)}))}function proxyClone(e){return new Proxy(e,{get(e,t){switch(typeof e[t]){case"function":return(...r)=>e[t](...r);case"object":return null===e[t]?e[t]:proxyClone(e[t]);case"undefined":case"number":case"string":return e[t];default:return proxy(e[t])}}})}class Logger{constructor(e){this.LOG_PREFIX="Playground",this.windowConnected=!1,this.lastPHPLogLength=0,this.errorLogPath="/wordpress/wp-content/debug.log",e&&(this.errorLogPath=e)}async getRequestPhpErrorLog(e){return await e.fileExists(this.errorLogPath)?await e.readFileAsText(this.errorLogPath):""}logWindowError(e){this.log(`${e.message} in ${e.filename} on line ${e.lineno}:${e.colno}`,"fatal")}logUnhandledRejection(e){this.log(`${e.reason.stack}`,"fatal")}addWindowErrorListener(){this.windowConnected||typeof window>"u"||(window.addEventListener("error",this.logWindowError.bind(this)),window.addEventListener("unhandledrejection",this.logUnhandledRejection.bind(this)),window.addEventListener("rejectionhandled",this.logUnhandledRejection.bind(this)),this.windowConnected=!0)}addPlaygroundRequestEndListener(e){e.addEventListener("request.end",(async()=>{const t=await this.getRequestPhpErrorLog(e);t.length>this.lastPHPLogLength&&(this.logRaw(t.substring(this.lastPHPLogLength)),this.lastPHPLogLength=t.length)}))}formatLogDate(e){return new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(e).replace(/ /g,"-")+" "+new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(e)}formatMessage(e,t){return`[${this.formatLogDate(new Date)}] ${this.LOG_PREFIX} ${t}: ${e}`}log(e,t){void 0===t&&(t="info");const r=this.formatMessage(e,t);this.logRaw(r)}logRaw(e){console.debug(e)}}const logger=new Logger;function collectPhpLogs(e,t){e.addPlaygroundRequestEndListener(t)}async function startPlaygroundWeb({iframe:e,blueprint:t,remoteUrl:r,progressTracker:n=new ProgressTracker,disableProgressBar:o,onBlueprintStepCompleted:s,sapiName:i}){if(assertValidRemote(r),allowStorageAccessByUserActivation(e),r=setQueryParams(r,{progressbar:!o}),n.setCaption("Preparing WordPress"),!t)return doStartPlaygroundWeb(e,r,n);const a=compileBlueprint(t,{progress:n.stage(.5),onStepCompleted:s}),c=await doStartPlaygroundWeb(e,setQueryParams(r,{php:a.versions.php,wp:a.versions.wp,"sapi-name":i,"php-extension":a.phpExtensions,networking:a.features.networking?"yes":"no"}),n);return collectPhpLogs(logger,c),await runBlueprintSteps(a,c),n.finish(),c}function allowStorageAccessByUserActivation(e){var t,r;null!=(t=e.sandbox)&&t.length&&(null==(r=e.sandbox)||!r.contains("allow-storage-access-by-user-activation"))&&e.sandbox.add("allow-storage-access-by-user-activation")}async function doStartPlaygroundWeb(e,t,r){await new Promise((r=>{e.src=t,e.addEventListener("load",r,!1)}));const n=consumeAPI(e.contentWindow,e.ownerDocument.defaultView);await n.isConnected(),r.pipe(n);const o=r.stage();return await n.onDownloadProgress(o.loadingListener),await n.isReady(),o.finish(),n}const officialRemoteOrigin="https://playground.wordpress.net";function assertValidRemote(e){const t=new URL(e,officialRemoteOrigin);if((t.origin===officialRemoteOrigin||"localhost"===t.hostname)&&"/remote.html"!==t.pathname)throw new Error(`Invalid remote URL: ${t}. Expected origin to be ${officialRemoteOrigin}/remote.html.`)}function setQueryParams(e,t){const r=new URL(e,officialRemoteOrigin),n=new URLSearchParams(r.search);for(const[o,s]of Object.entries(t))if(null!=s&&!1!==s)if(Array.isArray(s))for(const e of s)n.append(o,e.toString());else n.set(o,s.toString());return r.search=n.toString(),r.toString()}async function connectPlayground(e,t){if(console.warn("`connectPlayground` is deprecated and will be removed. Use `startPlayground` instead."),null!=t&&t.loadRemote)return startPlaygroundWeb({iframe:e,remoteUrl:t.loadRemote});const r=consumeAPI(e.contentWindow,e.ownerDocument.defaultView);return await r.isConnected(),r}}}]);